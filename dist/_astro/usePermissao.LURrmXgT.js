import{r as i}from"./index.DVhKKaGN.js";import{s as u}from"./supabase.CWKfsr2i.js";function P(m){const[y,t]=i.useState("none"),[w,a]=i.useState(!0),[D,r]=i.useState(!0),[M,n]=i.useState(!1);return i.useEffect(()=>{let o=!0;async function R(){const{data:e}=await u.auth.getSession(),s=e?.session?.user;if(s)return s;const{data:A}=await u.auth.getUser();return A?.user??null}async function p(){try{const e=await R();if(!o)return;if(!e){t("none"),a(!1),n(!1),r(!1);return}const s=e.id,A=(e.email||"").toLowerCase(),b=e.user_metadata?.tipo||"",c=String(b).toUpperCase(),_=c.includes("ADMIN")||c.includes("ADMINISTRADOR")||c.includes("MASTER")||c.includes("SUPER");let S=!1;const{data:f}=await u.from("users").select("user_types(name)").eq("id",s).maybeSingle(),l=Array.isArray(f?.user_types)?(f.user_types[0]?.name||"").toUpperCase():(f?.user_types?.name||"").toUpperCase();if(S=l.includes("ADMIN")||l.includes("ADMINISTRADOR")||l.includes("MASTER")||l.includes("SUPER"),s==="d9076aab-13c4-49d6-bc6a-ff3211009721"||_||S){n(!0),t("admin"),a(!0),r(!1);return}const{data:g}=await u.from("modulo_acesso").select("modulo, permissao, ativo").eq("usuario_id",s),d=(g||[]).find(v=>(v.modulo||"").toLowerCase()===m.toLowerCase());d&&d.ativo?(t(d.permissao||"none"),a(!0),n(!1)):(t("none"),a(!1),n(!1))}catch(e){if(console.error("[usePermissao] Erro:",e),!o)return;t("none"),a(!1),n(!1)}finally{o&&r(!1)}}p();const{data:U}=u.auth.onAuthStateChange((e,s)=>{o&&(s?.user?(r(!0),p()):(t("none"),a(!1),n(!1),r(!1)))});return()=>{o=!1,U?.subscription?.unsubscribe()}},[m]),{permissao:y,ativo:w,loading:D,isAdmin:M}}export{P as u};
