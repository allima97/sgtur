import{s as h,j as s}from"./supabase.DNkd6bxA.js";import{r as o}from"./index.C0Fn7Wtz.js";import{r as es}from"./index.2_Y_w1Vs.js";import{r as as}from"./logs.WCvMC_es.js";async function is(){try{const{data:e}=await h.auth.getUser(),v=e?.user?.id||null;let u="";try{u=(await(await fetch("https://api.ipify.org?format=json")).json()).ip||""}catch{}const k=typeof navigator<"u"?navigator.userAgent:"";await as({user_id:v,acao:"logout",modulo:"login",detalhes:{ip:u,userAgent:k}}),await h.auth.signOut(),window.location.href="/auth/login"}catch(e){console.error("Erro ao sair:",e),window.location.href="/auth/login"}}const rs={Dashboard:"dashboard",Vendas:"vendas_consulta",Orcamentos:"orcamentos",Clientes:"clientes",Cadastros:"cadastros",Paises:"cadastros_paises",Estados:"cadastros_estados",Cidades:"cadastros_cidades",Destinos:"cadastros_destinos",Produtos:"cadastros_produtos",Relatorios:"relatorios",RelatorioVendas:"relatorios_vendas",RelatorioDestinos:"relatorios_destinos",RelatorioProdutos:"relatorios_produtos",RelatorioClientes:"relatorios_clientes",Parametros:"parametros",TipoProdutos:"parametros_tipo_produtos",Metas:"parametros_metas",RegrasComissao:"parametros_regras_comissao",Admin:"admin",AdminDashboard:"admin_dashboard",AdminUsers:"admin_users",AdminLogs:"admin_logs"};function hs({activePage:e}){const[v,u]=o.useState(null),[k,x]=o.useState({}),[O,ns]=o.useState(!1),[I,C]=o.useState(!1),[A,E]=o.useState(!1),[os,$]=o.useState(""),[L,U]=o.useState(!1),[ts,D]=o.useState(""),[N,T]=o.useState(!1),[l,j]=o.useState(!1);o.useEffect(()=>{T(!0)},[]),o.useEffect(()=>{if(!N)return;const r=window.matchMedia("(max-width: 1024px)"),n=t=>{t.matches||j(!1)};return r.addEventListener?r.addEventListener("change",n):r.addListener(n),()=>{r.removeEventListener?r.removeEventListener("change",n):r.removeListener(n)}},[N]),o.useEffect(()=>{if(!l)return;const r=n=>{n.key==="Escape"&&j(!1)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[l]);async function V(){const{data:r}=await h.auth.getSession(),n=r?.session?.user,{data:t}=n?{data:{user:n}}:await h.auth.getUser(),c=t?.user||n||null,m=c?.id||null,g=c?.email||"",K=c?.user_metadata?.tipo||"",S=c?.app_metadata?.roles||[],W=c?.app_metadata?.role||"",z=Array.isArray(S)&&S.length>0?S.join(","):W,f=[K,z].filter(Boolean).join(", ");if(u(a=>a!==m?m:a),$(a=>a!==String(f||"").toUpperCase()?String(f||"").toUpperCase():a),D(a=>a!==g.toLowerCase()?g.toLowerCase():a),!m){I||x({}),C(!0);return}const{data:H}=await h.from("users").select("user_types(name)").eq("id",m).maybeSingle(),Q=H?.user_types?.name||"",X=String(Q||"").toUpperCase(),M=["ADMIN","ADMINISTRADOR","SUPER","MASTER"],Y=M.some(a=>f.toUpperCase().includes(a)),Z=M.some(a=>X.includes(a)),_=Y||Z;U(a=>a!==_?_:a);const{data:P}=await h.from("modulo_acesso").select("modulo, permissao, ativo").eq("usuario_id",m),b={};(P||[]).forEach(a=>{const y=a.modulo.toLowerCase(),p=(a.permissao||"none").toLowerCase(),ss=["view","create","edit","delete","admin"].includes(p)?p:p==="none"?"none":"view";b[y]=a.ativo?ss:"none"}),x(a=>{const y=JSON.stringify(a),p=JSON.stringify(b);return y!==p?b:a});try{window.localStorage.setItem("sgtur_menu_cache",JSON.stringify({userId:m,acessos:b,isAdmin:_,tipoUsuario:String(f||"").toUpperCase(),userEmail:g.toLowerCase()}))}catch{}C(!0)}const F=()=>j(r=>!r),w=()=>j(!1),i=()=>{typeof window<"u"&&window.innerWidth<=1024&&w()};o.useEffect(()=>{try{const r=window.localStorage.getItem("sgtur_menu_cache");if(r){const n=JSON.parse(r);u(n.userId||null),x(n.acessos||{}),U(!!n.isAdmin),$(n.tipoUsuario||""),D(n.userEmail||"")}}catch{}C(!0),V()},[]);async function J(){E(!0),w(),await is(),E(!1)}const q=(r,n="view")=>{const t=["none","view","create","edit","delete","admin"],c=k[r]??"none";return t.indexOf(c)>=t.indexOf(n)},d=(r,n="view")=>{if(L)return!0;const t=rs[r];return t?q(t,n):!1},B=L,R="app-sidebar",G=N?es.createPortal(s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:"sidebar-mobile-trigger","aria-expanded":l,"aria-controls":R,onClick:F,children:[s.jsx("span",{className:"sidebar-mobile-icon",children:l?"âœ•":"â˜°"}),s.jsx("span",{children:l?"Fechar":"Menu"})]}),s.jsx("div",{className:`sidebar-overlay ${l?"visible":""}`,onClick:w})]}),document.body):null;return s.jsxs(s.Fragment,{children:[G,s.jsxs("aside",{id:R,className:`app-sidebar ${l?"open":""}`,children:[s.jsx("div",{className:"sidebar-logo",children:"SGTUR"}),s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"OperaÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[d("Dashboard")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="dashboard"?"active":""}`,href:"/",onClick:i,children:[s.jsx("span",{children:"ğŸ“Š"}),"Dashboard"]})}),d("Vendas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="vendas"?"active":""}`,href:"/vendas/consulta",onClick:i,children:[s.jsx("span",{children:"ğŸ§¾"}),"Vendas"]})}),d("Orcamentos")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="orcamentos"?"active":""}`,href:"/orcamentos",onClick:i,children:[s.jsx("span",{children:"ğŸ’¼"}),"OrÃ§amentos"]})}),d("Clientes")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="clientes"?"active":""}`,href:"/clientes/carteira",onClick:i,children:[s.jsx("span",{children:"ğŸ‘¥"}),"Clientes"]})})]})]}),d("Cadastros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Cadastros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="paises"?"active":""}`,href:"/cadastros/paises",onClick:i,children:[s.jsx("span",{children:"ğŸŒ"}),"PaÃ­ses"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="estados"?"active":""}`,href:"/cadastros/estados",onClick:i,children:[s.jsx("span",{children:"ğŸ—ºï¸"}),"Estados"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="cidades"?"active":""}`,href:"/cadastros/cidades",onClick:i,children:[s.jsx("span",{children:"ğŸ™ï¸"}),"Cidades"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="produtos"?"active":""}`,href:"/cadastros/produtos",onClick:i,children:[s.jsx("span",{children:"ğŸ«"}),"Produtos"]})})]})]}),d("Relatorios")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"RelatÃ³rios"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas"?"active":""}`,href:"/relatorios/vendas",onClick:i,children:[s.jsx("span",{children:"ğŸ“ˆ"}),"Vendas (detalhado)"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-destino"?"active":""}`,href:"/relatorios/vendas-por-destino",onClick:i,children:[s.jsx("span",{children:"ğŸ“Œ"}),"Vendas por destino"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-produto"?"active":""}`,href:"/relatorios/vendas-por-produto",onClick:i,children:[s.jsx("span",{children:"ğŸ«"}),"Vendas por produto"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-cliente"?"active":""}`,href:"/relatorios/vendas-por-cliente",onClick:i,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Vendas por cliente"]})})]})]}),d("Parametros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"ParÃ¢metros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-tipo-produtos"?"active":""}`,href:"/parametros/tipo-produtos",onClick:i,children:[s.jsx("span",{children:"ğŸ·ï¸"}),"Tipo de Produtos"]})}),d("Metas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-metas"?"active":""}`,href:"/parametros/metas",onClick:i,children:[s.jsx("span",{children:"ğŸ¯"}),"Metas"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros"?"active":""}`,href:"/parametros",onClick:i,children:[s.jsx("span",{children:"âš™ï¸"}),"ParÃ¢metros do Sistema"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="regras-comissao"?"active":""}`,href:"/parametros/regras-comissao",onClick:i,children:[s.jsx("span",{children:"ğŸ’°"}),"Regras de ComissÃ£o"]})})]})]}),v&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Conta"}),s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="perfil"?"active":""}`,href:"/perfil",onClick:i,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Perfil"]})})})]}),B&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"AdministraÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-permissoes"?"active":""}`,href:"/admin/permissoes",onClick:i,children:[s.jsx("span",{children:"âš™ï¸"}),"PermissÃµes"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-logs"?"active":""}`,href:"/dashboard/logs",onClick:i,children:[s.jsx("span",{children:"ğŸ“œ"}),"Logs"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-users"?"active":""}`,href:"/dashboard/admin",onClick:i,children:[s.jsx("span",{children:"ğŸ§‘â€ğŸ’¼"}),"UsuÃ¡rios"]})})]})]}),s.jsx("div",{style:{marginTop:20},children:s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("button",{type:"button",className:"sidebar-link",style:{background:"transparent",border:"none",width:"100%",textAlign:"left"},onClick:J,disabled:A,children:[s.jsx("span",{children:"ğŸšª"}),A?"Saindo...":"Sair"]})})})})]})]})}export{hs as default};
