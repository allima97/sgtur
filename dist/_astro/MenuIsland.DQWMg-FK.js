import{j as s}from"./jsx-runtime.mfZSNocD.js";import{r as t}from"./index.C0Fn7Wtz.js";import{r as B}from"./index.2_Y_w1Vs.js";import{s as p}from"./supabase.Ng8nq9tn.js";import{r as G}from"./logs.DwCrXgEk.js";async function K(){try{const{data:e}=await p.auth.getUser(),N=e?.user?.id||null;let h="";try{h=(await(await fetch("https://api.ipify.org?format=json")).json()).ip||""}catch{}const x=typeof navigator<"u"?navigator.userAgent:"";await G({user_id:N,acao:"logout",modulo:"login",detalhes:{ip:h,userAgent:x}}),await p.auth.signOut(),window.location.href="/auth/login"}catch(e){console.error("Erro ao sair:",e),window.location.href="/auth/login"}}const W={Dashboard:"dashboard",Vendas:"vendas_consulta",Orcamentos:"orcamentos",Clientes:"clientes",Cadastros:"cadastros",Paises:"cadastros_paises",Subdivisoes:"cadastros_estados",Cidades:"cadastros_cidades",Destinos:"cadastros_destinos",Produtos:"cadastros_produtos",Fornecedores:"cadastros_fornecedores",Relatorios:"relatorios",RelatorioVendas:"relatorios_vendas",RelatorioDestinos:"relatorios_destinos",RelatorioProdutos:"relatorios_produtos",RelatorioClientes:"relatorios_clientes",Parametros:"parametros",TipoProdutos:"parametros_tipo_produtos",Metas:"parametros_metas",RegrasComissao:"parametros_regras_comissao",Admin:"admin",AdminDashboard:"admin_dashboard",AdminUsers:"admin_users",AdminLogs:"admin_logs",Operacao:"operacao",Viagens:"operacao_viagens",Comissionamento:"comissionamento"},C=e=>{switch(e){case"admin":return 5;case"delete":return 4;case"edit":return 3;case"create":return 2;case"view":return 1;default:return 0}};function P({activePage:e}){const[N,h]=t.useState(null),[x,j]=t.useState({}),[$,f]=t.useState(!1),[y,L]=t.useState(!1),[z,E]=t.useState(""),[w,A]=t.useState(!1),[c,b]=t.useState(!1),g=Object.values(x).some(a=>a==="admin");t.useEffect(()=>A(!0),[]),t.useEffect(()=>{if(!w)return;const a=window.matchMedia("(max-width: 1024px)"),i=o=>{o.matches||b(!1)};return a.addEventListener?a.addEventListener("change",i):a.addListener(i),()=>{a.removeEventListener?a.removeEventListener("change",i):a.removeListener(i)}},[w]),t.useEffect(()=>{if(!c)return;const a=i=>{i.key==="Escape"&&b(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[c]);const D=()=>b(a=>!a),_=()=>b(!1),r=()=>{typeof window<"u"&&window.innerWidth<=1024&&_()};function M(a,i,o){const m=a[i]??"none";a[i]=C(o)>C(m)?o:m}async function V(){const{data:a}=await p.auth.getSession(),i=a?.session?.user,{data:o}=i?{data:{user:i}}:await p.auth.getUser(),m=o?.user||i||null,u=m?.id||null,S=m?.email||"";if(h(n=>n!==u?u:n),E(n=>n!==S.toLowerCase()?S.toLowerCase():n),!u){$||j({}),f(!0);return}const{data:F,error:J}=await p.from("modulo_acesso").select("modulo, permissao, ativo").eq("usuario_id",u);if(J){f(!0);return}const v={};(F||[]).forEach(n=>{const k=String(n.modulo||"").toLowerCase(),d=String(n.permissao||"none").toLowerCase(),T=d==="admin"||d==="delete"||d==="edit"||d==="create"||d==="view"?d:"none",q=n.ativo?T:"none";k&&M(v,k,q)}),j(n=>{const k=JSON.stringify(n),d=JSON.stringify(v);return k!==d?v:n});try{window.localStorage.setItem("sgtur_menu_cache",JSON.stringify({userId:u,acessos:v,userEmail:S.toLowerCase()}))}catch{}f(!0)}t.useEffect(()=>{try{const a=window.localStorage.getItem("sgtur_menu_cache");if(a){const i=JSON.parse(a);h(i.userId||null),j(i.acessos||{}),E(i.userEmail||"")}}catch{}f(!0),V()},[]);async function R(){L(!0),_(),await K(),L(!1)}const I=(a,i="view")=>{const o=x[String(a||"").toLowerCase()]??"none";return C(o)>=C(i)},l=(a,i="view")=>{if(g)return!0;const o=W[a];return o?I(o,i):!1},O="app-sidebar",U=w?B.createPortal(s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:"sidebar-mobile-trigger","aria-expanded":c,"aria-controls":O,onClick:D,children:[s.jsx("span",{className:"sidebar-mobile-icon",children:c?"âœ•":"â˜°"}),s.jsx("span",{children:c?"Fechar":"Menu"})]}),s.jsx("div",{className:`sidebar-overlay ${c?"visible":""}`,onClick:_})]}),document.body):null;return s.jsxs(s.Fragment,{children:[U,s.jsxs("aside",{id:O,className:`app-sidebar ${c?"open":""}`,children:[s.jsx("div",{className:"sidebar-logo",children:"SGTUR"}),s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"OperaÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[l("Dashboard")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="dashboard"?"active":""}`,href:"/",onClick:r,children:[s.jsx("span",{children:"ğŸ“Š"}),"Dashboard"]})}),l("Vendas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="vendas"?"active":""}`,href:"/vendas/consulta",onClick:r,children:[s.jsx("span",{children:"ğŸ§¾"}),"Vendas"]})}),l("Orcamentos")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="orcamentos"?"active":""}`,href:"/orcamentos",onClick:r,children:[s.jsx("span",{children:"ğŸ’¼"}),"OrÃ§amentos"]})}),l("Comissionamento")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="comissionamento"?"active":""}`,href:"/operacao/comissionamento",onClick:r,children:[s.jsx("span",{children:"ğŸ’°"}),"Comissionamento"]})}),l("Operacao")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="operacao_viagens"?"active":""}`,href:"/operacao/viagens",onClick:r,children:[s.jsx("span",{children:"âœˆï¸"}),"Viagens"]})}),g&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="importar-vendas"?"active":""}`,href:"/gestor/importar-vendas",onClick:r,children:[s.jsx("span",{children:"â¬†ï¸"}),"Importar Vendas"]})}),l("Clientes")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="clientes"?"active":""}`,href:"/clientes/carteira",onClick:r,children:[s.jsx("span",{children:"ğŸ‘¥"}),"Clientes"]})})]})]}),l("Cadastros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Cadastros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="paises"?"active":""}`,href:"/cadastros/paises",onClick:r,children:[s.jsx("span",{children:"ğŸŒ"}),"PaÃ­ses"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="subdivisoes"?"active":""}`,href:"/cadastros/estados",onClick:r,children:[s.jsx("span",{children:"ğŸ—ºï¸"}),"Estado/ProvÃ­ncia"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="cidades"?"active":""}`,href:"/cadastros/cidades",onClick:r,children:[s.jsx("span",{children:"ğŸ™ï¸"}),"Cidades"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="produtos"?"active":""}`,href:"/cadastros/produtos",onClick:r,children:[s.jsx("span",{children:"ğŸ«"}),"Produtos"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="fornecedores"?"active":""}`,href:"/cadastros/fornecedores",onClick:r,children:[s.jsx("span",{children:"ğŸ§"}),"Fornecedores"]})})]})]}),l("Relatorios")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"RelatÃ³rios"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas"?"active":""}`,href:"/relatorios/vendas",onClick:r,children:[s.jsx("span",{children:"ğŸ“ˆ"}),"Vendas (detalhado)"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-destino"?"active":""}`,href:"/relatorios/vendas-por-destino",onClick:r,children:[s.jsx("span",{children:"ğŸ“Œ"}),"Vendas por destino"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-produto"?"active":""}`,href:"/relatorios/vendas-por-produto",onClick:r,children:[s.jsx("span",{children:"ğŸ«"}),"Vendas por produto"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-cliente"?"active":""}`,href:"/relatorios/vendas-por-cliente",onClick:r,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Vendas por cliente"]})})]})]}),l("Parametros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"ParÃ¢metros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-tipo-produtos"?"active":""}`,href:"/parametros/tipo-produtos",onClick:r,children:[s.jsx("span",{children:"ğŸ·ï¸"}),"Tipo de Produtos"]})}),l("Metas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-metas"?"active":""}`,href:"/parametros/metas",onClick:r,children:[s.jsx("span",{children:"ğŸ¯"}),"Metas"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros"?"active":""}`,href:"/parametros",onClick:r,children:[s.jsx("span",{children:"âš™ï¸"}),"ParÃ¢metros do Sistema"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="regras-comissao"?"active":""}`,href:"/parametros/regras-comissao",onClick:r,children:[s.jsx("span",{children:"ğŸ’°"}),"Regras de ComissÃ£o"]})})]})]}),N&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Conta"}),s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="perfil"?"active":""}`,href:"/perfil",onClick:r,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Perfil"]})})})]}),g&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"AdministraÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-permissoes"?"active":""}`,href:"/admin/permissoes",onClick:r,children:[s.jsx("span",{children:"âš™ï¸"}),"PermissÃµes"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-logs"?"active":""}`,href:"/dashboard/logs",onClick:r,children:[s.jsx("span",{children:"ğŸ“œ"}),"Logs"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-users"?"active":""}`,href:"/dashboard/admin",onClick:r,children:[s.jsx("span",{children:"ğŸ§‘"}),"UsuÃ¡rios"]})})]})]}),s.jsx("div",{style:{marginTop:20},children:s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("button",{type:"button",className:"sidebar-link",style:{background:"transparent",border:"none",width:"100%",textAlign:"left"},onClick:R,disabled:y,children:[s.jsx("span",{children:"ğŸšª"}),y?"Saindo...":"Sair"]})})})})]})]})}export{P as default};
