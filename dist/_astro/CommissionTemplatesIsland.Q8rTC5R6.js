import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r}from"./index.C0Fn7Wtz.js";import{s as o}from"./supabase.Ng8nq9tn.js";import{u as M}from"./usePermissao.Bkt8qSjs.js";import{r as f}from"./logs.DwCrXgEk.js";const y={id:"",nome:"",descricao:"",modo:"FIXO",meta_nao_atingida:null,meta_atingida:null,super_meta:null,esc_ativado:!1,esc_inicial_pct:null,esc_final_pct:null,esc_incremento_pct_meta:null,esc_incremento_pct_comissao:null,esc2_ativado:!1,esc2_inicial_pct:null,esc2_final_pct:null,esc2_incremento_pct_meta:null,esc2_incremento_pct_comissao:null,ativo:!0};function U(){const{ativo:S,loading:E}=M("Parametros"),[s,d]=r.useState(y),[c,v]=r.useState(null),[p,I]=r.useState([]),[m,A]=r.useState(""),[x,n]=r.useState(null),[g,j]=r.useState(!1),[_,N]=r.useState(!0),[b,u]=r.useState(null);r.useEffect(()=>{h()},[]);async function h(){try{N(!0),n(null),u(null);const{data:a,error:t}=await o.from("commission_templates").select("*").order("nome",{ascending:!0});if(t)throw t;I(a)}catch(a){console.error(a),n("Erro ao carregar templates.")}finally{N(!1)}}const C=r.useMemo(()=>{if(!m.trim())return p;const a=m.toLowerCase();return p.filter(t=>t.nome.toLowerCase().includes(a)||(t.descricao||"").toLowerCase().includes(a))},[p,m]);function l(a,t){d(i=>({...i,[a]:t}))}async function F(a){if(a.preventDefault(),n(null),u(null),!s.nome.trim()){n("Nome Ã© obrigatÃ³rio.");return}if(s.modo==="FIXO"&&!s.meta_nao_atingida&&!s.meta_atingida&&!s.super_meta){n("Informe ao menos um percentual no modo Fixo.");return}try{j(!0);const t={nome:s.nome.trim(),descricao:s.descricao?.trim()||null,modo:s.modo,meta_nao_atingida:s.meta_nao_atingida,meta_atingida:s.meta_atingida,super_meta:s.super_meta,esc_ativado:s.esc_ativado,esc_inicial_pct:s.esc_inicial_pct,esc_final_pct:s.esc_final_pct,esc_incremento_pct_meta:s.esc_incremento_pct_meta,esc_incremento_pct_comissao:s.esc_incremento_pct_comissao,esc2_ativado:s.esc2_ativado,esc2_inicial_pct:s.esc2_inicial_pct,esc2_final_pct:s.esc2_final_pct,esc2_incremento_pct_meta:s.esc2_incremento_pct_meta,esc2_incremento_pct_comissao:s.esc2_incremento_pct_comissao,ativo:s.ativo};if(c){const{error:i}=await o.from("commission_templates").update(t).eq("id",c);if(i)throw i;await f({user_id:(await o.auth.getUser()).data.user?.id||null,acao:"template_comissao_atualizado",modulo:"Parametros",detalhes:{id:c,payload:t}})}else{const{error:i}=await o.from("commission_templates").insert(t);if(i)throw i;await f({user_id:(await o.auth.getUser()).data.user?.id||null,acao:"template_comissao_criado",modulo:"Parametros",detalhes:{payload:t}})}await h(),w(),u("Template salvo com sucesso.")}catch(t){console.error(t),n("Erro ao salvar template.")}finally{j(!1)}}function w(){v(null),d(y)}function L(a){v(a.id),d(a),u(null),n(null)}async function P(a){if(window.confirm("Excluir este template?"))try{const{error:t}=await o.from("commission_templates").delete().eq("id",a);if(t)throw t;await f({user_id:(await o.auth.getUser()).data.user?.id||null,acao:"template_comissao_excluido",modulo:"Parametros",detalhes:{id:a}}),await h()}catch{n("Erro ao excluir template.")}}return E?e.jsx("div",{children:"Carregando permissÃµes..."}):S?e.jsxs("div",{className:"commission-templates-page",children:[e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome *"}),e.jsx("input",{className:"form-input",value:s.nome,onChange:a=>l("nome",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Modo *"}),e.jsxs("select",{className:"form-select",value:s.modo,onChange:a=>l("modo",a.target.value),children:[e.jsx("option",{value:"FIXO",children:"Fixo"}),e.jsx("option",{value:"ESCALONAVEL",children:"EscalonÃ¡vel"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Ativo"}),e.jsxs("select",{className:"form-select",value:s.ativo?"true":"false",onChange:a=>l("ativo",a.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"NÃ£o"})]})]})]}),s.modo==="FIXO"&&e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"% NÃ£o atingida"}),e.jsx("input",{className:"form-input",type:"number",value:s.meta_nao_atingida??"",min:0,step:"0.1",onChange:a=>l("meta_nao_atingida",a.target.value?Number(a.target.value):null)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"% Atingida"}),e.jsx("input",{className:"form-input",type:"number",value:s.meta_atingida??"",min:0,step:"0.1",onChange:a=>l("meta_atingida",a.target.value?Number(a.target.value):null)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"% Super Meta"}),e.jsx("input",{className:"form-input",type:"number",value:s.super_meta??"",min:0,step:"0.1",onChange:a=>l("super_meta",a.target.value?Number(a.target.value):null)})]})]}),s.modo==="ESCALONAVEL"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-2",children:"Escalonamento 1"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Ativado?"}),e.jsxs("select",{className:"form-select",value:s.esc_ativado?"true":"false",onChange:a=>l("esc_ativado",a.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"NÃ£o"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Inicial %"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc_inicial_pct??"",min:0,step:"0.1",onChange:a=>l("esc_inicial_pct",a.target.value?Number(a.target.value):null)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Final %"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc_final_pct??"",min:0,step:"0.1",onChange:a=>l("esc_final_pct",a.target.value?Number(a.target.value):null)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Incremento % Meta"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc_incremento_pct_meta??"",min:0,step:"0.1",onChange:a=>l("esc_incremento_pct_meta",a.target.value?Number(a.target.value):null)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Incremento % ComissÃ£o"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc_incremento_pct_comissao??"",min:0,step:"0.1",onChange:a=>l("esc_incremento_pct_comissao",a.target.value?Number(a.target.value):null)})]})]}),e.jsx("h3",{className:"mt-2",children:"Escalonamento 2"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Ativado?"}),e.jsxs("select",{className:"form-select",value:s.esc2_ativado?"true":"false",onChange:a=>l("esc2_ativado",a.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"NÃ£o"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Inicial %"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc2_inicial_pct??"",min:0,step:"0.1",onChange:a=>l("esc2_inicial_pct",a.target.value?Number(a.target.value):null)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Final %"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc2_final_pct??"",min:0,step:"0.1",onChange:a=>l("esc2_final_pct",a.target.value?Number(a.target.value):null)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Incremento % Meta"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc2_incremento_pct_meta??"",min:0,step:"0.1",onChange:a=>l("esc2_incremento_pct_meta",a.target.value?Number(a.target.value):null)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Incremento % ComissÃ£o"}),e.jsx("input",{className:"form-input",type:"number",value:s.esc2_incremento_pct_comissao??"",min:0,step:"0.1",onChange:a=>l("esc2_incremento_pct_comissao",a.target.value?Number(a.target.value):null)})]})]})]}),e.jsxs("div",{className:"form-group mt-2",children:[e.jsx("label",{className:"form-label",children:"DescriÃ§Ã£o"}),e.jsx("textarea",{className:"form-input",rows:3,value:s.descricao||"",onChange:a=>l("descricao",a.target.value)})]}),x&&e.jsxs("div",{className:"card-base card-config mb-2",children:[e.jsx("strong",{children:"Erro:"})," ",x]}),b&&e.jsx("div",{className:"card-base card-green mb-2",children:b}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:g,children:g?"Salvando...":c?"Salvar alteraÃ§Ãµes":"Criar template"}),c&&e.jsx("button",{type:"button",className:"btn btn-light",style:{marginLeft:8},onClick:w,children:"Cancelar"})]})}),e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Buscar template"}),e.jsx("input",{className:"form-input",value:m,onChange:a=>A(a.target.value),placeholder:"Busque por nome ou descriÃ§Ã£o..."})]})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[820px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Modo"}),e.jsx("th",{children:"Ativo"}),e.jsx("th",{className:"th-actions",children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[_&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Carregando templates..."})}),!_&&C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Nenhum template encontrado."})}),!_&&C.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome}),e.jsx("td",{children:a.modo}),e.jsx("td",{children:a.ativo?"Sim":"NÃ£o"}),e.jsxs("td",{className:"th-actions flex gap-2",children:[e.jsx("button",{className:"btn-icon",title:"Editar",onClick:()=>L(a),children:"âœï¸"}),e.jsx("button",{className:"btn-icon btn-danger",title:"Excluir",onClick:()=>P(a.id),children:"ğŸ—‘ï¸"})]})]},a.id))]})]})})]}):e.jsx("div",{children:"Acesso bloqueado ao mÃ³dulo ParÃ¢metros."})}export{U as default};
