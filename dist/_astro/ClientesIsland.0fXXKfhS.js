import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r}from"./index.C0Fn7Wtz.js";import{s as d}from"./supabase.Ng8nq9tn.js";import{u as xa}from"./usePermissao.DiLe8-Rs.js";import{r as ve}from"./logs.DwCrXgEk.js";import{t as Ke}from"./titleCase.DQLlfrnh.js";import{L as ja}from"./LoadingUsuarioContext.BaDUNi7o.js";const se={nome:"",nascimento:"",cpf:"",telefone:"",whatsapp:"",email:"",endereco:"",numero:"",complemento:"",cidade:"",estado:"",cep:"",rg:"",genero:"",nacionalidade:"",tags:"",tipo_cliente:"passageiro",company_id:"",notas:"",ativo:!0,active:!0};function wa(){const{permissao:y,ativo:Qe,loading:re}=xa("Clientes"),le=y!=="none",K=y==="create"||y==="edit"||y==="delete"||y==="admin",E=y==="edit"||y==="delete"||y==="admin",A=y==="delete"||y==="admin",[ie,Xe]=r.useState([]),[Q,Ye]=r.useState(""),[_e,P]=r.useState(null),[de,be]=r.useState(!0),[I,Ze]=r.useState(null),[s,T]=r.useState(se),[V,X]=r.useState(null),[ce,Ne]=r.useState(!1),[ye,Ce]=r.useState(null),[j,we]=r.useState(null),[Se,W]=r.useState(null),[Ee,me]=r.useState(!1),[Ae,H]=r.useState(null),[Be,Y]=r.useState(!1),[De,Le]=r.useState([]),[Pe,Re]=r.useState([]),[Fe,ke]=r.useState(!1),[B,Z]=r.useState(null),[ee,z]=r.useState([]),[ea,qe]=r.useState(!1),[R,ae]=r.useState(null);r.useEffect(()=>{let a=!0;async function t(){try{const{data:n}=await d.auth.getSession(),m=n?.session?.user||(await d.auth.getUser()).data?.user||null;if(!m||!a)return;const{data:w,error:_}=await d.from("users").select("company_id").eq("id",m.id).maybeSingle();if(!a)return;if(_){console.error("Erro ao buscar company_id dos clientes:",_);return}Ze(w?.company_id||null)}catch(n){console.error("Erro ao determinar company_id dos clientes:",n)}}return t(),()=>{a=!1}},[]);const[Ie,te]=r.useState([]),[ue,Te]=r.useState(!1),[Ve,v]=r.useState(null),[h,C]=r.useState({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0}),[F,$e]=r.useState(null),[he,Oe]=r.useState(!1),[Me,We]=r.useState(null);async function pe(){if(!(!le||!I))try{be(!0),P(null);const{data:a,error:t}=await d.from("clientes").select("*, company_id").eq("company_id",I).order("nome",{ascending:!0});if(t)throw t;Xe(a||[]),te([]),v(null)}catch(a){console.error(a),P("Erro ao carregar clientes.")}finally{be(!1)}}r.useEffect(()=>{!re&&le&&I&&pe()},[re,le,I]);const He=r.useMemo(()=>{if(!Q.trim())return ie;const a=Q.toLowerCase();return ie.filter(t=>t.nome.toLowerCase().includes(a)||(t.cpf||"").includes(a)||(t.email||"").toLowerCase().includes(a))},[ie,Q]);function u(a,t){T(n=>({...n,[a]:t}))}function aa(a){return a.replace(/\D/g,"").slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}function ze(a){const t=a.replace(/\D/g,"").slice(0,11);return t.length<=10?t.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d)/,"$1-$2"):t.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2")}function fe(a){return a.replace(/\D/g,"").slice(0,8).replace(/(\d{5})(\d)/,"$1-$2")}async function ta(a){const t=(a||"").replace(/\D/g,"");if(t.length!==8){W(null);return}try{W("Buscando endereÃ§o...");const n=await fetch(`https://viacep.com.br/ws/${t}/json/`,{mode:"cors"});if(!n.ok)throw new Error("CEP invÃ¡lido ou indisponÃ­vel.");const p=await n.json();if(p.erro)throw new Error("CEP nÃ£o encontrado.");T(m=>({...m,cep:fe(t),endereco:p.logradouro||"",cidade:p.localidade||"",estado:p.uf||""})),W("EndereÃ§o carregado pelo CEP.")}catch(n){console.error("Erro ao buscar CEP:",n),W("NÃ£o foi possÃ­vel carregar o CEP.")}}function oa(){Y(!1),T(se),X(null),H(null)}async function na(a){we(a),ke(!0);const t=new Set;try{const{data:n}=await d.from("historico_viagens_real").select("id, data_viagem, valor_total, notas, destinos:produtos!destino_id (nome)").eq("cliente_id",a.id).order("data_viagem",{ascending:!1}),p=n?.map(o=>({id:o.id,data_viagem:o.data_viagem,destino_nome:o.destinos?.nome||"",valor_total:o.valor_total??null,notas:o.notas||null}))||[],{data:m}=await d.from("vendas").select("id, data_lancamento, data_embarque, destino_id, destino_cidade_id, destinos:produtos!destino_id (nome, cidade_id)").eq("cliente_id",a.id).order("data_lancamento",{ascending:!1});let w=[],_={};if(m&&m.length>0){const o=m.map(l=>l.id),f=Array.from(new Set(m.map(l=>l.destino_cidade_id||l.destinos?.cidade_id).filter(l=>!!l)));if(f.length>0){const{data:l,error:i}=await d.from("cidades").select("id, nome").in("id",f);i?console.error(i):_=Object.fromEntries((l||[]).map(S=>[S.id,S.nome||""]))}const{data:N}=await d.from("vendas_recibos").select("venda_id, valor_total, valor_taxas, produto_id").in("venda_id",o);(N||[]).forEach(l=>{l.produto_id&&t.add(l.produto_id)});let L=[],x={};if(t.size>0){const l=Array.from(t),{data:i,error:S}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("tipo_produto",l);!S&&i?L=i:S&&console.error(S);const{data:O,error:g}=await d.from("tipo_produtos").select("id, nome").in("id",l);!g&&O?x=Object.fromEntries(O.map(M=>[M.id,M.nome||"Produto"])):g&&console.error(g)}const k=(l,i)=>{if(!l)return"";const S=L.find(g=>{const M=!!g?.todas_as_cidades;return g.tipo_produto===l&&(M||!i||g.cidade_id===i)}),O=x[l]||{};return S?.nome||O||"Produto"};w=m.map(l=>{const i=(N||[]).filter(q=>q.venda_id===l.id),S=i.reduce((q,ge)=>q+(ge.valor_total||0),0),O=i.reduce((q,ge)=>q+(ge.valor_taxas||0),0),g=l.destino_cidade_id||l.destinos?.cidade_id||null,M=i.map(q=>k(q.produto_id,g||void 0)).filter(Boolean),fa=g&&_[g]||"";return{id:l.id,data_lancamento:l.data_lancamento,data_embarque:l.data_embarque,destino_nome:l.destinos?.nome||"",destino_cidade_id:g,destino_cidade_nome:fa,valor_total:S,valor_taxas:O,produtos:M}})}const{data:U}=await d.from("orcamentos").select("id, data_orcamento, status, valor, numero_venda, produto_id, destinos:produtos!destino_id (nome, cidade_id)").eq("cliente_id",a.id).order("data_orcamento",{ascending:!1}),D=(U?.map(o=>o.destinos?.cidade_id).filter(o=>!!o)||[]).filter(o=>!(o in(_||{})));if(D.length>0){const{data:o,error:f}=await d.from("cidades").select("id, nome").in("id",D);f?console.error(f):(o||[]).forEach(N=>{_[N.id]=N.nome||""})}(U?.map(o=>o.produto_id).filter(o=>!!o)||[]).forEach(o=>t.add(o));let b=[],$=[];const xe={},je={},ne=new Set;let Ue={};if(t.size>0){const o=Array.from(t),{data:f,error:N}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("tipo_produto",o);!N&&f?b=f:N&&console.error(N);const{data:L,error:x}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("id",o);!x&&L?($=L,L.forEach(i=>{i.id&&(xe[i.id]=i.nome||"Produto",je[i.id]=i),i.tipo_produto&&ne.add(i.tipo_produto)})):x&&console.error(x),b.forEach(i=>{i.tipo_produto&&ne.add(i.tipo_produto)}),o.forEach(i=>ne.add(i));const{data:k,error:l}=await d.from("tipo_produtos").select("id, nome").in("id",Array.from(ne));!l&&k?Ue=Object.fromEntries(k.map(i=>[i.id,i.nome||"Produto"])):l&&console.error(l)}const Je=(o,f)=>{if(!o)return"";if(je[o]){const x=je[o];if(!!x?.todas_as_cidades||!f||x.cidade_id===f)return x.nome||"Produto"}if(xe[o])return xe[o];const N=b.find(x=>{const k=!!x?.todas_as_cidades;return x.tipo_produto===o&&(k||!f||x.cidade_id===f)}),L=Ue[o]||"Produto";return N?.nome||L};w.length>0&&(w=w.map(o=>({...o,produtos:(o.produtos||[]).map(f=>Je(f,o.destino_cidade_id)).filter(Boolean)})));const pa=U?.map(o=>({id:o.id,data_orcamento:o.data_orcamento,status:o.status,valor:o.valor??null,numero_venda:o.numero_venda??null,destino_nome:o.destinos?.nome||null,destino_cidade_nome:o.destinos?.cidade_id?_[o.destinos?.cidade_id]||"":null,produto_nome:Je(o.produto_id,o.destinos?.cidade_id)}))||[];Le(w),Re(pa)}catch(n){console.error(n),P("Erro ao carregar histÃ³rico do cliente.")}finally{ke(!1),oe(a.id)}}async function oe(a){try{Te(!0),v(null);const{data:t,error:n}=await d.from("cliente_acompanhantes").select("*").eq("cliente_id",a).order("nome_completo",{ascending:!0});if(n)throw n;te(t||[])}catch(t){console.error(t),v("Erro ao carregar acompanhantes."),te([])}finally{Te(!1)}}function Ge(){we(null),Le([]),Re([]),Z(null),z([]),ae(null),te([]),v(null),G(!0)}async function sa(a){Z(a),qe(!0),z([]);try{const{data:t}=await d.from("vendas_recibos").select("id, numero_recibo, valor_total, valor_taxas, produto_id, data_inicio, data_fim").eq("venda_id",a.id),n=(t||[]).map(c=>({id:c.id,numero_recibo:c.numero_recibo,valor_total:c.valor_total,valor_taxas:c.valor_taxas,produto_id:c.produto_id,produto_nome:null,data_inicio:c.data_inicio,data_fim:c.data_fim}))||[],p=Array.from(new Set(n.map(c=>c.produto_id).filter(c=>!!c))),m=a.destino_cidade_id||"";let w=[],_={};if(p.length>0){const{data:c,error:D}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("tipo_produto",p);!D&&c?w=c:D&&console.error(D);const{data:J,error:b}=await d.from("tipo_produtos").select("id, nome").in("id",p);!b&&J?_=Object.fromEntries(J.map($=>[$.id,$.nome||"Produto"])):b&&console.error(b)}const U=c=>{if(!c)return"";const D=w.find(b=>{const $=!!b?.todas_as_cidades;return b.tipo_produto===c&&($||!m||b.cidade_id===m)}),J=_[c]||"Produto";return D?.nome||J};z(n.map(c=>({...c,produto_nome:U(c.produto_id)})))}catch(t){console.error(t),P("Erro ao carregar recibos da venda.")}finally{qe(!1)}}function ra(a){ae(a)}function la(a){E&&(X(a.id),T({nome:a.nome,nascimento:a.nascimento||"",cpf:a.cpf,telefone:a.telefone,whatsapp:a.whatsapp||"",email:a.email||"",endereco:a.endereco||"",numero:a.numero||"",complemento:a.complemento||"",cidade:a.cidade||"",estado:a.estado||"",cep:a.cep||"",rg:a.rg||"",genero:a.genero||"",nacionalidade:a.nacionalidade||"",tags:(a.tags||[]).join(", "),tipo_cliente:a.tipo_cliente||"passageiro",company_id:a.company_id||"",notas:a.notas||"",ativo:a.ativo,active:a.active}),oe(a.id),Y(!0))}async function ia(a){if(a.preventDefault(),!(!K&&!E))try{Ne(!0),P(null),H(null);const n={nome:Ke(s.nome),nascimento:s.nascimento||null,cpf:s.cpf.trim(),telefone:s.telefone.trim(),whatsapp:s.whatsapp.trim()||null,email:s.email.trim()||null,endereco:s.endereco.trim()||null,numero:s.numero.trim()||null,complemento:s.complemento.trim()||null,cidade:s.cidade.trim()||null,estado:s.estado.trim()||null,cep:s.cep.trim()||null,rg:s.rg.trim()||null,genero:s.genero.trim()||null,nacionalidade:s.nacionalidade.trim()||null,tags:s.tags?s.tags.split(",").map(m=>m.trim()):[],tipo_cliente:s.tipo_cliente,notas:s.notas||null,ativo:s.ativo,active:s.active},p=s.company_id.trim();if(p?n.company_id=p:j?.company_id?n.company_id=j.company_id:I&&(n.company_id=I),V){const{error:m}=await d.from("clientes").update(n).eq("id",V);if(m)throw m;await ve({acao:"cliente_editado",modulo:"Clientes",detalhes:{id:V,payload:n}})}else{const{error:m}=await d.from("clientes").insert(n);if(m)throw m;await ve({acao:"cliente_criado",modulo:"Clientes",detalhes:n})}T(se),X(null),Y(!1),H(V?"Cliente atualizado com sucesso.":"Cliente criado com sucesso."),await pe()}catch(t){console.error(t),P("Erro ao salvar cliente."),H(null)}finally{Ne(!1)}}async function da(a){if(A&&window.confirm("Excluir cliente?"))try{Ce(a);const{error:t}=await d.from("clientes").delete().eq("id",a);if(t)throw t;await ve({acao:"cliente_excluido",modulo:"Clientes",detalhes:{id:a}}),await pe()}catch{P("NÃ£o foi possÃ­vel excluir este cliente.")}finally{Ce(null)}}function G(a=!1){C({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0}),$e(null),a&&me(!1)}function ca(a){$e(a.id),C({nome_completo:a.nome_completo||"",cpf:a.cpf||"",telefone:a.telefone||"",grau_parentesco:a.grau_parentesco||"",rg:a.rg||"",data_nascimento:a.data_nascimento||"",observacoes:a.observacoes||"",ativo:a.ativo}),me(!0)}async function ma(){if(!j){v("Selecione um cliente antes de salvar acompanhante.");return}const a=j.company_id||null;if(!a){v("Cliente sem company_id definido para salvar acompanhante.");return}const t={cliente_id:j.id,company_id:a,nome_completo:h.nome_completo.trim(),cpf:h.cpf?.trim()||null,telefone:h.telefone?.trim()||null,grau_parentesco:h.grau_parentesco?.trim()||null,rg:h.rg?.trim()||null,data_nascimento:h.data_nascimento||null,observacoes:h.observacoes?.trim()||null,ativo:h.ativo};if(!t.nome_completo){v("Informe o nome completo do acompanhante.");return}try{if(Oe(!0),v(null),F){const{error:n}=await d.from("cliente_acompanhantes").update(t).eq("id",F).eq("cliente_id",j.id);if(n)throw n}else{const{error:n}=await d.from("cliente_acompanhantes").insert(t);if(n)throw n}G(!0),await oe(j.id)}catch(n){console.error(n),v("Erro ao salvar acompanhante.")}finally{Oe(!1)}}async function ua(a){if(!(!A||!j)&&window.confirm("Remover acompanhante?"))try{We(a),v(null);const{error:t}=await d.from("cliente_acompanhantes").delete().eq("id",a).eq("cliente_id",j.id);if(t)throw t;F===a&&G(!0),await oe(j.id)}catch(t){console.error(t),v("Erro ao remover acompanhante.")}finally{We(null)}}if(re)return e.jsx(ja,{});if(!Qe)return e.jsx("div",{className:"card-base card-config",children:e.jsx("strong",{children:"Acesso negado ao mÃ³dulo de Clientes."})});const ha=!K&&!E;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"clientes-page",children:[!ha&&Be&&e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:ia,children:[e.jsx("h3",{children:V?"Editar cliente":"Novo cliente"}),e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"grid",gridTemplateColumns:"minmax(0, 2fr) repeat(5, minmax(0, 1fr))",gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome completo *"}),e.jsx("input",{className:"form-input",value:s.nome,onChange:a=>u("nome",a.target.value),onBlur:a=>u("nome",Ke(a.target.value)),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF *"}),e.jsx("input",{className:"form-input",value:s.cpf,onChange:a=>u("cpf",aa(a.target.value)),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"RG"}),e.jsx("input",{className:"form-input",value:s.rg,onChange:a=>u("rg",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nascimento"}),e.jsx("input",{type:"date",className:"form-input",value:s.nascimento,onChange:a=>u("nascimento",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"GÃªnero"}),e.jsxs("select",{className:"form-select",value:s.genero,onChange:a=>u("genero",a.target.value),children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"Masculino",children:"Masculino"}),e.jsx("option",{value:"Feminino",children:"Feminino"}),e.jsx("option",{value:"Outros",children:"Outros"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nacionalidade"}),e.jsx("input",{className:"form-input",value:s.nacionalidade,onChange:a=>u("nacionalidade",a.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone *"}),e.jsx("input",{className:"form-input",value:s.telefone,onChange:a=>u("telefone",ze(a.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Whatsapp"}),e.jsx("input",{className:"form-input",value:s.whatsapp,onChange:a=>u("whatsapp",ze(a.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"E-mail"}),e.jsx("input",{className:"form-input",value:s.email,onChange:a=>u("email",a.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"grid",gridTemplateColumns:"minmax(0, 0.75fr) minmax(0, 1.7fr) minmax(0, 0.8fr) minmax(0, 0.9fr) minmax(0, 0.9fr) minmax(0, 0.9fr)",gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CEP"}),e.jsx("input",{className:"form-input",value:s.cep,onChange:a=>u("cep",fe(a.target.value)),onBlur:a=>{const t=fe(a.target.value);u("cep",t),t.replace(/\D/g,"").length===8?ta(t):W(null)}}),e.jsx("small",{style:{color:Se?.includes("NÃ£o foi")?"#b91c1c":"#475569"},children:Se||"Preencha para auto-preencher endereÃ§o."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"EndereÃ§o"}),e.jsx("input",{className:"form-input",value:s.endereco,onChange:a=>u("endereco",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"NÃºmero"}),e.jsx("input",{className:"form-input",value:s.numero,onChange:a=>u("numero",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Complemento"}),e.jsx("input",{className:"form-input",value:s.complemento,onChange:a=>u("complemento",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cidade"}),e.jsx("input",{className:"form-input",value:s.cidade,onChange:a=>u("cidade",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsx("input",{className:"form-input",value:s.estado,onChange:a=>u("estado",a.target.value)})]})]}),e.jsx("div",{className:"form-row",style:{marginTop:12},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Notas"}),e.jsx("textarea",{className:"form-textarea",rows:3,value:s.notas,onChange:a=>u("notas",a.target.value),placeholder:"InformaÃ§Ãµes adicionais"})]})}),e.jsxs("div",{className:"mt-2",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-primary",disabled:ce,type:"submit",children:ce?"Salvando...":V?"Salvar alteraÃ§Ãµes":"Salvar"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:oa,disabled:ce,children:"Cancelar"})]})]})}),Ae&&e.jsx("div",{className:"card-base card-green mb-3",children:e.jsx("strong",{children:Ae})}),e.jsx("div",{className:"card-base mb-3",children:e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1 1 300px"},children:[e.jsx("label",{className:"form-label",children:"Buscar cliente"}),e.jsx("input",{className:"form-input",value:Q,onChange:a=>Ye(a.target.value),placeholder:"Nome, CPF ou e-mail"})]}),K&&e.jsx("div",{className:"form-group",style:{alignItems:"flex-end"},children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{T(se),X(null),H(null),Y(!0)},disabled:Be,children:"Adicionar cliente"})})]})}),_e&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:_e})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[960px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CPF"}),e.jsx("th",{children:"Telefone"}),e.jsx("th",{children:"E-mail"}),e.jsx("th",{style:{textAlign:"center"},children:"Ativo"}),(E||A)&&e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[de&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Carregando..."})}),!de&&He.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhum cliente encontrado."})}),!de&&He.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome}),e.jsx("td",{children:a.cpf}),e.jsx("td",{children:a.telefone}),e.jsx("td",{children:a.email||"-"}),e.jsx("td",{style:{textAlign:"center"},children:a.active?"Sim":"NÃ£o"}),(E||A)&&e.jsxs("td",{className:"th-actions",style:{textAlign:"center"},children:[e.jsx("button",{className:"btn-icon",onClick:()=>na(a),title:"HistÃ³rico",children:"ðŸ—‚ï¸"}),E&&e.jsx("button",{className:"btn-icon",onClick:()=>la(a),title:"Editar",children:"âœï¸"}),A&&e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>da(a.id),disabled:ye===a.id,title:"Excluir",children:ye===a.id?"...":"ðŸ—‘ï¸"})]})]},a.id))]})]})})]}),j&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:1100,width:"95vw"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"modal-title",style:{color:"#1d4ed8",fontSize:"1.2rem",fontWeight:800},children:["HistÃ³rico de ",j.nome]}),e.jsx("small",{style:{color:"#64748b"},children:"Vendas e orÃ§amentos do cliente"})]}),e.jsx("button",{className:"btn-ghost",onClick:Ge,children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[Fe&&e.jsx("p",{children:"Carregando histÃ³rico..."}),!Fe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-base card-blue mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"Acompanhantes do cliente"}),Ve&&e.jsx("div",{style:{color:"red",marginBottom:8},children:Ve}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CPF"}),e.jsx("th",{children:"Telefone"}),e.jsx("th",{children:"Parentesco"}),e.jsx("th",{children:"Ativo"}),(E||A)&&e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[ue&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Carregando acompanhantes..."})}),!ue&&Ie.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhum acompanhante cadastrado."})}),!ue&&Ie.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome_completo}),e.jsx("td",{children:a.cpf||"-"}),e.jsx("td",{children:a.telefone||"-"}),e.jsx("td",{children:a.grau_parentesco||"-"}),e.jsx("td",{children:a.ativo?"Sim":"NÃ£o"}),(E||A)&&e.jsxs("td",{className:"th-actions",style:{textAlign:"center",display:"flex",gap:6,justifyContent:"center"},children:[E&&e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>ca(a),title:"Editar",children:"âœï¸"}),A&&e.jsx("button",{className:"btn-icon btn-danger",type:"button",onClick:()=>ua(a.id),disabled:Me===a.id,title:"Excluir",children:Me===a.id?"...":"ðŸ—‘ï¸"})]})]},a.id))]})]})}),K&&e.jsxs("div",{className:"card-base",style:{marginTop:12,border:"1px dashed #cbd5e1",background:"#f8fafc"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:F?"Editar acompanhante":"Adicionar acompanhante"}),!Ee&&!F&&e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{G(),me(!0)},children:"Adicionar acompanhante"}),(Ee||F)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome completo"}),e.jsx("input",{className:"form-input",value:h.nome_completo,onChange:a=>C(t=>({...t,nome_completo:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF"}),e.jsx("input",{className:"form-input",value:h.cpf,onChange:a=>C(t=>({...t,cpf:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone"}),e.jsx("input",{className:"form-input",value:h.telefone,onChange:a=>C(t=>({...t,telefone:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Parentesco"}),e.jsx("input",{className:"form-input",value:h.grau_parentesco,onChange:a=>C(t=>({...t,grau_parentesco:a.target.value})),placeholder:"Ex: Esposa, Filho"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"RG"}),e.jsx("input",{className:"form-input",value:h.rg,onChange:a=>C(t=>({...t,rg:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data nascimento"}),e.jsx("input",{type:"date",className:"form-input",value:h.data_nascimento,onChange:a=>C(t=>({...t,data_nascimento:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ObservaÃ§Ãµes"}),e.jsx("input",{className:"form-input",value:h.observacoes,onChange:a=>C(t=>({...t,observacoes:a.target.value}))})]}),e.jsxs("div",{className:"form-group",style:{alignSelf:"flex-end"},children:[e.jsx("label",{className:"form-label",children:"Ativo"}),e.jsx("input",{type:"checkbox",checked:h.ativo,onChange:a=>C(t=>({...t,ativo:a.target.checked}))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn btn-primary",type:"button",onClick:ma,disabled:he,children:he?"Salvando...":F?"Salvar alteraÃ§Ãµes":"Salvar"}),e.jsx("button",{className:"btn btn-light",type:"button",onClick:()=>G(!0),disabled:he,children:"Cancelar"})]})]})]})]}),e.jsxs("div",{className:"card-base mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"Vendas"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[820px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data LanÃ§amento"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Embarque"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Taxas"}),e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[De.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhuma venda encontrada."})}),De.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.data_lancamento?new Date(a.data_lancamento).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{children:a.destino_cidade_nome||"-"}),e.jsx("td",{children:a.data_embarque?new Date(a.data_embarque).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{children:a.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:a.valor_taxas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{className:"th-actions",style:{textAlign:"center"},children:e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>sa(a),title:"Ver detalhes",children:"ðŸ‘ï¸"})})]},a.id))]})]})})]}),e.jsxs("div",{className:"card-base card-blue mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"OrÃ§amentos do cliente"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[760px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[Pe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:"Nenhum orÃ§amento encontrado."})}),Pe.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.data_orcamento?new Date(a.data_orcamento).toLocaleDateString("pt-BR").replaceAll("/","-"):"-"}),e.jsx("td",{style:{textTransform:"capitalize"},children:a.status||"-"}),e.jsx("td",{children:a.destino_cidade_nome||"-"}),e.jsx("td",{children:a.produto_nome||"-"}),e.jsx("td",{children:(a.valor??0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:a.numero_venda||"-"}),e.jsx("td",{className:"th-actions",style:{textAlign:"center"},children:e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>ra(a),title:"Ver detalhes",children:"ðŸ‘ï¸"})})]},a.id))]})]})})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:Ge,children:"Fechar"})})]})}),B&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:720},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{children:e.jsx("div",{className:"modal-title",style:{color:"#16a34a",fontSize:"1.15rem",fontWeight:800},children:"Detalhes da venda"})}),e.jsx("button",{className:"btn-ghost",onClick:()=>{Z(null),z([])},children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{style:{display:"grid",gap:6,lineHeight:1.4,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Recibo:"})," ",ee.length>0?ee.map(a=>a.numero_recibo||"-").join(", "):"â€”"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Destino:"})," ",B.destino_cidade_nome||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"LanÃ§amento:"})," ",new Date(B.data_lancamento).toLocaleDateString("pt-BR")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Embarque:"})," ",B.data_embarque?new Date(B.data_embarque).toLocaleDateString("pt-BR"):"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor:"})," ",B.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Taxas:"})," ",B.valor_taxas===0?"-":B.valor_taxas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]}),e.jsx("h4",{style:{marginBottom:8,textAlign:"center"},children:"Recibos"}),ea?e.jsx("p",{children:"Carregando recibos..."}):e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue",style:{minWidth:520},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"NÃºmero"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{style:{textAlign:"center"},children:"InÃ­cio"}),e.jsx("th",{style:{textAlign:"center"},children:"Fim"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Taxas"})]})}),e.jsxs("tbody",{children:[ee.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Nenhum recibo encontrado."})}),ee.map((a,t)=>{const n=p=>p?new Date(p).toLocaleDateString("pt-BR"):"-";return e.jsxs("tr",{children:[e.jsx("td",{children:a.numero_recibo||"-"}),e.jsx("td",{children:a.produto_nome||"-"}),e.jsx("td",{style:{textAlign:"center"},children:n(a.data_inicio)}),e.jsx("td",{style:{textAlign:"center"},children:n(a.data_fim)}),e.jsx("td",{children:(a.valor_total||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:(a.valor_taxas||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},t)})]})]})})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{Z(null),z([])},children:"Fechar"})})]})}),R&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:640},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"modal-title",style:{color:"#1d4ed8",fontSize:"1.15rem",fontWeight:800},children:"Detalhes do orÃ§amento"}),e.jsxs("small",{style:{color:"#64748b"},children:["Destino: ",R.destino_nome||"-"]})]}),e.jsx("button",{className:"btn-ghost",onClick:()=>ae(null),children:"âœ•"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{style:{display:"grid",gap:6,lineHeight:1.4,marginBottom:4},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Data:"})," ",R.data_orcamento?new Date(R.data_orcamento).toLocaleDateString("pt-BR"):"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",R.status||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor:"})," ",(R.valor||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Venda vinculada:"})," ",R.numero_venda||"-"]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:()=>ae(null),children:"Fechar"})})]})})]})}export{wa as default};
