import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as o}from"./index.C0Fn7Wtz.js";import{s as x}from"./supabase.Ng8nq9tn.js";import{u as k}from"./usePermissao.Bkt8qSjs.js";import{t as _}from"./titleCase.DQLlfrnh.js";function q(l){return(l||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}const j={nome:"",codigo_iso:"",continente:""};function M(){const[l,F]=o.useState([]),[p,b]=o.useState(!0),[v,n]=o.useState(null),[r,I]=o.useState(""),[i,m]=o.useState(j),[N,w]=o.useState(!1),[u,g]=o.useState(null),[C,S]=o.useState(null),{permissao:c,ativo:B,loading:D}=k("Cadastros"),[d,P]=o.useState(!1);async function f(s=!1){try{b(!0),n(null);const a=x.from("paises").select("id, nome, codigo_iso, continente, created_at").order(s?"nome":"created_at",{ascending:!s}).limit(s?void 0:10),{data:t,error:y}=await a;if(y)throw y;F(t||[]),P(s||!1)}catch(a){console.error(a),n("Erro ao carregar paÃ­ses. Verifique se a tabela 'paises' existe e se as colunas estÃ£o corretas.")}finally{b(!1)}}o.useEffect(()=>{f(!1)},[]),o.useEffect(()=>{r.trim()&&!d&&f(!0)},[r,d]);const E=o.useMemo(()=>{if(!r.trim())return l;const s=q(r);return l.filter(a=>q(a.nome).includes(s))},[r,l]);function h(s,a){m(t=>({...t,[s]:a}))}function V(){m(j),g(null),n(null)}function z(s){g(s.id),m({nome:s.nome,codigo_iso:s.codigo_iso||"",continente:s.continente||""})}async function R(s){if(s.preventDefault(),c==="view"){n("VocÃª nÃ£o tem permissÃ£o para salvar paÃ­ses.");return}if(!i.nome.trim()){n("Nome Ã© obrigatÃ³rio.");return}try{w(!0),n(null);const a=_(i.nome);if(u){const{error:t}=await x.from("paises").update({nome:a,codigo_iso:i.codigo_iso.trim()||null,continente:i.continente.trim()||null}).eq("id",u);if(t)throw t}else{const{error:t}=await x.from("paises").insert({nome:a,codigo_iso:i.codigo_iso.trim()||null,continente:i.continente.trim()||null});if(t)throw t}m(j),g(null),await f(d)}catch(a){console.error(a),n("Erro ao salvar paÃ­s. Verifique se o nome Ã© Ãºnico.")}finally{w(!1)}}async function T(s){if(c!=="admin"){window.alert("Somente administradores podem excluir paÃ­ses.");return}if(window.confirm("Tem certeza que deseja excluir este paÃ­s?"))try{S(s),n(null);const{error:a}=await x.from("paises").delete().eq("id",s);if(a)throw a;await f(d)}catch(a){console.error(a),n("NÃ£o foi possÃ­vel excluir o paÃ­s. Verifique se nÃ£o existem destinos vinculados.")}finally{S(null)}}return D?e.jsx("div",{className:"paises-page",children:"Carregando permissÃµes..."}):B?e.jsxs("div",{className:"paises-page",children:[e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome do paÃ­s *"}),e.jsx("input",{className:"form-input",value:i.nome,onChange:s=>h("nome",s.target.value),onBlur:s=>h("nome",_(s.target.value)),placeholder:"Ex: Brasil, Estados Unidos, FranÃ§a..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CÃ³digo ISO"}),e.jsx("input",{className:"form-input",value:i.codigo_iso,onChange:s=>h("codigo_iso",s.target.value),placeholder:"Ex: BR, US, FR..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Continente"}),e.jsx("input",{className:"form-input",value:i.continente,onChange:s=>h("continente",s.target.value),placeholder:"Ex: AmÃ©rica do Sul, Europa..."})]})]}),e.jsxs("div",{className:"mt-2",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:N||c==="view",children:N?"Salvando...":u?"Salvar alteraÃ§Ãµes":"Adicionar paÃ­s"}),u&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:V,children:"Cancelar ediÃ§Ã£o"})]})]})}),e.jsx("div",{className:"card-base mb-3",children:e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Buscar paÃ­s"}),e.jsx("input",{className:"form-input",value:r,onChange:s=>I(s.target.value),placeholder:"Digite parte do nome..."})]})})}),!d&&e.jsx("div",{className:"card-base card-config mb-3",children:"Ãšltimos PaÃ­ses Cadastrados (10). Digite na busca para consultar todos."}),v&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:v})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[520px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CÃ³digo ISO"}),e.jsx("th",{children:"Continente"}),e.jsx("th",{children:"Criado em"}),e.jsx("th",{className:"th-actions",children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[p&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Carregando paÃ­ses..."})}),!p&&E.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Nenhum paÃ­s encontrado."})}),!p&&E.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome}),e.jsx("td",{children:s.codigo_iso||"-"}),e.jsx("td",{children:s.continente||"-"}),e.jsx("td",{children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"th-actions",children:c!=="view"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",title:"Editar",onClick:()=>z(s),children:"âœï¸"}),c==="admin"&&e.jsx("button",{className:"btn-icon btn-danger",title:"Excluir",onClick:()=>T(s.id),disabled:C===s.id,children:C===s.id?"...":"ğŸ—‘ï¸"})]})})]},s.id))]})]})})]}):e.jsx("div",{className:"paises-page",children:"VocÃª nÃ£o possui acesso ao mÃ³dulo de Cadastros."})}export{M as default};
