import{j as e,s as m}from"./supabase.CWKfsr2i.js";import{r as l}from"./index.DVhKKaGN.js";import{u as O}from"./usePermissao.LURrmXgT.js";const b={nome:"",pais_id:"",cidade_id:"",tipo:"",atracao_principal:"",melhor_epoca:"",duracao_sugerida:"",nivel_preco:"",imagem_url:"",informacoes_importantes:"",ativo:!0};function J(){const{permissao:o,ativo:q,loading:L}=O("Cadastros"),[f,M]=l.useState([]),[c,A]=l.useState([]),[N,V]=l.useState([]),[v,w]=l.useState(!0),[C,t]=l.useState(null),[u,B]=l.useState(""),[i,p]=l.useState(b),[E,S]=l.useState(!1),[h,x]=l.useState(null),[y,D]=l.useState(null);async function j(){try{w(!0),t(null);const[{data:a,error:s},{data:r,error:d},{data:g,error:P}]=await Promise.all([m.from("paises").select("id, nome").order("nome",{ascending:!0}),m.from("cidades").select("id, nome, pais_id").order("nome",{ascending:!0}),m.from("destinos").select("id, nome, cidade_id, informacoes_importantes, tipo, atracao_principal, melhor_epoca, duracao_sugerida, nivel_preco, imagem_url, ativo, created_at").order("nome",{ascending:!0})]);if(s)throw s;if(d)throw d;if(P)throw P;M(a||[]),A(r||[]),V(g||[])}catch(a){console.error(a),t("Erro ao carregar destinos. Verifique se as tabelas 'paises', 'cidades' e 'destinos' existem e se as colunas estÃ£o corretas.")}finally{w(!1)}}l.useEffect(()=>{j()},[]);const F=l.useMemo(()=>i.pais_id?c.filter(a=>a.pais_id===i.pais_id):c,[c,i.pais_id]),_=l.useMemo(()=>{const a=new Map(c.map(r=>[r.id,r])),s=new Map(f.map(r=>[r.id,r]));return N.map(r=>{const d=a.get(r.cidade_id||""),g=d?s.get(d.pais_id):void 0;return{...r,cidade_nome:d?.nome||"",pais_nome:g?.nome||""}})},[N,c,f]),I=l.useMemo(()=>{if(!u.trim())return _;const a=u.toLowerCase();return _.filter(s=>s.nome.toLowerCase().includes(a)||s.cidade_nome.toLowerCase().includes(a)||s.pais_nome.toLowerCase().includes(a))},[_,u]);function n(a,s){p(r=>({...r,[a]:s,...a==="pais_id"?{cidade_id:""}:{}}))}function R(){x(null),p(b)}function T(a){const r=c.find(d=>d.id===a.cidade_id)?.pais_id||"";x(a.id),p({nome:a.nome,pais_id:r,cidade_id:a.cidade_id,tipo:a.tipo||"",atracao_principal:a.atracao_principal||"",melhor_epoca:a.melhor_epoca||"",duracao_sugerida:a.duracao_sugerida||"",nivel_preco:a.nivel_preco||"",imagem_url:a.imagem_url||"",informacoes_importantes:a.informacoes_importantes||"",ativo:a.ativo??!0})}async function k(a){if(a.preventDefault(),o==="view"){t("VocÃª nÃ£o tem permissÃ£o para salvar destinos.");return}if(!i.nome.trim()){t("Nome Ã© obrigatÃ³rio.");return}if(!i.cidade_id){t("Cidade Ã© obrigatÃ³ria.");return}try{S(!0),t(null);const s={nome:i.nome.trim(),cidade_id:i.cidade_id,tipo:i.tipo.trim()||null,atracao_principal:i.atracao_principal.trim()||null,melhor_epoca:i.melhor_epoca.trim()||null,duracao_sugerida:i.duracao_sugerida.trim()||null,nivel_preco:i.nivel_preco.trim()||null,imagem_url:i.imagem_url.trim()||null,informacoes_importantes:i.informacoes_importantes.trim()||null,ativo:i.ativo};if(h){const{error:r}=await m.from("destinos").update(s).eq("id",h);if(r)throw r}else{const{error:r}=await m.from("destinos").insert(s);if(r)throw r}p(b),x(null),await j()}catch(s){console.error(s),t("Erro ao salvar destino. Verifique os dados e tente novamente.")}finally{S(!1)}}async function z(a){if(o!=="admin"){alert("Somente administradores podem excluir destinos.");return}if(window.confirm("Tem certeza que deseja excluir este destino?"))try{D(a),t(null);const{error:s}=await m.from("destinos").delete().eq("id",a);if(s)throw s;await j()}catch(s){console.error(s),t("NÃ£o foi possÃ­vel excluir o destino. Verifique se nÃ£o existem vendas vinculadas.")}finally{D(null)}}return L?e.jsx("div",{children:"Carregando permissÃµes..."}):q?e.jsxs("div",{className:"destinos-page",children:[e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome do destino *"}),e.jsx("input",{className:"form-input",value:i.nome,onChange:a=>n("nome",a.target.value),placeholder:"Ex: Orlando, Paris, Gramado...",disabled:o==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"PaÃ­s *"}),e.jsxs("select",{className:"form-select",value:i.pais_id,onChange:a=>n("pais_id",a.target.value),disabled:o==="view",children:[e.jsx("option",{value:"",children:"Selecione um paÃ­s"}),f.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cidade *"}),e.jsxs("select",{className:"form-select",value:i.cidade_id,onChange:a=>n("cidade_id",a.target.value),disabled:o==="view",children:[e.jsx("option",{value:"",children:"Selecione uma cidade"}),F.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tipo"}),e.jsx("input",{className:"form-input",value:i.tipo,onChange:a=>n("tipo",a.target.value),placeholder:"Ex: Cidade, Praia, Parque, Serra...",disabled:o==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"AtraÃ§Ã£o principal"}),e.jsx("input",{className:"form-input",value:i.atracao_principal,onChange:a=>n("atracao_principal",a.target.value),placeholder:"Ex: Disney, Torre Eiffel, Centro HistÃ³rico...",disabled:o==="view"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Melhor Ã©poca"}),e.jsx("input",{className:"form-input",value:i.melhor_epoca,onChange:a=>n("melhor_epoca",a.target.value),placeholder:"Ex: Dezembro a MarÃ§o",disabled:o==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"DuraÃ§Ã£o sugerida"}),e.jsx("input",{className:"form-input",value:i.duracao_sugerida,onChange:a=>n("duracao_sugerida",a.target.value),placeholder:"Ex: 7 dias",disabled:o==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"NÃ­vel de preÃ§o"}),e.jsx("input",{className:"form-input",value:i.nivel_preco,onChange:a=>n("nivel_preco",a.target.value),placeholder:"Ex: EconÃ´mico, IntermediÃ¡rio, Premium",disabled:o==="view"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Imagem (URL)"}),e.jsx("input",{className:"form-input",value:i.imagem_url,onChange:a=>n("imagem_url",a.target.value),placeholder:"URL de uma imagem do destino",disabled:o==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Ativo"}),e.jsxs("select",{className:"form-select",value:i.ativo?"true":"false",onChange:a=>n("ativo",a.target.value==="true"),disabled:o==="view",children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"NÃ£o"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"InformaÃ§Ãµes importantes"}),e.jsx("textarea",{className:"form-input",rows:3,value:i.informacoes_importantes,onChange:a=>n("informacoes_importantes",a.target.value),placeholder:"ObservaÃ§Ãµes gerais, dicas, documentaÃ§Ã£o necessÃ¡ria, etc.",disabled:o==="view"})]}),e.jsxs("div",{className:"mt-2",children:[o!=="view"&&e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:E,children:E?"Salvando...":h?"Salvar alteraÃ§Ãµes":"Adicionar destino"}),h&&o!=="view"&&e.jsx("button",{type:"button",className:"btn btn-light",style:{marginLeft:8},onClick:R,children:"Cancelar ediÃ§Ã£o"})]})]})}),e.jsx("div",{className:"card-base mb-3",children:e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Buscar destino"}),e.jsx("input",{className:"form-input",value:u,onChange:a=>B(a.target.value),placeholder:"Busque por nome, cidade ou paÃ­s..."})]})})}),C&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:C})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[960px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Cidade"}),e.jsx("th",{children:"PaÃ­s"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"NÃ­vel de preÃ§o"}),e.jsx("th",{children:"Ativo"}),e.jsx("th",{children:"Criado em"}),e.jsx("th",{className:"th-actions",children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[v&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:"Carregando destinos..."})}),!v&&I.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:"Nenhum destino encontrado."})}),!v&&I.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome}),e.jsx("td",{children:a.cidade_nome||"-"}),e.jsx("td",{children:a.pais_nome||"-"}),e.jsx("td",{children:a.tipo||"-"}),e.jsx("td",{children:a.nivel_preco||"-"}),e.jsx("td",{children:a.ativo?"Sim":"NÃ£o"}),e.jsx("td",{children:a.created_at?new Date(a.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsxs("td",{className:"th-actions",children:[o!=="view"&&e.jsx("button",{className:"btn-icon",title:"Editar",onClick:()=>T(a),children:"âœï¸"}),o==="admin"&&e.jsx("button",{className:"btn-icon btn-danger",title:"Excluir",onClick:()=>z(a.id),disabled:y===a.id,children:y===a.id?"...":"ğŸ—‘ï¸"})]})]},a.id))]})]})})]}):e.jsx("div",{children:"VocÃª nÃ£o possui acesso ao mÃ³dulo de Cadastros."})}export{J as default};
