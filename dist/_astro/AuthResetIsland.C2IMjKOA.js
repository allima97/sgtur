import{j as e,s as d}from"./supabase.DNkd6bxA.js";import{r}from"./index.C0Fn7Wtz.js";import{r as u}from"./logs.WCvMC_es.js";function S(){const[n,h]=r.useState(""),[m,f]=r.useState(""),[p,a]=r.useState(""),[v,x]=r.useState(!1),[i,l]=r.useState(!1),[g,j]=r.useState(!1);r.useEffect(()=>{const s=new URL(window.location.href).searchParams.get("code");async function c(){if(!s){a("Link de recuperação inválido ou expirado.");return}l(!0);const{error:t}=await d.auth.exchangeCodeForSession(s);t?(console.error(t),a("Link de recuperação inválido ou expirado."),await u({user_id:null,acao:"reset_link_invalido",modulo:"login",detalhes:{motivo:t.message}})):j(!0),l(!1)}c()},[]);async function N(o){if(o.preventDefault(),a(""),x(!1),!g){a("Link de recuperação inválido ou expirado.");return}if(n.length<6){a("A senha deve ter ao menos 6 caracteres.");return}if(n!==m){a("As senhas não conferem.");return}l(!0);try{const{error:s}=await d.auth.updateUser({password:n}),{data:c}=await d.auth.getUser(),t=c?.user?.id??null;if(s){a("Não foi possível alterar a senha."),await u({user_id:t,acao:"reset_senha_falhou",modulo:"login",detalhes:{motivo:s.message}});return}await u({user_id:t,acao:"reset_senha_sucesso",modulo:"login",detalhes:{}}),x(!0),h(""),f(""),setTimeout(()=>{window.location.href="/auth/login"},1200)}catch(s){console.error(s),a("Erro inesperado ao alterar senha.")}finally{l(!1)}}return e.jsx("div",{className:"auth-container",children:e.jsxs("div",{className:"auth-card",children:[e.jsxs("div",{className:"auth-header",children:[e.jsx("div",{className:"auth-icon",children:e.jsx("i",{className:"fa-solid fa-plane-departure"})}),e.jsx("h1",{children:"Definir nova senha"}),e.jsx("h2",{className:"auth-subtitle",children:"Crie uma nova senha para voltar a usar o SGTUR."})]}),p&&e.jsx("div",{className:"alert alert-danger",style:{marginBottom:16},children:p}),v&&e.jsx("div",{className:"alert alert-success",style:{marginBottom:16},children:"Senha alterada com sucesso! Redirecionando..."}),e.jsxs("form",{onSubmit:N,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"senha",children:[e.jsx("i",{className:"fa-solid fa-lock"})," Nova senha"]}),e.jsx("input",{type:"password",id:"senha",className:"form-control",placeholder:"Mínimo 6 caracteres",required:!0,autoComplete:"new-password",value:n,onChange:o=>h(o.target.value),disabled:i})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"confirmar",children:[e.jsx("i",{className:"fa-solid fa-lock"})," Confirmar nova senha"]}),e.jsx("input",{type:"password",id:"confirmar",className:"form-control",placeholder:"Repita a senha",required:!0,value:m,onChange:o=>f(o.target.value),disabled:i})]}),e.jsxs("div",{className:"auth-actions",children:[e.jsxs("button",{type:"submit",className:"btn btn-primary btn-block",disabled:i,children:[e.jsx("i",{className:"fa-solid fa-key"}),i?" Salvando...":" Salvar nova senha"]}),e.jsx("div",{className:"auth-divider",children:e.jsx("span",{children:"ou"})}),e.jsxs("a",{href:"/auth/login",className:"btn btn-secondary btn-block",children:[e.jsx("i",{className:"fa-solid fa-right-to-bracket"}),"Voltar ao login"]})]})]})]})})}export{S as default};
