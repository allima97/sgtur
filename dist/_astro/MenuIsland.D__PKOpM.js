import{j as s}from"./jsx-runtime.mfZSNocD.js";import{r as l}from"./index.C0Fn7Wtz.js";import{r as W}from"./index.2_Y_w1Vs.js";import{s as x}from"./supabase.Ng8nq9tn.js";import{r as Y}from"./logs.DwCrXgEk.js";import{S as G}from"./systemName.C2UUyvSH.js";async function H(){try{const{data:a}=await x.auth.getUser(),u=a?.user?.id||null;let p="";try{p=(await(await fetch("https://api.ipify.org?format=json")).json()).ip||""}catch{}const j=typeof navigator<"u"?navigator.userAgent:"";await Y({user_id:u,acao:"logout",modulo:"login",detalhes:{ip:p,userAgent:j}}),await x.auth.signOut(),window.location.href="/auth/login"}catch(a){console.error("Erro ao sair:",a),window.location.href="/auth/login"}}const L={Dashboard:"dashboard",Vendas:"vendas_consulta",Orcamentos:"orcamentos",Clientes:"clientes",Cadastros:"cadastros",Paises:"cadastros_paises",Subdivisoes:"cadastros_estados",Cidades:"cadastros_cidades",Destinos:"cadastros_destinos",Produtos:"cadastros_produtos",Fornecedores:"cadastros_fornecedores",Relatorios:"relatorios",RelatorioVendas:"relatorios_vendas",RelatorioDestinos:"relatorios_destinos",RelatorioProdutos:"relatorios_produtos",RelatorioClientes:"relatorios_clientes",Parametros:"parametros",TipoProdutos:"parametros_tipo_produtos",Metas:"parametros_metas",RegrasComissao:"parametros_regras_comissao",Admin:"admin",AdminDashboard:"admin_dashboard",AdminUsers:"admin_users",AdminLogs:"admin_logs",Operacao:"operacao",Viagens:"operacao_viagens",Comissionamento:"comissionamento"},Q=Object.keys(L).reduce((a,u)=>(a[u.toLowerCase()]=L[u],a),{}),w=a=>{switch(a){case"admin":return 5;case"delete":return 4;case"edit":return 3;case"create":return 2;case"view":return 1;default:return 0}};function ns({activePage:a}){const[u,p]=l.useState(null),[j,f]=l.useState({}),[y,b]=l.useState(!1),[E,$]=l.useState(!1),[X,O]=l.useState(""),[N,V]=l.useState(!1),[h,v]=l.useState(!1),g=Object.values(j).some(e=>e==="admin");l.useEffect(()=>V(!0),[]),l.useEffect(()=>{if(!N)return;const e=window.matchMedia("(max-width: 1024px)"),r=n=>{n.matches||v(!1)};return e.addEventListener?e.addEventListener("change",r):e.addListener(r),()=>{e.removeEventListener?e.removeEventListener("change",r):e.removeListener(r)}},[N]),l.useEffect(()=>{if(!h)return;const e=r=>{r.key==="Escape"&&v(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h]);const I=()=>v(e=>!e),S=()=>v(!1),i=()=>{typeof window<"u"&&window.innerWidth<=1024&&S()};function M(e,r,n){const c=r.toLowerCase(),d=e[c]??"none";e[c]=w(n)>w(d)?n:d}function R(e,r,n){const c=r.toLowerCase();M(e,c,n);const d=Q[c];d&&M(e,d,n)}async function U(){const{data:e}=await x.auth.getSession(),r=e?.session?.user,{data:n}=r?{data:{user:r}}:await x.auth.getUser(),c=n?.user||r||null,d=c?.id||null,_=c?.email||"";if(p(o=>o!==d?d:o),O(o=>o!==_.toLowerCase()?_.toLowerCase():o),!d){y||f({}),b(!0);return}const{data:z,error:K}=await x.from("modulo_acesso").select("modulo, permissao, ativo").eq("usuario_id",d);if(K){b(!0);return}const C={};(z||[]).forEach(o=>{const k=String(o.modulo||"").toLowerCase(),m=String(o.permissao||"none").toLowerCase(),P=m==="admin"||m==="delete"||m==="edit"||m==="create"||m==="view"?m:"none",B=o.ativo?P:"none";k&&R(C,k,B)}),f(o=>{const k=JSON.stringify(o),m=JSON.stringify(C);return k!==m?C:o});try{window.localStorage.setItem("sgtur_menu_cache",JSON.stringify({userId:d,acessos:C,userEmail:_.toLowerCase()}))}catch{}b(!0)}l.useEffect(()=>{try{const e=window.localStorage.getItem("sgtur_menu_cache");if(e){const r=JSON.parse(e);p(r.userId||null),f(r.acessos||{}),O(r.userEmail||"")}}catch{}b(!0),U()},[]);async function F(){$(!0),S(),await H(),$(!1)}const J=(e,r="view")=>{const n=j[String(e||"").toLowerCase()]??"none";return w(n)>=w(r)},t=(e,r="view")=>{if(g)return!0;const n=L[e];return n?J(n,r):!1},A=[{name:"Paises",href:"/cadastros/paises",active:"paises",icon:"ğŸŒ",label:"PaÃ­ses"},{name:"Subdivisoes",href:"/cadastros/estados",active:"subdivisoes",icon:"ğŸ—ºï¸",label:"Estado/ProvÃ­ncia"},{name:"Cidades",href:"/cadastros/cidades",active:"cidades",icon:"ğŸ™ï¸",label:"Cidades"},{name:"Produtos",href:"/cadastros/produtos",active:"produtos",icon:"ğŸ«",label:"Produtos"},{name:"Fornecedores",href:"/cadastros/fornecedores",active:"fornecedores",icon:"ğŸ§",label:"Fornecedores"}],T=A.some(e=>t(e.name)),D="app-sidebar",q=N?W.createPortal(s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:"sidebar-mobile-trigger","aria-expanded":h,"aria-controls":D,onClick:I,children:[s.jsx("span",{className:"sidebar-mobile-icon",children:h?"âœ•":"â˜°"}),s.jsx("span",{children:h?"Fechar":"Menu"})]}),s.jsx("div",{className:`sidebar-overlay ${h?"visible":""}`,onClick:S})]}),document.body):null;return s.jsxs(s.Fragment,{children:[q,s.jsxs("aside",{id:D,className:`app-sidebar ${h?"open":""}`,children:[s.jsx("div",{className:"sidebar-logo",children:G}),s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"OperaÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[t("Dashboard")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="dashboard"?"active":""}`,href:"/",onClick:i,children:[s.jsx("span",{children:"ğŸ“Š"}),"Dashboard"]})}),t("Vendas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="vendas"?"active":""}`,href:"/vendas/consulta",onClick:i,children:[s.jsx("span",{children:"ğŸ§¾"}),"Vendas"]})}),t("Orcamentos")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="orcamentos"?"active":""}`,href:"/orcamentos",onClick:i,children:[s.jsx("span",{children:"ğŸ’¼"}),"OrÃ§amentos"]})}),t("Comissionamento")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="comissionamento"?"active":""}`,href:"/operacao/comissionamento",onClick:i,children:[s.jsx("span",{children:"ğŸ’°"}),"Comissionamento"]})}),t("Operacao")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="operacao_viagens"?"active":""}`,href:"/operacao/viagens",onClick:i,children:[s.jsx("span",{children:"âœˆï¸"}),"Viagens"]})}),g&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="importar-vendas"?"active":""}`,href:"/gestor/importar-vendas",onClick:i,children:[s.jsx("span",{children:"â¬†ï¸"}),"Importar Vendas"]})}),t("Clientes")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="clientes"?"active":""}`,href:"/clientes/carteira",onClick:i,children:[s.jsx("span",{children:"ğŸ‘¥"}),"Clientes"]})})]})]}),T&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Cadastros"}),s.jsx("ul",{className:"sidebar-nav",children:A.filter(e=>t(e.name)).map(e=>s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a===e.active?"active":""}`,href:e.href,onClick:i,children:[s.jsx("span",{children:e.icon}),e.label]})},e.name))})]}),t("Relatorios")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"RelatÃ³rios"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="relatorios-vendas"?"active":""}`,href:"/relatorios/vendas",onClick:i,children:[s.jsx("span",{children:"ğŸ“ˆ"}),"Vendas (detalhado)"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="relatorios-vendas-destino"?"active":""}`,href:"/relatorios/vendas-por-destino",onClick:i,children:[s.jsx("span",{children:"ğŸ“Œ"}),"Vendas por destino"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="relatorios-vendas-produto"?"active":""}`,href:"/relatorios/vendas-por-produto",onClick:i,children:[s.jsx("span",{children:"ğŸ«"}),"Vendas por produto"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="relatorios-vendas-cliente"?"active":""}`,href:"/relatorios/vendas-por-cliente",onClick:i,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Vendas por cliente"]})})]})]}),t("Parametros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"ParÃ¢metros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="parametros-tipo-produtos"?"active":""}`,href:"/parametros/tipo-produtos",onClick:i,children:[s.jsx("span",{children:"ğŸ·ï¸"}),"Tipo de Produtos"]})}),t("Metas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="parametros-metas"?"active":""}`,href:"/parametros/metas",onClick:i,children:[s.jsx("span",{children:"ğŸ¯"}),"Metas"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="parametros"?"active":""}`,href:"/parametros",onClick:i,children:[s.jsx("span",{children:"âš™ï¸"}),"ParÃ¢metros do Sistema"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="regras-comissao"?"active":""}`,href:"/parametros/regras-comissao",onClick:i,children:[s.jsx("span",{children:"ğŸ’°"}),"Regras de ComissÃ£o"]})})]})]}),u&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Conta"}),s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="perfil"?"active":""}`,href:"/perfil",onClick:i,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Perfil"]})})})]}),g&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"AdministraÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="admin-permissoes"?"active":""}`,href:"/admin/permissoes",onClick:i,children:[s.jsx("span",{children:"âš™ï¸"}),"PermissÃµes"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="admin-logs"?"active":""}`,href:"/dashboard/logs",onClick:i,children:[s.jsx("span",{children:"ğŸ“œ"}),"Logs"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${a==="admin-users"?"active":""}`,href:"/dashboard/admin",onClick:i,children:[s.jsx("span",{children:"ğŸ§‘"}),"UsuÃ¡rios"]})})]})]}),s.jsx("div",{style:{marginTop:20},children:s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("button",{type:"button",className:"sidebar-link",style:{background:"transparent",border:"none",width:"100%",textAlign:"left"},onClick:F,disabled:E,children:[s.jsx("span",{children:"ğŸšª"}),E?"Saindo...":"Sair"]})})})})]})]})}export{ns as default};
