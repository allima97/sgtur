import{j as s}from"./jsx-runtime.mfZSNocD.js";import{r as o}from"./index.C0Fn7Wtz.js";import{r as es}from"./index.2_Y_w1Vs.js";import{s as h}from"./supabase.Ng8nq9tn.js";import{r as as}from"./logs.DwCrXgEk.js";async function is(){try{const{data:e}=await h.auth.getUser(),v=e?.user?.id||null;let p="";try{p=(await(await fetch("https://api.ipify.org?format=json")).json()).ip||""}catch{}const k=typeof navigator<"u"?navigator.userAgent:"";await as({user_id:v,acao:"logout",modulo:"login",detalhes:{ip:p,userAgent:k}}),await h.auth.signOut(),window.location.href="/auth/login"}catch(e){console.error("Erro ao sair:",e),window.location.href="/auth/login"}}const ns={Dashboard:"dashboard",Vendas:"vendas_consulta",Orcamentos:"orcamentos",Clientes:"clientes",Cadastros:"cadastros",Paises:"cadastros_paises",Subdivisoes:"cadastros_estados",Cidades:"cadastros_cidades",Destinos:"cadastros_destinos",Produtos:"cadastros_produtos",Relatorios:"relatorios",RelatorioVendas:"relatorios_vendas",RelatorioDestinos:"relatorios_destinos",RelatorioProdutos:"relatorios_produtos",RelatorioClientes:"relatorios_clientes",Parametros:"parametros",TipoProdutos:"parametros_tipo_produtos",Metas:"parametros_metas",RegrasComissao:"parametros_regras_comissao",Admin:"admin",AdminDashboard:"admin_dashboard",AdminUsers:"admin_users",AdminLogs:"admin_logs"};function ps({activePage:e}){const[v,p]=o.useState(null),[k,x]=o.useState({}),[O,rs]=o.useState(!1),[I,C]=o.useState(!1),[$,E]=o.useState(!1),[os,L]=o.useState(""),[N,U]=o.useState(!1),[ts,D]=o.useState(""),[w,V]=o.useState(!1),[l,j]=o.useState(!1);o.useEffect(()=>{V(!0)},[]),o.useEffect(()=>{if(!w)return;const n=window.matchMedia("(max-width: 1024px)"),r=d=>{d.matches||j(!1)};return n.addEventListener?n.addEventListener("change",r):n.addListener(r),()=>{n.removeEventListener?n.removeEventListener("change",r):n.removeListener(r)}},[w]),o.useEffect(()=>{if(!l)return;const n=r=>{r.key==="Escape"&&j(!1)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[l]);async function T(){const{data:n}=await h.auth.getSession(),r=n?.session?.user,{data:d}=r?{data:{user:r}}:await h.auth.getUser(),c=d?.user||r||null,m=c?.id||null,S=c?.email||"",K=c?.user_metadata?.tipo||"",_=c?.app_metadata?.roles||[],W=c?.app_metadata?.role||"",z=Array.isArray(_)&&_.length>0?_.join(","):W,f=[K,z].filter(Boolean).join(", ");if(p(i=>i!==m?m:i),L(i=>i!==String(f||"").toUpperCase()?String(f||"").toUpperCase():i),D(i=>i!==S.toLowerCase()?S.toLowerCase():i),!m){I||x({}),C(!0);return}const{data:H}=await h.from("users").select("user_types(name)").eq("id",m).maybeSingle(),Q=H?.user_types?.name||"",X=String(Q||"").toUpperCase(),M=["ADMIN","ADMINISTRADOR","SUPER","MASTER"],Y=M.some(i=>f.toUpperCase().includes(i)),Z=M.some(i=>X.includes(i)),y=Y||Z;U(i=>i!==y?y:i);const{data:P}=await h.from("modulo_acesso").select("modulo, permissao, ativo").eq("usuario_id",m),b={};(P||[]).forEach(i=>{const A=i.modulo.toLowerCase(),u=(i.permissao||"none").toLowerCase(),ss=["view","create","edit","delete","admin"].includes(u)?u:u==="none"?"none":"view";b[A]=i.ativo?ss:"none"}),x(i=>{const A=JSON.stringify(i),u=JSON.stringify(b);return A!==u?b:i});try{window.localStorage.setItem("sgtur_menu_cache",JSON.stringify({userId:m,acessos:b,isAdmin:y,tipoUsuario:String(f||"").toUpperCase(),userEmail:S.toLowerCase()}))}catch{}C(!0)}const F=()=>j(n=>!n),g=()=>j(!1),a=()=>{typeof window<"u"&&window.innerWidth<=1024&&g()};o.useEffect(()=>{try{const n=window.localStorage.getItem("sgtur_menu_cache");if(n){const r=JSON.parse(n);p(r.userId||null),x(r.acessos||{}),U(!!r.isAdmin),L(r.tipoUsuario||""),D(r.userEmail||"")}}catch{}C(!0),T()},[]);async function J(){E(!0),g(),await is(),E(!1)}const q=(n,r="view")=>{const d=["none","view","create","edit","delete","admin"],c=k[n]??"none";return d.indexOf(c)>=d.indexOf(r)},t=(n,r="view")=>{if(N)return!0;const d=ns[n];return d?q(d,r):!1},B=N,R="app-sidebar",G=w?es.createPortal(s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:"sidebar-mobile-trigger","aria-expanded":l,"aria-controls":R,onClick:F,children:[s.jsx("span",{className:"sidebar-mobile-icon",children:l?"âœ•":"â˜°"}),s.jsx("span",{children:l?"Fechar":"Menu"})]}),s.jsx("div",{className:`sidebar-overlay ${l?"visible":""}`,onClick:g})]}),document.body):null;return s.jsxs(s.Fragment,{children:[G,s.jsxs("aside",{id:R,className:`app-sidebar ${l?"open":""}`,children:[s.jsx("div",{className:"sidebar-logo",children:"SGTUR"}),s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"OperaÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[t("Dashboard")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="dashboard"?"active":""}`,href:"/",onClick:a,children:[s.jsx("span",{children:"ğŸ“Š"}),"Dashboard"]})}),t("Vendas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="vendas"?"active":""}`,href:"/vendas/consulta",onClick:a,children:[s.jsx("span",{children:"ğŸ§¾"}),"Vendas"]})}),t("Orcamentos")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="orcamentos"?"active":""}`,href:"/orcamentos",onClick:a,children:[s.jsx("span",{children:"ğŸ’¼"}),"OrÃ§amentos"]})}),t("Vendas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="comissionamento"?"active":""}`,href:"/operacao/comissionamento",onClick:a,children:[s.jsx("span",{children:"ğŸ’°"}),"Comissionamento"]})}),N&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="importar-vendas"?"active":""}`,href:"/gestor/importar-vendas",onClick:a,children:[s.jsx("span",{children:"â¬†ï¸"}),"Importar Vendas"]})}),t("Clientes")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="clientes"?"active":""}`,href:"/clientes/carteira",onClick:a,children:[s.jsx("span",{children:"ğŸ‘¥"}),"Clientes"]})})]})]}),t("Cadastros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Cadastros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="paises"?"active":""}`,href:"/cadastros/paises",onClick:a,children:[s.jsx("span",{children:"ğŸŒ"}),"PaÃ­ses"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="subdivisoes"?"active":""}`,href:"/cadastros/estados",onClick:a,children:[s.jsx("span",{children:"ğŸ—ºï¸"}),"Estado/ProvÃ­ncia"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="cidades"?"active":""}`,href:"/cadastros/cidades",onClick:a,children:[s.jsx("span",{children:"ğŸ™ï¸"}),"Cidades"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="produtos"?"active":""}`,href:"/cadastros/produtos",onClick:a,children:[s.jsx("span",{children:"ğŸ«"}),"Produtos"]})})]})]}),t("Relatorios")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"RelatÃ³rios"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas"?"active":""}`,href:"/relatorios/vendas",onClick:a,children:[s.jsx("span",{children:"ğŸ“ˆ"}),"Vendas (detalhado)"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-destino"?"active":""}`,href:"/relatorios/vendas-por-destino",onClick:a,children:[s.jsx("span",{children:"ğŸ“Œ"}),"Vendas por destino"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-produto"?"active":""}`,href:"/relatorios/vendas-por-produto",onClick:a,children:[s.jsx("span",{children:"ğŸ«"}),"Vendas por produto"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-cliente"?"active":""}`,href:"/relatorios/vendas-por-cliente",onClick:a,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Vendas por cliente"]})})]})]}),t("Parametros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"ParÃ¢metros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-tipo-produtos"?"active":""}`,href:"/parametros/tipo-produtos",onClick:a,children:[s.jsx("span",{children:"ğŸ·ï¸"}),"Tipo de Produtos"]})}),t("Metas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-metas"?"active":""}`,href:"/parametros/metas",onClick:a,children:[s.jsx("span",{children:"ğŸ¯"}),"Metas"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros"?"active":""}`,href:"/parametros",onClick:a,children:[s.jsx("span",{children:"âš™ï¸"}),"ParÃ¢metros do Sistema"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="regras-comissao"?"active":""}`,href:"/parametros/regras-comissao",onClick:a,children:[s.jsx("span",{children:"ğŸ’°"}),"Regras de ComissÃ£o"]})})]})]}),v&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Conta"}),s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="perfil"?"active":""}`,href:"/perfil",onClick:a,children:[s.jsx("span",{children:"ğŸ‘¤"}),"Perfil"]})})})]}),B&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"AdministraÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-permissoes"?"active":""}`,href:"/admin/permissoes",onClick:a,children:[s.jsx("span",{children:"âš™ï¸"}),"PermissÃµes"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-logs"?"active":""}`,href:"/dashboard/logs",onClick:a,children:[s.jsx("span",{children:"ğŸ“œ"}),"Logs"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-users"?"active":""}`,href:"/dashboard/admin",onClick:a,children:[s.jsx("span",{children:"ğŸ§‘â€ğŸ’¼"}),"UsuÃ¡rios"]})})]})]}),s.jsx("div",{style:{marginTop:20},children:s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("button",{type:"button",className:"sidebar-link",style:{background:"transparent",border:"none",width:"100%",textAlign:"left"},onClick:J,disabled:$,children:[s.jsx("span",{children:"ğŸšª"}),$?"Saindo...":"Sair"]})})})})]})]})}export{ps as default};
