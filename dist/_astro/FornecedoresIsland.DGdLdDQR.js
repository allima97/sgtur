import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as i}from"./index.C0Fn7Wtz.js";import{s as m}from"./supabase.Ng8nq9tn.js";import{u as W}from"./usePermissao.DiLe8-Rs.js";import{L as B}from"./LoadingUsuarioContext.BaDUNi7o.js";const R=[{value:"brasil",label:"Brasil"},{value:"exterior",label:"Exterior"}],F=[{value:"pre_pago",label:"Pré-Pago"},{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"}],u={nome_completo:"",nome_fantasia:"",localizacao:"brasil",cnpj:"",cep:"",cidade:"",estado:"",telefone:"",whatsapp:"",telefone_emergencia:"",responsavel:"",tipo_faturamento:"pre_pago",principais_servicos:""};function U(t){const p=F.find(f=>f.value===t);return p?p.label:t||"-"}function M(t){return t==="brasil"?"Brasil":t==="exterior"?"Exterior":t||"-"}function X(){const{permissao:t,ativo:p,loading:f}=W("Cadastros"),[d,I]=i.useState(null),[v,z]=i.useState([]),[r,l]=i.useState(u),[h,j]=i.useState(!0),[x,b]=i.useState(!1),[g,N]=i.useState(null),[y,c]=i.useState(null),[_,C]=i.useState(!1);i.useEffect(()=>{let a=!0;async function s(){try{const{data:n}=await m.auth.getSession(),S=n?.session?.user||(await m.auth.getUser()).data?.user||null;if(!S||!a)return;const{data:O,error:E}=await m.from("users").select("company_id").eq("id",S.id).maybeSingle();if(!a)return;if(E){console.error("Erro ao buscar company_id dos fornecedores:",E);return}I(O?.company_id||null)}catch(n){console.error("Erro ao determinar company_id dos fornecedores:",n)}}return s(),()=>{a=!1}},[]),i.useEffect(()=>{d&&w()},[d]);async function w(){if(d){j(!0),N(null);try{const{data:a,error:s}=await m.from("fornecedores").select("id, nome_completo, nome_fantasia, localizacao, cidade, estado, telefone, whatsapp, responsavel, tipo_faturamento, principais_servicos, created_at").eq("company_id",d).order("created_at",{ascending:!1});if(s)throw s;z(a||[])}catch(a){console.error(a),N("Erro ao carregar fornecedores.")}finally{j(!1)}}}function P(){return r.nome_completo.trim()?r.nome_fantasia.trim()?r.cidade.trim()?r.estado.trim()?r.telefone.trim()?r.whatsapp.trim()?r.telefone_emergencia.trim()?r.responsavel.trim()?r.tipo_faturamento?r.principais_servicos.trim()?r.localizacao==="brasil"&&!r.cnpj.trim()?"Informe o CNPJ.":r.localizacao==="brasil"&&!r.cep.trim()?"Informe o CEP.":null:"Descreva os principais serviços.":"Escolha o tipo de faturamento.":"Informe o responsável.":"Informe o telefone de emergência.":"Informe o WhatsApp.":"Informe o telefone.":"Informe o estado.":"Informe a cidade.":"Informe o nome fantasia.":"Informe o nome completo."}function A(){l(u),c(null),C(!0)}function T(){l(u),c(null),C(!1)}const o=t!=="view"&&k(t);async function L(){if(!d){c("Não foi possível determinar sua empresa.");return}if(!o){c("Sua permissão não permite salvar fornecedores.");return}const a=P();if(a){c(a);return}try{b(!0),c(null);const s={...r,company_id:d,tipo_faturamento:r.tipo_faturamento,principais_servicos:r.principais_servicos.trim()},{error:n}=await m.from("fornecedores").insert(s);if(n)throw n;l(u),await w()}catch(s){console.error(s),c("Erro ao criar fornecedor.")}finally{b(!1)}}return f?e.jsx(B,{}):p?e.jsxs("div",{className:"card-base card-purple",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:"Fornecedores"}),e.jsx("small",{style:{color:"#94a3b8"},children:"Cadastre parceiros nacionais e internacionais."})]}),o&&e.jsx("button",{type:"button",className:"btn btn-primary",onClick:A,disabled:_,children:"Adicionar fornecedor"})]}),_&&e.jsxs("div",{className:"card-base card-blue",style:{marginTop:12,padding:16},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"Novo fornecedor"}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Localização"}),e.jsx("div",{style:{display:"flex",gap:12},children:R.map(a=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"radio",name:"localizacao",value:a.value,checked:r.localizacao===a.value,onChange:s=>l(n=>({...n,localizacao:s.target.value})),disabled:!o}),a.label]},a.value))})]})}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Nome completo"}),e.jsx("input",{className:"form-input",value:r.nome_completo,onChange:a=>l(s=>({...s,nome_completo:a.target.value})),disabled:!o,placeholder:"Razão social"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Nome fantasia"}),e.jsx("input",{className:"form-input",value:r.nome_fantasia,onChange:a=>l(s=>({...s,nome_fantasia:a.target.value})),disabled:!o,placeholder:"Nome comercial"})]})]}),r.localizacao==="brasil"&&e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"CNPJ"}),e.jsx("input",{className:"form-input",value:r.cnpj,onChange:a=>l(s=>({...s,cnpj:a.target.value})),disabled:!o,placeholder:"00.000.000/0000-00"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"CEP"}),e.jsx("input",{className:"form-input",value:r.cep,onChange:a=>l(s=>({...s,cep:a.target.value})),disabled:!o,placeholder:"00000-000"})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Cidade"}),e.jsx("input",{className:"form-input",value:r.cidade,onChange:a=>l(s=>({...s,cidade:a.target.value})),disabled:!o,placeholder:"Cidade principal de atuação"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsx("input",{className:"form-input",value:r.estado,onChange:a=>l(s=>({...s,estado:a.target.value})),disabled:!o,placeholder:"UF / região"})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Telefone"}),e.jsx("input",{className:"form-input",value:r.telefone,onChange:a=>l(s=>({...s,telefone:a.target.value})),disabled:!o,placeholder:"(00) 0000-0000"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"WhatsApp"}),e.jsx("input",{className:"form-input",value:r.whatsapp,onChange:a=>l(s=>({...s,whatsapp:a.target.value})),disabled:!o,placeholder:"+55 00 00000-0000"})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Telefone emergência"}),e.jsx("input",{className:"form-input",value:r.telefone_emergencia,onChange:a=>l(s=>({...s,telefone_emergencia:a.target.value})),disabled:!o,placeholder:"Contato alternativo"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Responsável"}),e.jsx("input",{className:"form-input",value:r.responsavel,onChange:a=>l(s=>({...s,responsavel:a.target.value})),disabled:!o,placeholder:"Pessoa de contato"})]})]}),e.jsx("div",{className:"form-row",style:{gap:12},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Tipo de faturamento"}),e.jsx("select",{className:"form-select",value:r.tipo_faturamento,onChange:a=>l(s=>({...s,tipo_faturamento:a.target.value})),disabled:!o,children:F.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Principais serviços"}),e.jsx("textarea",{className:"form-textarea",value:r.principais_servicos,onChange:a=>l(s=>({...s,principais_servicos:a.target.value})),disabled:!o,placeholder:"Descreva BR/EX serviços oferecidos",rows:3})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:L,disabled:x||!o,children:x?"Salvando...":"Salvar fornecedor"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:T,disabled:x,children:"Cancelar"})]}),y&&e.jsx("div",{style:{color:"red",marginTop:8},children:y})]}),e.jsxs("div",{className:"card-base",style:{marginTop:16},children:[e.jsx("h3",{style:{marginBottom:8},children:"Fornecedores cadastrados"}),g&&e.jsx("div",{style:{color:"red",marginBottom:8},children:g}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome fantasia"}),e.jsx("th",{children:"Local"}),e.jsx("th",{children:"Faturamento"}),e.jsx("th",{children:"Contato"}),e.jsx("th",{children:"Serviços"})]})}),e.jsxs("tbody",{children:[h&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Carregando fornecedores..."})}),!h&&v.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Nenhum fornecedor cadastrado."})}),!h&&v.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome_fantasia||a.nome_completo||"-"}),e.jsxs("td",{children:[M(a.localizacao),a.cidade?` • ${a.cidade}`:"",a.estado?`/${a.estado}`:""]}),e.jsx("td",{children:U(a.tipo_faturamento)}),e.jsxs("td",{children:[a.telefone||"-",a.whatsapp&&` • WhatsApp: ${a.whatsapp}`]}),e.jsx("td",{style:{maxWidth:240,whiteSpace:"normal"},children:a.principais_servicos?a.principais_servicos.length>80?`${a.principais_servicos.slice(0,80)}...`:a.principais_servicos:"-"})]},a.id))]})]})})]})]}):e.jsx("div",{children:"Você não possui acesso ao módulo de Cadastros."})}function k(t){return t&&t!=="none"}export{X as default};
