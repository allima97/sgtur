import{r as n}from"./index.C0Fn7Wtz.js";import{s as h}from"./supabase.Ng8nq9tn.js";const o=a=>{switch(a){case"admin":return 5;case"delete":return 4;case"edit":return 3;case"create":return 2;case"view":return 1;default:return 0}},f=a=>{const e=(a||"").toLowerCase();return e==="admin"?"admin":e==="delete"?"delete":e==="edit"?"edit":e==="create"?"create":e==="view"?"view":"none"};function _(a){const e=(a||"").trim(),[u,c]=n.useState("none"),[A,l]=n.useState(!1),[E,m]=n.useState(!!e);n.useEffect(()=>{let s=!1;if(!e){c("none"),l(!1),m(!1);return}async function B(){m(!0),c("none"),l(!1);try{const{data:d}=await h.auth.getSession(),p=d?.session?.user;if(!p)return;const{data:P,error:v}=await h.from("modulo_acesso").select("permissao, ativo").eq("usuario_id",p.id).ilike("modulo",e);if(s)return;if(v){console.error("Erro ao carregar permiss찾o do m처dulo",e,v);return}const S=P||[];let r=null;for(const i of S){if(!r){r=i;continue}const w=!!i.ativo,y=!!r.ativo;if(w!==y){w&&(r=i);continue}const L=o(f(i.permissao)),V=o(f(r.permissao));L>V&&(r=i)}if(!r){l(!1),c("none");return}const g=!!r.ativo,x=f(r.permissao);l(g),c(g?x:"none")}catch(d){s||console.error("Erro ao buscar permiss찾o do m처dulo",e,d)}finally{s||m(!1)}}return B(),()=>{s=!0}},[e]);const t=n.useMemo(()=>o(u),[u]);return{permissao:u,ativo:A,loading:E,nivel:t,isAdmin:u==="admin",podeVer:t>=o("view"),podeCriar:t>=o("create"),podeEditar:t>=o("edit"),podeExcluir:t>=o("delete"),has:s=>t>=o(s)}}export{_ as u};
