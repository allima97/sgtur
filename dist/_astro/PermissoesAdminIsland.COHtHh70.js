import{j as s,s as i}from"./supabase.DNkd6bxA.js";import{r as t}from"./index.C0Fn7Wtz.js";import{u as U}from"./usePermissao.72SYthuA.js";const p=["Dashboard","Clientes","Vendas","Orcamentos","Cadastros","Paises","Cidades","Destinos","Produtos","Relatorios","Parametros","Metas","RegrasComissao","Admin","AdminDashboard","AdminLogs","AdminUsers"];function D(){const{permissao:h,ativo:x,loading:f}=U("AdminDashboard"),[j,g]=t.useState([]),[y,n]=t.useState([]),[v,l]=t.useState(!0),[c,m]=t.useState(null),[b,_]=t.useState(!1);if(t.useEffect(()=>{async function e(){const{data:o}=await i.auth.getUser();if(!o?.user)return;const{data:a}=await i.from("users").select("id, user_types(name)").eq("id",o.user.id).maybeSingle(),r=Array.isArray(a?.user_types)&&a.user_types.length>0&&a.user_types[0].name?.toUpperCase()||"";_(r.includes("ADMIN"))}e()},[]),f)return s.jsx("div",{children:"Carregando permissões..."});if(!x||!b)return s.jsx("div",{style:{padding:20},children:s.jsx("h3",{children:"Apenas administradores podem acessar este módulo."})});t.useEffect(()=>{async function e(){try{l(!0),m(null);const{data:o}=await i.from("users").select("id, nome_completo, email, user_types(name)").order("nome_completo"),a=o?.map(d=>({id:d.id,nome_completo:d.nome_completo,email:d.email,tipo:Array.isArray(d.user_types)&&d.user_types.length>0&&d.user_types[0].name||"OUTRO"}))||[];g(a);const{data:r}=await i.from("modulo_acesso").select("*");n(r||[])}catch(o){console.error(o),m("Erro ao carregar dados.")}finally{l(!1)}}e()},[]);function A(e,o){const a=w(e,o);return a||{id:"",usuario_id:e,modulo:o,permissao:"view",ativo:!1}}function w(e,o){return E.find(a=>a.usuario_id===e&&a.modulo===o)}const E=h?y:[];async function u(e){try{if(e.id){const{error:a}=await i.from("modulo_acesso").update({permissao:e.permissao,ativo:e.ativo}).eq("id",e.id);if(a)throw a}else{const{error:a}=await i.from("modulo_acesso").insert({usuario_id:e.usuario_id,modulo:e.modulo,permissao:e.permissao,ativo:e.ativo});if(a)throw a}const{data:o}=await i.from("modulo_acesso").select("*");n(o||[])}catch(o){console.error(o),alert("Erro ao salvar permissão.")}}return s.jsxs("div",{className:"permissoes-admin-page",children:[s.jsxs("div",{style:{marginBottom:16,padding:"12px 16px",background:"#4c0519",border:"1px solid #be123c",borderRadius:8,color:"#fecdd3"},children:[s.jsx("strong",{children:"Editor de Permissões"})," — controle total dos módulos"]}),c&&s.jsx("div",{className:"card-base card-config mb-3",children:c}),v&&s.jsx("div",{children:"Carregando..."}),s.jsxs("div",{className:"card-base card-red",children:[s.jsx("h3",{style:{marginBottom:12},children:"Usuários"}),s.jsx("div",{className:"table-container overflow-x-auto",children:s.jsxs("table",{className:"table-default table-header-red min-w-[900px]",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{minWidth:180},children:"Usuário"}),p.map(e=>s.jsx("th",{children:e},e))]})}),s.jsx("tbody",{children:j.map(e=>s.jsxs("tr",{children:[s.jsxs("td",{children:[s.jsx("strong",{children:e.nome_completo}),s.jsx("br",{}),s.jsx("small",{children:e.email}),s.jsx("br",{}),s.jsxs("small",{children:["Tipo: ",e.tipo]})]}),p.map(o=>{const a=A(e.id,o);return s.jsx("td",{children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[s.jsxs("label",{style:{fontSize:12},children:[s.jsx("input",{type:"checkbox",checked:a.ativo,onChange:r=>u({...a,ativo:r.target.checked})})," ","ativo"]}),s.jsxs("select",{disabled:!a.ativo,value:a.permissao,onChange:r=>u({...a,permissao:r.target.value}),style:{fontSize:12,background:"#1e1b4b",color:"#e0e7ff",border:"1px solid #312e81",borderRadius:4,padding:"2px 4px"},children:[s.jsx("option",{value:"view",children:"View"}),s.jsx("option",{value:"edit",children:"Edit"}),s.jsx("option",{value:"admin",children:"Admin"})]})]})},o)})]},e.id))})]})})]})]})}export{D as default};
