import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as l}from"./index.C0Fn7Wtz.js";import{s as d}from"./supabase.Ng8nq9tn.js";import{u as et}from"./usePermissao.DiLe8-Rs.js";import{r as me}from"./logs.DwCrXgEk.js";import{t as Ie}from"./titleCase.DQLlfrnh.js";import{L as tt}from"./LoadingUsuarioContext.BaDUNi7o.js";const ue={nome:"",nascimento:"",cpf:"",telefone:"",whatsapp:"",email:"",endereco:"",complemento:"",cidade:"",estado:"",cep:"",rg:"",genero:"",nacionalidade:"",tags:"",tipo_cliente:"passageiro",notas:"",active:!0};function dt(){const{permissao:b,ativo:Ve,loading:$}=et("Clientes"),ee=b!=="none",G=b==="create"||b==="edit"||b==="delete"||b==="admin",y=b==="edit"||b==="delete"||b==="admin",S=b==="delete"||b==="admin",[te,Te]=l.useState([]),[M,Oe]=l.useState(""),[he,R]=l.useState(null),[ae,pe]=l.useState(!0),[r,U]=l.useState(ue),[I,oe]=l.useState(null),[xe,fe]=l.useState(!1),[je,_e]=l.useState(null),[x,ge]=l.useState(null),[ve,be]=l.useState([]),[Ne,ye]=l.useState([]),[we,Se]=l.useState(!1),[C,J]=l.useState(null),[K,O]=l.useState([]),[He,Ce]=l.useState(!1),[P,Q]=l.useState(null),[Ee,H]=l.useState([]),[ne,Ae]=l.useState(!1),[Be,f]=l.useState(null),[m,_]=l.useState({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0}),[V,X]=l.useState(null),[se,Le]=l.useState(!1),[De,Re]=l.useState(null);async function re(){if(ee)try{pe(!0),R(null);const{data:t,error:a}=await d.from("clientes").select("*, company_id").order("nome",{ascending:!0});if(a)throw a;Te(t||[]),H([]),f(null)}catch(t){console.error(t),R("Erro ao carregar clientes.")}finally{pe(!1)}}l.useEffect(()=>{!$&&ee&&re()},[$,ee]);const Pe=l.useMemo(()=>{if(!M.trim())return te;const t=M.toLowerCase();return te.filter(a=>a.nome.toLowerCase().includes(t)||(a.cpf||"").includes(t)||(a.email||"").toLowerCase().includes(t))},[te,M]);function k(t,a){U(i=>({...i,[t]:a}))}function We(){G&&(oe(null),U(ue),H([]),f(null),X(null))}async function ze(t){ge(t),Se(!0);const a=new Set;try{const{data:i}=await d.from("historico_viagens_real").select("id, data_viagem, valor_total, notas, destinos:produtos!destino_id (nome)").eq("cliente_id",t.id).order("data_viagem",{ascending:!1}),j=i?.map(o=>({id:o.id,data_viagem:o.data_viagem,destino_nome:o.destinos?.nome||"",valor_total:o.valor_total??null,notas:o.notas||null}))||[],{data:E}=await d.from("vendas").select("id, data_lancamento, data_embarque, destino_id, destinos:produtos!destino_id (nome, cidade_id)").eq("cliente_id",t.id).order("data_lancamento",{ascending:!1});let A=[],B={};if(E&&E.length>0){const o=E.map(n=>n.id),u=Array.from(new Set(E.map(n=>n.destinos?.cidade_id).filter(n=>!!n)));if(u.length>0){const{data:n,error:s}=await d.from("cidades").select("id, nome").in("id",u);s?console.error(s):B=Object.fromEntries((n||[]).map(N=>[N.id,N.nome||""]))}const{data:v}=await d.from("vendas_recibos").select("venda_id, valor_total, valor_taxas, produto_id").in("venda_id",o);(v||[]).forEach(n=>{n.produto_id&&a.add(n.produto_id)});let D=[],h={};if(a.size>0){const n=Array.from(a),{data:s,error:N}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, tipo_produtos(disponivel_todas_cidades)").in("tipo_produto",n);!N&&s?D=s:N&&console.error(N);const{data:T,error:w}=await d.from("tipo_produtos").select("id, nome, disponivel_todas_cidades").in("id",n);!w&&T?h=Object.fromEntries(T.map(p=>[p.id,{nome:p.nome||"Produto",disponivel_todas_cidades:p.disponivel_todas_cidades}])):w&&console.error(w)}const F=(n,s)=>{if(!n)return"";const N=D.find(w=>{const p=!!w?.tipo_produtos?.disponivel_todas_cidades;return w.tipo_produto===n&&(p||!s||w.cidade_id===s)}),T=h[n]||{};return N?.nome||T.nome||"Produto"};A=E.map(n=>{const s=(v||[]).filter(p=>p.venda_id===n.id),N=s.reduce((p,ce)=>p+(ce.valor_total||0),0),T=s.reduce((p,ce)=>p+(ce.valor_taxas||0),0),w=s.map(p=>F(p.produto_id,n.destinos?.cidade_id)).filter(Boolean);return{id:n.id,data_lancamento:n.data_lancamento,data_embarque:n.data_embarque,destino_nome:n.destinos?.nome||"",destino_cidade_id:n.destinos?.cidade_id||null,destino_cidade_nome:n.destinos?.cidade_id&&B[n.destinos?.cidade_id]||"",valor_total:N,valor_taxas:T,produtos:w}})}const{data:W}=await d.from("orcamentos").select("id, data_orcamento, status, valor, numero_venda, produto_id, destinos:produtos!destino_id (nome, cidade_id)").eq("cliente_id",t.id).order("data_orcamento",{ascending:!1}),L=(W?.map(o=>o.destinos?.cidade_id).filter(o=>!!o)||[]).filter(o=>!(o in(B||{})));if(L.length>0){const{data:o,error:u}=await d.from("cidades").select("id, nome").in("id",L);u?console.error(u):(o||[]).forEach(v=>{B[v.id]=v.nome||""})}(W?.map(o=>o.produto_id).filter(o=>!!o)||[]).forEach(o=>a.add(o));let g=[],q=[];const le={},de={},Z=new Set;let qe={};if(a.size>0){const o=Array.from(a),{data:u,error:v}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, tipo_produtos(disponivel_todas_cidades)").in("tipo_produto",o);!v&&u?g=u:v&&console.error(v);const{data:D,error:h}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, tipo_produtos(disponivel_todas_cidades)").in("id",o);!h&&D?(q=D,D.forEach(s=>{s.id&&(le[s.id]=s.nome||"Produto",de[s.id]=s),s.tipo_produto&&Z.add(s.tipo_produto)})):h&&console.error(h),g.forEach(s=>{s.tipo_produto&&Z.add(s.tipo_produto)}),o.forEach(s=>Z.add(s));const{data:F,error:n}=await d.from("tipo_produtos").select("id, nome, disponivel_todas_cidades").in("id",Array.from(Z));!n&&F?qe=Object.fromEntries(F.map(s=>[s.id,{nome:s.nome||"Produto",disponivel_todas_cidades:s.disponivel_todas_cidades}])):n&&console.error(n)}const Fe=(o,u)=>{if(!o)return"";if(de[o]){const h=de[o];if(!!h?.tipo_produtos?.disponivel_todas_cidades||!u||h.cidade_id===u)return h.nome||"Produto"}if(le[o])return le[o];const v=g.find(h=>{const F=!!h?.tipo_produtos?.disponivel_todas_cidades;return h.tipo_produto===o&&(F||!u||h.cidade_id===u)}),D=qe[o]||{};return v?.nome||D.nome||"Produto"};A.length>0&&(A=A.map(o=>({...o,produtos:(o.produtos||[]).map(u=>Fe(u,o.destino_cidade_id)).filter(Boolean)})));const $e=W?.map(o=>({id:o.id,data_orcamento:o.data_orcamento,status:o.status,valor:o.valor??null,numero_venda:o.numero_venda??null,destino_nome:o.destinos?.nome||null,destino_cidade_nome:o.destinos?.cidade_id?B[o.destinos?.cidade_id]||"":null,produto_nome:Fe(o.produto_id,o.destinos?.cidade_id)}))||[];be(A),ye($e)}catch(i){console.error(i),R("Erro ao carregar histÃ³rico do cliente.")}finally{Se(!1),Y(t.id)}}async function Y(t){try{Ae(!0),f(null);const{data:a,error:i}=await d.from("cliente_acompanhantes").select("*").eq("cliente_id",t).order("nome_completo",{ascending:!0});if(i)throw i;H(a||[])}catch(a){console.error(a),f("Erro ao carregar acompanhantes."),H([])}finally{Ae(!1)}}function ke(){ge(null),be([]),ye([]),J(null),O([]),Q(null),H([]),f(null),X(null),_({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0})}async function Ge(t){J(t),Ce(!0),O([]);try{const{data:a}=await d.from("vendas_recibos").select("id, numero_recibo, valor_total, valor_taxas, produto_id").eq("venda_id",t.id),i=(a||[]).map(c=>({id:c.id,numero_recibo:c.numero_recibo,valor_total:c.valor_total,valor_taxas:c.valor_taxas,produto_id:c.produto_id,produto_nome:null}))||[],j=Array.from(new Set(i.map(c=>c.produto_id).filter(c=>!!c))),E=t.destino_cidade_id||"";let A=[],B={};if(j.length>0){const{data:c,error:L}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, tipo_produtos(disponivel_todas_cidades)").in("tipo_produto",j);!L&&c?A=c:L&&console.error(L);const{data:z,error:g}=await d.from("tipo_produtos").select("id, nome, disponivel_todas_cidades").in("id",j);!g&&z?B=Object.fromEntries(z.map(q=>[q.id,{nome:q.nome||"Produto",disponivel_todas_cidades:q.disponivel_todas_cidades}])):g&&console.error(g)}const W=c=>{if(!c)return"";const L=A.find(g=>{const q=!!g?.tipo_produtos?.disponivel_todas_cidades;return g.tipo_produto===c&&(q||!E||g.cidade_id===E)}),z=B[c]||{};return L?.nome||z.nome||"Produto"};O(i.map(c=>({...c,produto_nome:W(c.produto_id)})))}catch(a){console.error(a),R("Erro ao carregar recibos da venda.")}finally{Ce(!1)}}function Me(t){Q(t)}function Ue(t){y&&(oe(t.id),U({nome:t.nome,nascimento:t.nascimento||"",cpf:t.cpf,telefone:t.telefone,whatsapp:t.whatsapp||"",email:t.email||"",endereco:t.endereco||"",complemento:t.complemento||"",cidade:t.cidade||"",estado:t.estado||"",cep:t.cep||"",rg:t.rg||"",genero:t.genero||"",nacionalidade:t.nacionalidade||"",tags:(t.tags||[]).join(", "),tipo_cliente:t.tipo_cliente||"passageiro",notas:t.notas||"",active:t.active}),Y(t.id))}async function Je(t){if(t.preventDefault(),!(!G&&!y))try{fe(!0),R(null);const i={nome:Ie(r.nome),nascimento:r.nascimento||null,cpf:r.cpf.trim(),telefone:r.telefone.trim(),whatsapp:r.whatsapp.trim()||null,email:r.email.trim()||null,endereco:r.endereco.trim()||null,complemento:r.complemento.trim()||null,cidade:r.cidade.trim()||null,estado:r.estado.trim()||null,cep:r.cep.trim()||null,rg:r.rg.trim()||null,genero:r.genero.trim()||null,nacionalidade:r.nacionalidade.trim()||null,tags:r.tags?r.tags.split(",").map(j=>j.trim()):[],tipo_cliente:r.tipo_cliente,notas:r.notas||null,active:r.active};if(x?.company_id&&(i.company_id=x.company_id),I){const{error:j}=await d.from("clientes").update(i).eq("id",I);if(j)throw j;await me({acao:"cliente_editado",modulo:"Clientes",detalhes:{id:I,payload:i}})}else{const{error:j}=await d.from("clientes").insert(i);if(j)throw j;await me({acao:"cliente_criado",modulo:"Clientes",detalhes:i})}U(ue),oe(null),await re()}catch(a){console.error(a),R("Erro ao salvar cliente.")}finally{fe(!1)}}async function Ke(t){if(S&&window.confirm("Excluir cliente?"))try{_e(t);const{error:a}=await d.from("clientes").delete().eq("id",t);if(a)throw a;await me({acao:"cliente_excluido",modulo:"Clientes",detalhes:{id:t}}),await re()}catch{R("NÃ£o foi possÃ­vel excluir este cliente.")}finally{_e(null)}}function ie(){_({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0}),X(null)}function Qe(t){X(t.id),_({nome_completo:t.nome_completo||"",cpf:t.cpf||"",telefone:t.telefone||"",grau_parentesco:t.grau_parentesco||"",rg:t.rg||"",data_nascimento:t.data_nascimento||"",observacoes:t.observacoes||"",ativo:t.ativo})}async function Xe(){if(!x){f("Selecione um cliente antes de salvar acompanhante.");return}const t=x.company_id||null;if(!t){f("Cliente sem company_id definido para salvar acompanhante.");return}const a={cliente_id:x.id,company_id:t,nome_completo:m.nome_completo.trim(),cpf:m.cpf?.trim()||null,telefone:m.telefone?.trim()||null,grau_parentesco:m.grau_parentesco?.trim()||null,rg:m.rg?.trim()||null,data_nascimento:m.data_nascimento||null,observacoes:m.observacoes?.trim()||null,ativo:m.ativo};if(!a.nome_completo){f("Informe o nome completo do acompanhante.");return}try{if(Le(!0),f(null),V){const{error:i}=await d.from("cliente_acompanhantes").update(a).eq("id",V).eq("cliente_id",x.id);if(i)throw i}else{const{error:i}=await d.from("cliente_acompanhantes").insert(a);if(i)throw i}ie(),await Y(x.id)}catch(i){console.error(i),f("Erro ao salvar acompanhante.")}finally{Le(!1)}}async function Ye(t){if(!(!S||!x)&&window.confirm("Remover acompanhante?"))try{Re(t),f(null);const{error:a}=await d.from("cliente_acompanhantes").delete().eq("id",t).eq("cliente_id",x.id);if(a)throw a;V===t&&ie(),await Y(x.id)}catch(a){console.error(a),f("Erro ao remover acompanhante.")}finally{Re(null)}}if($)return e.jsx(tt,{});if(!Ve)return e.jsx("div",{className:"card-base card-config",children:e.jsx("strong",{children:"Acesso negado ao mÃ³dulo de Clientes."})});const Ze=!G&&!y;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"clientes-page",children:[!Ze&&e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:Je,children:[e.jsx("h3",{children:I?"Editar cliente":"Novo cliente"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome *"}),e.jsx("input",{className:"form-input",value:r.nome,onChange:t=>k("nome",t.target.value),onBlur:t=>k("nome",Ie(t.target.value)),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF *"}),e.jsx("input",{className:"form-input",value:r.cpf,onChange:t=>k("cpf",t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone *"}),e.jsx("input",{className:"form-input",value:r.telefone,onChange:t=>k("telefone",t.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Whatsapp"}),e.jsx("input",{className:"form-input",value:r.whatsapp,onChange:t=>k("whatsapp",t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{className:"form-input",value:r.email,onChange:t=>k("email",t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tags (,) "}),e.jsx("input",{className:"form-input",value:r.tags,onChange:t=>k("tags",t.target.value),placeholder:"premium, recorrente..."})]})]}),e.jsxs("div",{className:"mt-2",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-primary",disabled:xe,type:"submit",children:xe?"Salvando...":I?"Salvar alteraÃ§Ãµes":"Criar cliente"}),I&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:We,children:"Cancelar"})]})]})}),e.jsx("div",{className:"card-base mb-3",children:e.jsx("div",{className:"form-row",style:{marginTop:12},children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Buscar cliente"}),e.jsx("input",{className:"form-input",value:M,onChange:t=>Oe(t.target.value),placeholder:"Nome, CPF ou e-mail"})]})})}),he&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:he})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[960px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CPF"}),e.jsx("th",{children:"Telefone"}),e.jsx("th",{children:"E-mail"}),e.jsx("th",{style:{textAlign:"center"},children:"Ativo"}),(y||S)&&e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[ae&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Carregando..."})}),!ae&&Pe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhum cliente encontrado."})}),!ae&&Pe.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.nome}),e.jsx("td",{children:t.cpf}),e.jsx("td",{children:t.telefone}),e.jsx("td",{children:t.email||"-"}),e.jsx("td",{style:{textAlign:"center"},children:t.active?"Sim":"NÃ£o"}),(y||S)&&e.jsxs("td",{className:"th-actions",style:{textAlign:"center"},children:[e.jsx("button",{className:"btn-icon",onClick:()=>ze(t),title:"HistÃ³rico",children:"ðŸ—‚ï¸"}),y&&e.jsx("button",{className:"btn-icon",onClick:()=>Ue(t),title:"Editar",children:"âœï¸"}),S&&e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>Ke(t.id),disabled:je===t.id,title:"Excluir",children:je===t.id?"...":"ðŸ—‘ï¸"})]})]},t.id))]})]})})]}),x&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:1100,width:"95vw"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"modal-title",style:{color:"#1d4ed8",fontSize:"1.2rem",fontWeight:800},children:["HistÃ³rico de ",x.nome]}),e.jsx("small",{style:{color:"#64748b"},children:"Vendas e orÃ§amentos do cliente"})]}),e.jsx("button",{className:"btn-ghost",onClick:ke,children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[we&&e.jsx("p",{children:"Carregando histÃ³rico..."}),!we&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-base card-blue mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"Acompanhantes do cliente"}),Be&&e.jsx("div",{style:{color:"red",marginBottom:8},children:Be}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CPF"}),e.jsx("th",{children:"Telefone"}),e.jsx("th",{children:"Parentesco"}),e.jsx("th",{children:"Ativo"}),(y||S)&&e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[ne&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Carregando acompanhantes..."})}),!ne&&Ee.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhum acompanhante cadastrado."})}),!ne&&Ee.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.nome_completo}),e.jsx("td",{children:t.cpf||"-"}),e.jsx("td",{children:t.telefone||"-"}),e.jsx("td",{children:t.grau_parentesco||"-"}),e.jsx("td",{children:t.ativo?"Sim":"NÃ£o"}),(y||S)&&e.jsxs("td",{className:"th-actions",style:{textAlign:"center",display:"flex",gap:6,justifyContent:"center"},children:[y&&e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>Qe(t),title:"Editar",children:"âœï¸"}),S&&e.jsx("button",{className:"btn-icon btn-danger",type:"button",onClick:()=>Ye(t.id),disabled:De===t.id,title:"Excluir",children:De===t.id?"...":"ðŸ—‘ï¸"})]})]},t.id))]})]})}),G&&e.jsxs("div",{className:"card-base",style:{marginTop:12,border:"1px dashed #cbd5e1",background:"#f8fafc"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:V?"Editar acompanhante":"Adicionar acompanhante"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome completo"}),e.jsx("input",{className:"form-input",value:m.nome_completo,onChange:t=>_(a=>({...a,nome_completo:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF"}),e.jsx("input",{className:"form-input",value:m.cpf,onChange:t=>_(a=>({...a,cpf:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone"}),e.jsx("input",{className:"form-input",value:m.telefone,onChange:t=>_(a=>({...a,telefone:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Parentesco"}),e.jsx("input",{className:"form-input",value:m.grau_parentesco,onChange:t=>_(a=>({...a,grau_parentesco:t.target.value})),placeholder:"Ex: Esposa, Filho"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"RG"}),e.jsx("input",{className:"form-input",value:m.rg,onChange:t=>_(a=>({...a,rg:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data nascimento"}),e.jsx("input",{type:"date",className:"form-input",value:m.data_nascimento,onChange:t=>_(a=>({...a,data_nascimento:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ObservaÃ§Ãµes"}),e.jsx("input",{className:"form-input",value:m.observacoes,onChange:t=>_(a=>({...a,observacoes:t.target.value}))})]}),e.jsxs("div",{className:"form-group",style:{alignSelf:"flex-end"},children:[e.jsx("label",{className:"form-label",children:"Ativo"}),e.jsx("input",{type:"checkbox",checked:m.ativo,onChange:t=>_(a=>({...a,ativo:t.target.checked}))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn btn-primary",type:"button",onClick:Xe,disabled:se,children:se?"Salvando...":V?"Salvar alteraÃ§Ãµes":"Adicionar acompanhante"}),V&&e.jsx("button",{className:"btn btn-light",type:"button",onClick:ie,disabled:se,children:"Cancelar ediÃ§Ã£o"})]})]})]}),e.jsxs("div",{className:"card-base mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"Vendas"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[820px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data LanÃ§amento"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Embarque"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Taxas"}),e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[ve.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhuma venda encontrada."})}),ve.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.data_lancamento?new Date(t.data_lancamento).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{children:t.destino_cidade_nome||"-"}),e.jsx("td",{children:t.data_embarque?new Date(t.data_embarque).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{children:t.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:t.valor_taxas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{className:"th-actions",style:{textAlign:"center"},children:e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>Ge(t),title:"Ver detalhes",children:"ðŸ‘ï¸"})})]},t.id))]})]})})]}),e.jsxs("div",{className:"card-base card-blue mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"OrÃ§amentos do cliente"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[760px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[Ne.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:"Nenhum orÃ§amento encontrado."})}),Ne.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.data_orcamento?new Date(t.data_orcamento).toLocaleDateString("pt-BR").replaceAll("/","-"):"-"}),e.jsx("td",{style:{textTransform:"capitalize"},children:t.status||"-"}),e.jsx("td",{children:t.destino_cidade_nome||"-"}),e.jsx("td",{children:t.produto_nome||"-"}),e.jsx("td",{children:(t.valor??0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:t.numero_venda||"-"}),e.jsx("td",{className:"th-actions",style:{textAlign:"center"},children:e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>Me(t),title:"Ver detalhes",children:"ðŸ‘ï¸"})})]},t.id))]})]})})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:ke,children:"Fechar"})})]})}),C&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:720},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{children:e.jsx("div",{className:"modal-title",style:{color:"#16a34a",fontSize:"1.15rem",fontWeight:800},children:"Detalhes da venda"})}),e.jsx("button",{className:"btn-ghost",onClick:()=>{J(null),O([])},children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{style:{display:"grid",gap:6,lineHeight:1.4,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Recibo:"})," ",K.length>0?K.map(t=>t.numero_recibo||"-").join(", "):"â€”"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Destino:"})," ",C.destino_cidade_nome||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"LanÃ§amento:"})," ",new Date(C.data_lancamento).toLocaleDateString("pt-BR")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Embarque:"})," ",C.data_embarque?new Date(C.data_embarque).toLocaleDateString("pt-BR"):"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor:"})," ",C.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Taxas:"})," ",C.valor_taxas===0?"-":C.valor_taxas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]}),e.jsx("h4",{style:{marginBottom:8,textAlign:"center"},children:"Recibos"}),He?e.jsx("p",{children:"Carregando recibos..."}):e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue",style:{minWidth:520},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"NÃºmero"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Taxas"})]})}),e.jsxs("tbody",{children:[K.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Nenhum recibo encontrado."})}),K.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.numero_recibo||"-"}),e.jsx("td",{children:t.produto_nome||"-"}),e.jsx("td",{children:(t.valor_total||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:(t.valor_taxas||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},a))]})]})})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{J(null),O([])},children:"Fechar"})})]})}),P&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:640},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"modal-title",style:{color:"#1d4ed8",fontSize:"1.15rem",fontWeight:800},children:"Detalhes do orÃ§amento"}),e.jsxs("small",{style:{color:"#64748b"},children:["Destino: ",P.destino_nome||"-"]})]}),e.jsx("button",{className:"btn-ghost",onClick:()=>Q(null),children:"âœ•"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{style:{display:"grid",gap:6,lineHeight:1.4,marginBottom:4},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Data:"})," ",P.data_orcamento?new Date(P.data_orcamento).toLocaleDateString("pt-BR"):"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",P.status||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor:"})," ",(P.valor||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Venda vinculada:"})," ",P.numero_venda||"-"]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:()=>Q(null),children:"Fechar"})})]})})]})}export{dt as default};
