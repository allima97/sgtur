import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as l}from"./index.C0Fn7Wtz.js";import{s as d}from"./supabase.Ng8nq9tn.js";import{u as pa}from"./usePermissao.DiLe8-Rs.js";import{r as ge}from"./logs.DwCrXgEk.js";import{t as Je}from"./titleCase.DQLlfrnh.js";import{L as xa}from"./LoadingUsuarioContext.BaDUNi7o.js";const ne={nome:"",nascimento:"",cpf:"",telefone:"",whatsapp:"",email:"",endereco:"",numero:"",complemento:"",cidade:"",estado:"",cep:"",rg:"",genero:"",nacionalidade:"",tags:"",tipo_cliente:"passageiro",company_id:"",notas:"",ativo:!0,active:!0};function ya(){const{permissao:N,ativo:Ke,loading:se}=pa("Clientes"),re=N!=="none",J=N==="create"||N==="edit"||N==="delete"||N==="admin",w=N==="edit"||N==="delete"||N==="admin",S=N==="delete"||N==="admin",[le,Qe]=l.useState([]),[K,Xe]=l.useState(""),[ve,P]=l.useState(null),[ie,be]=l.useState(!0),[n,T]=l.useState(ne),[I,Q]=l.useState(null),[de,_e]=l.useState(!1),[Ne,ye]=l.useState(null),[f,Ce]=l.useState(null),[we,W]=l.useState(null),[Se,ce]=l.useState(!1),[Ee,H]=l.useState(null),[Ae,X]=l.useState(!1),[Be,De]=l.useState([]),[Le,Pe]=l.useState([]),[Re,Fe]=l.useState(!1),[E,Y]=l.useState(null),[Z,M]=l.useState([]),[Ye,ke]=l.useState(!1),[R,ee]=l.useState(null),[qe,ae]=l.useState([]),[me,Te]=l.useState(!1),[Ie,v]=l.useState(null),[h,y]=l.useState({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0}),[F,Ve]=l.useState(null),[ue,$e]=l.useState(!1),[Oe,We]=l.useState(null);async function he(){if(re)try{be(!0),P(null);const{data:a,error:t}=await d.from("clientes").select("*, company_id").order("nome",{ascending:!0});if(t)throw t;Qe(a||[]),ae([]),v(null)}catch(a){console.error(a),P("Erro ao carregar clientes.")}finally{be(!1)}}l.useEffect(()=>{!se&&re&&he()},[se,re]);const He=l.useMemo(()=>{if(!K.trim())return le;const a=K.toLowerCase();return le.filter(t=>t.nome.toLowerCase().includes(a)||(t.cpf||"").includes(a)||(t.email||"").toLowerCase().includes(a))},[le,K]);function m(a,t){T(s=>({...s,[a]:t}))}function Ze(a){return a.replace(/\D/g,"").slice(0,11).replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}function Me(a){const t=a.replace(/\D/g,"").slice(0,11);return t.length<=10?t.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{4})(\d)/,"$1-$2"):t.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2")}function pe(a){return a.replace(/\D/g,"").slice(0,8).replace(/(\d{5})(\d)/,"$1-$2")}async function ea(a){const t=(a||"").replace(/\D/g,"");if(t.length!==8){W(null);return}try{W("Buscando endereÃ§o...");const s=await fetch(`https://viacep.com.br/ws/${t}/json/`,{mode:"cors"});if(!s.ok)throw new Error("CEP invÃ¡lido ou indisponÃ­vel.");const j=await s.json();if(j.erro)throw new Error("CEP nÃ£o encontrado.");T(u=>({...u,cep:pe(t),endereco:j.logradouro||"",cidade:j.localidade||"",estado:j.uf||""})),W("EndereÃ§o carregado pelo CEP.")}catch(s){console.error("Erro ao buscar CEP:",s),W("NÃ£o foi possÃ­vel carregar o CEP.")}}function aa(){X(!1),T(ne),Q(null),H(null)}async function ta(a){Ce(a),Fe(!0);const t=new Set;try{const{data:s}=await d.from("historico_viagens_real").select("id, data_viagem, valor_total, notas, destinos:produtos!destino_id (nome)").eq("cliente_id",a.id).order("data_viagem",{ascending:!1}),j=s?.map(o=>({id:o.id,data_viagem:o.data_viagem,destino_nome:o.destinos?.nome||"",valor_total:o.valor_total??null,notas:o.notas||null}))||[],{data:u}=await d.from("vendas").select("id, data_lancamento, data_embarque, destino_id, destino_cidade_id, destinos:produtos!destino_id (nome, cidade_id)").eq("cliente_id",a.id).order("data_lancamento",{ascending:!1});let A=[],B={};if(u&&u.length>0){const o=u.map(r=>r.id),p=Array.from(new Set(u.map(r=>r.destino_cidade_id||r.destinos?.cidade_id).filter(r=>!!r)));if(p.length>0){const{data:r,error:i}=await d.from("cidades").select("id, nome").in("id",p);i?console.error(i):B=Object.fromEntries((r||[]).map(C=>[C.id,C.nome||""]))}const{data:_}=await d.from("vendas_recibos").select("venda_id, valor_total, valor_taxas, produto_id").in("venda_id",o);(_||[]).forEach(r=>{r.produto_id&&t.add(r.produto_id)});let L=[],x={};if(t.size>0){const r=Array.from(t),{data:i,error:C}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("tipo_produto",r);!C&&i?L=i:C&&console.error(C);const{data:$,error:g}=await d.from("tipo_produtos").select("id, nome").in("id",r);!g&&$?x=Object.fromEntries($.map(O=>[O.id,O.nome||"Produto"])):g&&console.error(g)}const k=(r,i)=>{if(!r)return"";const C=L.find(g=>{const O=!!g?.todas_as_cidades;return g.tipo_produto===r&&(O||!i||g.cidade_id===i)}),$=x[r]||{};return C?.nome||$||"Produto"};A=u.map(r=>{const i=(_||[]).filter(q=>q.venda_id===r.id),C=i.reduce((q,je)=>q+(je.valor_total||0),0),$=i.reduce((q,je)=>q+(je.valor_taxas||0),0),g=r.destino_cidade_id||r.destinos?.cidade_id||null,O=i.map(q=>k(q.produto_id,g||void 0)).filter(Boolean),ha=g&&B[g]||"";return{id:r.id,data_lancamento:r.data_lancamento,data_embarque:r.data_embarque,destino_nome:r.destinos?.nome||"",destino_cidade_id:g,destino_cidade_nome:ha,valor_total:C,valor_taxas:$,produtos:O}})}const{data:G}=await d.from("orcamentos").select("id, data_orcamento, status, valor, numero_venda, produto_id, destinos:produtos!destino_id (nome, cidade_id)").eq("cliente_id",a.id).order("data_orcamento",{ascending:!1}),D=(G?.map(o=>o.destinos?.cidade_id).filter(o=>!!o)||[]).filter(o=>!(o in(B||{})));if(D.length>0){const{data:o,error:p}=await d.from("cidades").select("id, nome").in("id",D);p?console.error(p):(o||[]).forEach(_=>{B[_.id]=_.nome||""})}(G?.map(o=>o.produto_id).filter(o=>!!o)||[]).forEach(o=>t.add(o));let b=[],V=[];const xe={},fe={},oe=new Set;let Ge={};if(t.size>0){const o=Array.from(t),{data:p,error:_}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("tipo_produto",o);!_&&p?b=p:_&&console.error(_);const{data:L,error:x}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("id",o);!x&&L?(V=L,L.forEach(i=>{i.id&&(xe[i.id]=i.nome||"Produto",fe[i.id]=i),i.tipo_produto&&oe.add(i.tipo_produto)})):x&&console.error(x),b.forEach(i=>{i.tipo_produto&&oe.add(i.tipo_produto)}),o.forEach(i=>oe.add(i));const{data:k,error:r}=await d.from("tipo_produtos").select("id, nome").in("id",Array.from(oe));!r&&k?Ge=Object.fromEntries(k.map(i=>[i.id,i.nome||"Produto"])):r&&console.error(r)}const Ue=(o,p)=>{if(!o)return"";if(fe[o]){const x=fe[o];if(!!x?.todas_as_cidades||!p||x.cidade_id===p)return x.nome||"Produto"}if(xe[o])return xe[o];const _=b.find(x=>{const k=!!x?.todas_as_cidades;return x.tipo_produto===o&&(k||!p||x.cidade_id===p)}),L=Ge[o]||"Produto";return _?.nome||L};A.length>0&&(A=A.map(o=>({...o,produtos:(o.produtos||[]).map(p=>Ue(p,o.destino_cidade_id)).filter(Boolean)})));const ua=G?.map(o=>({id:o.id,data_orcamento:o.data_orcamento,status:o.status,valor:o.valor??null,numero_venda:o.numero_venda??null,destino_nome:o.destinos?.nome||null,destino_cidade_nome:o.destinos?.cidade_id?B[o.destinos?.cidade_id]||"":null,produto_nome:Ue(o.produto_id,o.destinos?.cidade_id)}))||[];De(A),Pe(ua)}catch(s){console.error(s),P("Erro ao carregar histÃ³rico do cliente.")}finally{Fe(!1),te(a.id)}}async function te(a){try{Te(!0),v(null);const{data:t,error:s}=await d.from("cliente_acompanhantes").select("*").eq("cliente_id",a).order("nome_completo",{ascending:!0});if(s)throw s;ae(t||[])}catch(t){console.error(t),v("Erro ao carregar acompanhantes."),ae([])}finally{Te(!1)}}function ze(){Ce(null),De([]),Pe([]),Y(null),M([]),ee(null),ae([]),v(null),z(!0)}async function oa(a){Y(a),ke(!0),M([]);try{const{data:t}=await d.from("vendas_recibos").select("id, numero_recibo, valor_total, valor_taxas, produto_id").eq("venda_id",a.id),s=(t||[]).map(c=>({id:c.id,numero_recibo:c.numero_recibo,valor_total:c.valor_total,valor_taxas:c.valor_taxas,produto_id:c.produto_id,produto_nome:null}))||[],j=Array.from(new Set(s.map(c=>c.produto_id).filter(c=>!!c))),u=a.destino_cidade_id||"";let A=[],B={};if(j.length>0){const{data:c,error:D}=await d.from("produtos").select("id, nome, cidade_id, tipo_produto, todas_as_cidades").in("tipo_produto",j);!D&&c?A=c:D&&console.error(D);const{data:U,error:b}=await d.from("tipo_produtos").select("id, nome").in("id",j);!b&&U?B=Object.fromEntries(U.map(V=>[V.id,V.nome||"Produto"])):b&&console.error(b)}const G=c=>{if(!c)return"";const D=A.find(b=>{const V=!!b?.todas_as_cidades;return b.tipo_produto===c&&(V||!u||b.cidade_id===u)}),U=B[c]||"Produto";return D?.nome||U};M(s.map(c=>({...c,produto_nome:G(c.produto_id)})))}catch(t){console.error(t),P("Erro ao carregar recibos da venda.")}finally{ke(!1)}}function na(a){ee(a)}function sa(a){w&&(Q(a.id),T({nome:a.nome,nascimento:a.nascimento||"",cpf:a.cpf,telefone:a.telefone,whatsapp:a.whatsapp||"",email:a.email||"",endereco:a.endereco||"",numero:a.numero||"",complemento:a.complemento||"",cidade:a.cidade||"",estado:a.estado||"",cep:a.cep||"",rg:a.rg||"",genero:a.genero||"",nacionalidade:a.nacionalidade||"",tags:(a.tags||[]).join(", "),tipo_cliente:a.tipo_cliente||"passageiro",company_id:a.company_id||"",notas:a.notas||"",ativo:a.ativo,active:a.active}),te(a.id),X(!0))}async function ra(a){if(a.preventDefault(),!(!J&&!w))try{_e(!0),P(null),H(null);const s={nome:Je(n.nome),nascimento:n.nascimento||null,cpf:n.cpf.trim(),telefone:n.telefone.trim(),whatsapp:n.whatsapp.trim()||null,email:n.email.trim()||null,endereco:n.endereco.trim()||null,numero:n.numero.trim()||null,complemento:n.complemento.trim()||null,cidade:n.cidade.trim()||null,estado:n.estado.trim()||null,cep:n.cep.trim()||null,rg:n.rg.trim()||null,genero:n.genero.trim()||null,nacionalidade:n.nacionalidade.trim()||null,tags:n.tags?n.tags.split(",").map(u=>u.trim()):[],tipo_cliente:n.tipo_cliente,notas:n.notas||null,ativo:n.ativo,active:n.active},j=n.company_id.trim();if(j?s.company_id=j:f?.company_id&&(s.company_id=f.company_id),I){const{error:u}=await d.from("clientes").update(s).eq("id",I);if(u)throw u;await ge({acao:"cliente_editado",modulo:"Clientes",detalhes:{id:I,payload:s}})}else{const{error:u}=await d.from("clientes").insert(s);if(u)throw u;await ge({acao:"cliente_criado",modulo:"Clientes",detalhes:s})}T(ne),Q(null),X(!1),H(I?"Cliente atualizado com sucesso.":"Cliente criado com sucesso."),await he()}catch(t){console.error(t),P("Erro ao salvar cliente."),H(null)}finally{_e(!1)}}async function la(a){if(S&&window.confirm("Excluir cliente?"))try{ye(a);const{error:t}=await d.from("clientes").delete().eq("id",a);if(t)throw t;await ge({acao:"cliente_excluido",modulo:"Clientes",detalhes:{id:a}}),await he()}catch{P("NÃ£o foi possÃ­vel excluir este cliente.")}finally{ye(null)}}function z(a=!1){y({nome_completo:"",cpf:"",telefone:"",grau_parentesco:"",rg:"",data_nascimento:"",observacoes:"",ativo:!0}),Ve(null),a&&ce(!1)}function ia(a){Ve(a.id),y({nome_completo:a.nome_completo||"",cpf:a.cpf||"",telefone:a.telefone||"",grau_parentesco:a.grau_parentesco||"",rg:a.rg||"",data_nascimento:a.data_nascimento||"",observacoes:a.observacoes||"",ativo:a.ativo}),ce(!0)}async function da(){if(!f){v("Selecione um cliente antes de salvar acompanhante.");return}const a=f.company_id||null;if(!a){v("Cliente sem company_id definido para salvar acompanhante.");return}const t={cliente_id:f.id,company_id:a,nome_completo:h.nome_completo.trim(),cpf:h.cpf?.trim()||null,telefone:h.telefone?.trim()||null,grau_parentesco:h.grau_parentesco?.trim()||null,rg:h.rg?.trim()||null,data_nascimento:h.data_nascimento||null,observacoes:h.observacoes?.trim()||null,ativo:h.ativo};if(!t.nome_completo){v("Informe o nome completo do acompanhante.");return}try{if($e(!0),v(null),F){const{error:s}=await d.from("cliente_acompanhantes").update(t).eq("id",F).eq("cliente_id",f.id);if(s)throw s}else{const{error:s}=await d.from("cliente_acompanhantes").insert(t);if(s)throw s}z(!0),await te(f.id)}catch(s){console.error(s),v("Erro ao salvar acompanhante.")}finally{$e(!1)}}async function ca(a){if(!(!S||!f)&&window.confirm("Remover acompanhante?"))try{We(a),v(null);const{error:t}=await d.from("cliente_acompanhantes").delete().eq("id",a).eq("cliente_id",f.id);if(t)throw t;F===a&&z(!0),await te(f.id)}catch(t){console.error(t),v("Erro ao remover acompanhante.")}finally{We(null)}}if(se)return e.jsx(xa,{});if(!Ke)return e.jsx("div",{className:"card-base card-config",children:e.jsx("strong",{children:"Acesso negado ao mÃ³dulo de Clientes."})});const ma=!J&&!w;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"clientes-page",children:[!ma&&Ae&&e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:ra,children:[e.jsx("h3",{children:I?"Editar cliente":"Novo cliente"}),e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"grid",gridTemplateColumns:"minmax(0, 2fr) repeat(5, minmax(0, 1fr))",gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome completo *"}),e.jsx("input",{className:"form-input",value:n.nome,onChange:a=>m("nome",a.target.value),onBlur:a=>m("nome",Je(a.target.value)),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF *"}),e.jsx("input",{className:"form-input",value:n.cpf,onChange:a=>m("cpf",Ze(a.target.value)),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"RG"}),e.jsx("input",{className:"form-input",value:n.rg,onChange:a=>m("rg",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nascimento"}),e.jsx("input",{type:"date",className:"form-input",value:n.nascimento,onChange:a=>m("nascimento",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"GÃªnero"}),e.jsxs("select",{className:"form-select",value:n.genero,onChange:a=>m("genero",a.target.value),children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"Masculino",children:"Masculino"}),e.jsx("option",{value:"Feminino",children:"Feminino"}),e.jsx("option",{value:"Outros",children:"Outros"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nacionalidade"}),e.jsx("input",{className:"form-input",value:n.nacionalidade,onChange:a=>m("nacionalidade",a.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone *"}),e.jsx("input",{className:"form-input",value:n.telefone,onChange:a=>m("telefone",Me(a.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Whatsapp"}),e.jsx("input",{className:"form-input",value:n.whatsapp,onChange:a=>m("whatsapp",Me(a.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"E-mail"}),e.jsx("input",{className:"form-input",value:n.email,onChange:a=>m("email",a.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"grid",gridTemplateColumns:"minmax(0, 0.75fr) minmax(0, 1.7fr) minmax(0, 0.8fr) minmax(0, 0.9fr) minmax(0, 0.9fr) minmax(0, 0.9fr)",gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CEP"}),e.jsx("input",{className:"form-input",value:n.cep,onChange:a=>m("cep",pe(a.target.value)),onBlur:a=>{const t=pe(a.target.value);m("cep",t),t.replace(/\D/g,"").length===8?ea(t):W(null)}}),e.jsx("small",{style:{color:we?.includes("NÃ£o foi")?"#b91c1c":"#475569"},children:we||"Preencha para auto-preencher endereÃ§o."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"EndereÃ§o"}),e.jsx("input",{className:"form-input",value:n.endereco,onChange:a=>m("endereco",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"NÃºmero"}),e.jsx("input",{className:"form-input",value:n.numero,onChange:a=>m("numero",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Complemento"}),e.jsx("input",{className:"form-input",value:n.complemento,onChange:a=>m("complemento",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cidade"}),e.jsx("input",{className:"form-input",value:n.cidade,onChange:a=>m("cidade",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsx("input",{className:"form-input",value:n.estado,onChange:a=>m("estado",a.target.value)})]})]}),e.jsx("div",{className:"form-row",style:{marginTop:12},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Notas"}),e.jsx("textarea",{className:"form-textarea",rows:3,value:n.notas,onChange:a=>m("notas",a.target.value),placeholder:"InformaÃ§Ãµes adicionais"})]})}),e.jsxs("div",{className:"mt-2",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn btn-primary",disabled:de,type:"submit",children:de?"Salvando...":I?"Salvar alteraÃ§Ãµes":"Salvar"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:aa,disabled:de,children:"Cancelar"})]})]})}),Ee&&e.jsx("div",{className:"card-base card-green mb-3",children:e.jsx("strong",{children:Ee})}),e.jsx("div",{className:"card-base mb-3",children:e.jsxs("div",{className:"form-row",style:{marginTop:12,display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1 1 300px"},children:[e.jsx("label",{className:"form-label",children:"Buscar cliente"}),e.jsx("input",{className:"form-input",value:K,onChange:a=>Xe(a.target.value),placeholder:"Nome, CPF ou e-mail"})]}),J&&e.jsx("div",{className:"form-group",style:{alignItems:"flex-end"},children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{T(ne),Q(null),H(null),X(!0)},disabled:Ae,children:"Adicionar cliente"})})]})}),ve&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:ve})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[960px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CPF"}),e.jsx("th",{children:"Telefone"}),e.jsx("th",{children:"E-mail"}),e.jsx("th",{style:{textAlign:"center"},children:"Ativo"}),(w||S)&&e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[ie&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Carregando..."})}),!ie&&He.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhum cliente encontrado."})}),!ie&&He.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome}),e.jsx("td",{children:a.cpf}),e.jsx("td",{children:a.telefone}),e.jsx("td",{children:a.email||"-"}),e.jsx("td",{style:{textAlign:"center"},children:a.active?"Sim":"NÃ£o"}),(w||S)&&e.jsxs("td",{className:"th-actions",style:{textAlign:"center"},children:[e.jsx("button",{className:"btn-icon",onClick:()=>ta(a),title:"HistÃ³rico",children:"ðŸ—‚ï¸"}),w&&e.jsx("button",{className:"btn-icon",onClick:()=>sa(a),title:"Editar",children:"âœï¸"}),S&&e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>la(a.id),disabled:Ne===a.id,title:"Excluir",children:Ne===a.id?"...":"ðŸ—‘ï¸"})]})]},a.id))]})]})})]}),f&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:1100,width:"95vw"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"modal-title",style:{color:"#1d4ed8",fontSize:"1.2rem",fontWeight:800},children:["HistÃ³rico de ",f.nome]}),e.jsx("small",{style:{color:"#64748b"},children:"Vendas e orÃ§amentos do cliente"})]}),e.jsx("button",{className:"btn-ghost",onClick:ze,children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[Re&&e.jsx("p",{children:"Carregando histÃ³rico..."}),!Re&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card-base card-blue mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"Acompanhantes do cliente"}),Ie&&e.jsx("div",{style:{color:"red",marginBottom:8},children:Ie}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CPF"}),e.jsx("th",{children:"Telefone"}),e.jsx("th",{children:"Parentesco"}),e.jsx("th",{children:"Ativo"}),(w||S)&&e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[me&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Carregando acompanhantes..."})}),!me&&qe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhum acompanhante cadastrado."})}),!me&&qe.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome_completo}),e.jsx("td",{children:a.cpf||"-"}),e.jsx("td",{children:a.telefone||"-"}),e.jsx("td",{children:a.grau_parentesco||"-"}),e.jsx("td",{children:a.ativo?"Sim":"NÃ£o"}),(w||S)&&e.jsxs("td",{className:"th-actions",style:{textAlign:"center",display:"flex",gap:6,justifyContent:"center"},children:[w&&e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>ia(a),title:"Editar",children:"âœï¸"}),S&&e.jsx("button",{className:"btn-icon btn-danger",type:"button",onClick:()=>ca(a.id),disabled:Oe===a.id,title:"Excluir",children:Oe===a.id?"...":"ðŸ—‘ï¸"})]})]},a.id))]})]})}),J&&e.jsxs("div",{className:"card-base",style:{marginTop:12,border:"1px dashed #cbd5e1",background:"#f8fafc"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:F?"Editar acompanhante":"Adicionar acompanhante"}),!Se&&!F&&e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{z(),ce(!0)},children:"Adicionar acompanhante"}),(Se||F)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome completo"}),e.jsx("input",{className:"form-input",value:h.nome_completo,onChange:a=>y(t=>({...t,nome_completo:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CPF"}),e.jsx("input",{className:"form-input",value:h.cpf,onChange:a=>y(t=>({...t,cpf:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Telefone"}),e.jsx("input",{className:"form-input",value:h.telefone,onChange:a=>y(t=>({...t,telefone:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Parentesco"}),e.jsx("input",{className:"form-input",value:h.grau_parentesco,onChange:a=>y(t=>({...t,grau_parentesco:a.target.value})),placeholder:"Ex: Esposa, Filho"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"RG"}),e.jsx("input",{className:"form-input",value:h.rg,onChange:a=>y(t=>({...t,rg:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data nascimento"}),e.jsx("input",{type:"date",className:"form-input",value:h.data_nascimento,onChange:a=>y(t=>({...t,data_nascimento:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ObservaÃ§Ãµes"}),e.jsx("input",{className:"form-input",value:h.observacoes,onChange:a=>y(t=>({...t,observacoes:a.target.value}))})]}),e.jsxs("div",{className:"form-group",style:{alignSelf:"flex-end"},children:[e.jsx("label",{className:"form-label",children:"Ativo"}),e.jsx("input",{type:"checkbox",checked:h.ativo,onChange:a=>y(t=>({...t,ativo:a.target.checked}))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn btn-primary",type:"button",onClick:da,disabled:ue,children:ue?"Salvando...":F?"Salvar alteraÃ§Ãµes":"Salvar"}),e.jsx("button",{className:"btn btn-light",type:"button",onClick:()=>z(!0),disabled:ue,children:"Cancelar"})]})]})]})]}),e.jsxs("div",{className:"card-base mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"Vendas"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[820px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data LanÃ§amento"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Embarque"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Taxas"}),e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[Be.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Nenhuma venda encontrada."})}),Be.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.data_lancamento?new Date(a.data_lancamento).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{children:a.destino_cidade_nome||"-"}),e.jsx("td",{children:a.data_embarque?new Date(a.data_embarque).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{children:a.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:a.valor_taxas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{className:"th-actions",style:{textAlign:"center"},children:e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>oa(a),title:"Ver detalhes",children:"ðŸ‘ï¸"})})]},a.id))]})]})})]}),e.jsxs("div",{className:"card-base card-blue mb-2",children:[e.jsx("h4",{style:{marginBottom:8},children:"OrÃ§amentos do cliente"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[760px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Venda"}),e.jsx("th",{className:"th-actions",style:{textAlign:"center"},children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[Le.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:"Nenhum orÃ§amento encontrado."})}),Le.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.data_orcamento?new Date(a.data_orcamento).toLocaleDateString("pt-BR").replaceAll("/","-"):"-"}),e.jsx("td",{style:{textTransform:"capitalize"},children:a.status||"-"}),e.jsx("td",{children:a.destino_cidade_nome||"-"}),e.jsx("td",{children:a.produto_nome||"-"}),e.jsx("td",{children:(a.valor??0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:a.numero_venda||"-"}),e.jsx("td",{className:"th-actions",style:{textAlign:"center"},children:e.jsx("button",{className:"btn-icon",type:"button",onClick:()=>na(a),title:"Ver detalhes",children:"ðŸ‘ï¸"})})]},a.id))]})]})})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:ze,children:"Fechar"})})]})}),E&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:720},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{children:e.jsx("div",{className:"modal-title",style:{color:"#16a34a",fontSize:"1.15rem",fontWeight:800},children:"Detalhes da venda"})}),e.jsx("button",{className:"btn-ghost",onClick:()=>{Y(null),M([])},children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{style:{display:"grid",gap:6,lineHeight:1.4,marginBottom:8},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Recibo:"})," ",Z.length>0?Z.map(a=>a.numero_recibo||"-").join(", "):"â€”"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Destino:"})," ",E.destino_cidade_nome||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"LanÃ§amento:"})," ",new Date(E.data_lancamento).toLocaleDateString("pt-BR")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Embarque:"})," ",E.data_embarque?new Date(E.data_embarque).toLocaleDateString("pt-BR"):"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor:"})," ",E.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Taxas:"})," ",E.valor_taxas===0?"-":E.valor_taxas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]}),e.jsx("h4",{style:{marginBottom:8,textAlign:"center"},children:"Recibos"}),Ye?e.jsx("p",{children:"Carregando recibos..."}):e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue",style:{minWidth:520},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"NÃºmero"}),e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Taxas"})]})}),e.jsxs("tbody",{children:[Z.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Nenhum recibo encontrado."})}),Z.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.numero_recibo||"-"}),e.jsx("td",{children:a.produto_nome||"-"}),e.jsx("td",{children:(a.valor_total||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx("td",{children:(a.valor_taxas||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},t))]})]})})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{Y(null),M([])},children:"Fechar"})})]})}),R&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-panel",style:{maxWidth:640},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"modal-title",style:{color:"#1d4ed8",fontSize:"1.15rem",fontWeight:800},children:"Detalhes do orÃ§amento"}),e.jsxs("small",{style:{color:"#64748b"},children:["Destino: ",R.destino_nome||"-"]})]}),e.jsx("button",{className:"btn-ghost",onClick:()=>ee(null),children:"âœ•"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{style:{display:"grid",gap:6,lineHeight:1.4,marginBottom:4},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Data:"})," ",R.data_orcamento?new Date(R.data_orcamento).toLocaleDateString("pt-BR"):"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",R.status||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Valor:"})," ",(R.valor||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Venda vinculada:"})," ",R.numero_venda||"-"]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-outline",onClick:()=>ee(null),children:"Fechar"})})]})})]})}export{ya as default};
