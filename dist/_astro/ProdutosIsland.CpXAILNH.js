import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as l}from"./index.C0Fn7Wtz.js";import{s as p}from"./supabase.Ng8nq9tn.js";import{u as Da}from"./usePermissao.DiLe8-Rs.js";import{t as Q}from"./titleCase.DQLlfrnh.js";import{L as Ta}from"./LoadingUsuarioContext.BaDUNi7o.js";function b(i){return(i||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}const sa=[{value:"Economico",label:"EconÃ´mico"},{value:"Intermediario",label:"IntermediÃ¡rio"},{value:"Variavel",label:"VariÃ¡vel"},{value:"Premium",label:"Premium"},{value:"Super Premium",label:"Super Premium"}],Pa=new Set(["hotel","pousada","resort"]);function Aa(i){if(!i)return"";const v=b(i),f=sa.find(y=>b(y.value)===v||b(y.label)===v);return f?f.label:i}function Fa(i){if(!i)return!1;const v=b(i.nome||i.tipo||"");return Pa.has(v)}function Va(){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2)}`}function $a(i){const v=i.trim();if(!v)return null;const f=v.replace(/[^\d.,-]/g,"");if(!f)return null;const y=f.includes(","),C=f.includes(".");let S=f;y&&C||y&&!C?S=f.replace(/\./g,"").replace(",","."):C&&((f.match(/\./g)||[]).length>1?S=f.replace(/\./g,""):f.split(".")[1]?.length!==2&&(S=f.replace(/\./g,"")));const q=Number(S);return Number.isFinite(q)?q:null}function N(i){return i?$a(i):null}function Ce(i){if(!i)return null;const v=i.replace("%","").trim(),f=N(v);return f==null?null:f>1?f/100:f}function aa(i){return i==null||Number.isNaN(i)?"-":`${(i*100).toFixed(1)}%`}function we(i,v){const f=N(i),y=Ce(v);if(f==null||y==null||y>=1)return"";const C=f/(1-y);return Number.isFinite(C)?C.toFixed(2):""}function T(i,v){if(i==null||Number.isNaN(i))return"-";const f=i.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});return`${v||"R$"} ${f}`}function Ra(i,v=4){return i==null||Number.isNaN(i)?"-":i.toLocaleString("pt-BR",{minimumFractionDigits:Math.min(2,v),maximumFractionDigits:v})}function oa(i){return i==null||Number.isNaN(i)?"":i.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}function ie(i){return i?(i.nome_fantasia?.trim()||i.nome_completo?.trim()||"").trim():""}const ra={nome:"",destino:"",cidade_id:"",tipo_produto:"",atracao_principal:"",melhor_epoca:"",duracao_sugerida:"",nivel_preco:"",imagem_url:"",informacoes_importantes:"",ativo:!0,fornecedor_id:"",fornecedor_label:"",todas_as_cidades:!1,valor_neto:"",margem:"20%",valor_venda:"",moeda:"USD",cambio:"5,00",valor_em_reais:""},J={acomodacao:"",qte_pax:"",tipo:"",validade_de:"",validade_ate:"",valor_neto:"",padrao:"Padrao",margem:""};function Oa(){const{permissao:i,ativo:v,loading:f}=Da("Cadastros"),[y,C]=l.useState([]),[S,q]=l.useState([]),[V,le]=l.useState([]),[B,Se]=l.useState([]),[Ee,ta]=l.useState([]),[s,X]=l.useState(ra),[$,ia]=l.useState(""),[I,k]=l.useState(""),[la,P]=l.useState(!1),[Me,L]=l.useState([]),[ne,De]=l.useState(!1),[de,Te]=l.useState(!0),[ce,Pe]=l.useState(!1),[me,Ae]=l.useState(null),[Fe,Ve]=l.useState(null),[ue,j]=l.useState(null),[$e,Z]=l.useState(null),[z,na]=l.useState(!1),[E,da]=l.useState(null),[U,Re]=l.useState([]),[fe,pe]=l.useState(!1),[qe,Be]=l.useState(null),[O,G]=l.useState([]),[ca,ee]=l.useState(!1),[c,H]=l.useState(J),[Ie,w]=l.useState(null),[ke,ae]=l.useState([]),[Le,ze]=l.useState([]),[Ue,W]=l.useState(null),[he,Y]=l.useState("");async function oe(a=!1){const o=[],r=[];Te(!0),j(null);try{const[{data:t,error:d},{data:u,error:n},g,D]=await Promise.all([p.from("paises").select("id, nome").order("nome"),p.from("subdivisoes").select("id, nome, pais_id").order("nome"),p.from("tipo_produtos").select("id, nome, tipo").eq("ativo",!0).order("nome").then(async h=>h.error?(r.push(`tipo_produtos: ${h.error.message}`),console.warn("Fallback tipo_produtos por 'tipo':",h.error),await p.from("tipo_produtos").select("id, nome, tipo").order("tipo")):h),p.from("produtos").select("id, nome, destino, cidade_id, tipo_produto, informacoes_importantes, atracao_principal, melhor_epoca, duracao_sugerida, nivel_preco, imagem_url, ativo, fornecedor_id, created_at, todas_as_cidades, valor_neto, margem, valor_venda, moeda, cambio, valor_em_reais").order(a?"nome":"created_at",{ascending:!!a}).limit(a?void 0:10)]);d?(o.push("paises"),d.message&&r.push(`paises: ${d.message}`)):C(t||[]);const A=u||[];if(n?(o.push("subdivisoes"),n.message&&r.push(`subdivisoes: ${n.message}`)):q(A),g.error)o.push("tipo_produtos"),g.error.message&&r.push(`tipo_produtos: ${g.error.message}`);else{const h=g.data||[];if(h.length===0){const{data:x,error:_}=await p.from("tipo_produtos").select("id, nome, tipo").order("nome");_?(o.push("tipo_produtos"),r.push(`tipo_produtos (fallback): ${_.message}`)):Se(x||[])}else Se(h)}if(D.error)o.push("produtos"),D.error.message&&r.push(`produtos: ${D.error.message}`);else{const h=D.data||[];ta(h),na(a);const x=Array.from(new Set(h.map(_=>_.cidade_id).filter(Boolean)));if(x.length){const{data:_,error:F}=await p.from("cidades").select("id, nome, subdivisao_id, subdivisoes (id, nome, pais_id)").in("id",x);if(F)o.push("cidades"),F.message&&r.push(`cidades: ${F.message}`);else{const te=_||[];le(te);const Xe=Array.from(new Set(te.map(Ne=>Ne.subdivisao_id).filter(Boolean)));if(Xe.length){const Ne=new Set(A.map(R=>R.id)),Ze=Xe.filter(R=>!Ne.has(R));if(Ze.length){const{data:R,error:ye}=await p.from("subdivisoes").select("id, nome, pais_id").in("id",Ze);ye?(o.push("subdivisoes"),ye.message&&r.push(`subdivisoes (faltantes): ${ye.message}`)):R?.length&&q(Ma=>{const ea=new Map(Ma.map(K=>[K.id,K]));return R.forEach(K=>ea.set(K.id,K)),Array.from(ea.values())})}}}}else le([])}}catch(t){console.error(t),o.push("geral"),t?.message&&r.push(`geral: ${t.message}`)}finally{if(o.length){const t=r.length?` Detalhes: ${r.join(" | ")}`:"";j(`Erro ao carregar: ${o.join(", ")}. Verifique permissoes/RLS.${t}`)}Te(!1)}}l.useEffect(()=>{oe(!1)},[]),l.useEffect(()=>{let a=!0;async function o(){try{const{data:r}=await p.auth.getSession(),d=r?.session?.user||(await p.auth.getUser()).data?.user||null;if(!d||!a)return;const{data:u,error:n}=await p.from("users").select("company_id").eq("id",d.id).maybeSingle();if(!a)return;if(n){console.error("Erro ao buscar company_id dos fornecedores:",n);return}da(u?.company_id||null)}catch(r){console.error("Erro ao determinar company_id dos fornecedores:",r)}}return o(),()=>{a=!1}},[]),l.useEffect(()=>{if(!E){Re([]);return}let a=!0;async function o(){const{data:r,error:t}=await p.from("fornecedores").select("id, nome_completo, nome_fantasia").eq("company_id",E).order("nome_fantasia",{ascending:!0});if(a){if(t){console.error("Erro ao carregar fornecedores:",t);return}Re(r||[])}}return o(),()=>{a=!1}},[E]),l.useEffect(()=>{if(!E){ae([]);return}let a=!0;async function o(){const{data:r,error:t}=await p.from("acomodacoes").select("nome").order("nome");if(!a)return;if(t){console.error("Erro ao carregar acomodacoes:",t);return}const d=(r||[]).map(u=>(u?.nome||"").toString().trim()).filter(Boolean);ae(d)}return o(),()=>{a=!1}},[E]),l.useEffect(()=>{if(!E){ze([]),W(null),Y("");return}let a=!0;async function o(){const{data:r,error:t}=await p.from("parametros_cambios").select("moeda, data, valor").eq("company_id",E).order("data",{ascending:!1}).order("created_at",{ascending:!1});if(a){if(t){console.error("Erro ao carregar cÃ¢mbios:",t);return}ze(r||[]),W(null),Y("")}}return o(),()=>{a=!1}},[E]),l.useEffect(()=>{$.trim()&&!z&&oe(!0)},[$,z]);const Oe=l.useMemo(()=>new Map(S.map(a=>[a.id,a])),[S]),Ge=l.useMemo(()=>new Map(U.map(a=>[a.id,ie(a)])),[U]);function ma(a){if(!a)return"";const o=V.find(t=>t.id===a);if(!o)return"";const r=Oe.get(o.subdivisao_id);return r?`${o.nome} (${r.nome})`:o.nome}function He(a){return a&&((a.nome||"").trim()||a.tipo)||""}const ve=l.useMemo(()=>{const a=new Map(V.map(t=>[t.id,t])),o=new Map(y.map(t=>[t.id,t])),r=new Map(B.map(t=>[t.id,t]));return Ee.map(t=>{const d=t.todas_as_cidades?null:a.get(t.cidade_id||""),u=d?Oe.get(d.subdivisao_id)||d.subdivisoes:void 0,n=u?o.get(u.pais_id):void 0,g=t.tipo_produto?r.get(t.tipo_produto):void 0;return{...t,cidade_nome:t.todas_as_cidades?"Todas as cidades":d?.nome||"",subdivisao_nome:u?.nome||"",pais_nome:n?.nome||"",tipo_nome:He(g),fornecedor_nome:Ge.get(t.fornecedor_id||"")||""}})},[Ee,V,S,y,B,Ge]),We=l.useMemo(()=>{if(!$.trim())return ve;const a=b($);return ve.filter(o=>b(o.nome).includes(a)||b(o.cidade_nome).includes(a)||b(o.subdivisao_nome).includes(a)||b(o.pais_nome).includes(a)||b(o.tipo_nome).includes(a)||b(o.destino||"").includes(a))},[$,ve]),Ye=l.useMemo(()=>{const a={};return Le.forEach(o=>{const r=(o.moeda||"R$").trim();if(!r||o.valor==null)return;const t=a[r];(!t||o.data>t.data)&&(a[r]={valor:o.valor,data:o.data})}),a},[Le]),ua=l.useMemo(()=>s.tipo_produto&&B.find(a=>a.id===s.tipo_produto)||null,[s.tipo_produto,B]),re=Fa(ua),xe=s.moeda.trim()||"USD",fa=c.padrao==="Manual"?c.margem||"":s.margem||"20%",pa=we(c.valor_neto,fa),se=N(pa),ha=N(s.cambio)??0,va=se!=null?se*ha:0,ge=!!me?"full":qe===null?"selection":qe?"global":"full",be=ge==="global",m=l.useCallback((a,o)=>{X(r=>{const t={...r,[a]:o};if(a==="valor_neto"||a==="margem"){const n=a==="valor_neto"?o:r.valor_neto,g=a==="margem"?o:r.margem;t.valor_venda=we(n,g)}const d=N(t.valor_venda),u=N(t.cambio);if(d!=null&&u!=null){const n=d*u;t.valor_em_reais=oa(n)}else t.valor_em_reais="";return t})},[]);l.useEffect(()=>{if(!s.moeda)return;const a=Ye[s.moeda];if(!a)return;const o=a.valor.toFixed(2);(!s.cambio||Ue!==s.moeda||s.cambio===he&&he!==o)&&(m("cambio",o),W(s.moeda),Y(o))},[s.moeda,Ye,s.cambio,Ue,he,m]);function xa(a){if(s.todas_as_cidades)return;k(a);const o=V.find(r=>r.id===s.cidade_id);(!o||!b(o.nome).includes(b(a)))&&X(r=>({...r,cidade_id:""})),P(!0)}function Ke(a){m("todas_as_cidades",a),a&&(m("cidade_id",""),k(""),P(!1),L([]))}function Qe(a){Be(a),Ke(a),a?m("destino",Q("Global")):m("destino","")}function ga(a){m("fornecedor_label",a);const o=a.trim().toLowerCase();if(!o){m("fornecedor_id","");return}const r=U.find(t=>ie(t).toLowerCase()===o);m("fornecedor_id",r?r.id:"")}const M=l.useCallback((a,o)=>{H(r=>{const t={...r,[a]:o};return a==="padrao"&&o==="Padrao"&&(t.margem=""),t})},[]);function ba(){H(J),w(null),ee(!0)}function _e(){ee(!1),H(J),w(null)}function _a(a){G(o=>o.filter(r=>r.id!==a))}async function ja(a){if(a.preventDefault(),!c.acomodacao.trim()){w("Informe a acomodaÃ§Ã£o.");return}if(!c.tipo.trim()){w("Informe o tipo de tarifa.");return}if(!c.validade_de||!c.validade_ate){w("Informe o perÃ­odo de validade.");return}const o=Number.parseInt(c.qte_pax,10);if(!Number.isFinite(o)||o<=0){w("Informe a quantidade de passageiros.");return}const r=N(c.valor_neto);if(r==null){w("Informe o valor neto.");return}const t=c.padrao==="Manual"?c.margem||"":s.margem||"20%",d=we(c.valor_neto,t),u=N(d);if(u==null){w("NÃ£o foi possÃ­vel calcular o valor de venda.");return}const n=Ce(t),g=N(s.cambio)??0,D=u*(g||0),A={id:Va(),acomodacao:c.acomodacao.trim(),qte_pax:o,tipo:c.tipo.trim(),validade_de:c.validade_de,validade_ate:c.validade_ate,valor_neto:r,padrao:c.padrao,margem:n,valor_venda:u,valor_em_reais:D,moeda:s.moeda.trim()||"USD",cambio:g};G(h=>[...h,A]),c.acomodacao&&!ke.some(h=>b(h)===b(c.acomodacao.trim()))&&ae(h=>[...h,c.acomodacao.trim()]),w(null),_e()}async function Na(a,o,r){if(a)try{const{data:t,error:d}=await p.from("produtos_tarifas").select("id, acomodacao, qte_pax, tipo, validade_de, validade_ate, valor_neto, padrao, margem, valor_venda, moeda, cambio, valor_em_reais").eq("produto_id",a).order("validade_de",{ascending:!0});if(d){console.error("Erro ao carregar tarifas do produto:",d);return}const u=(t||[]).map(n=>({id:n.id,acomodacao:n.acomodacao,qte_pax:n.qte_pax??0,tipo:n.tipo||"",validade_de:n.validade_de?String(n.validade_de).slice(0,10):"",validade_ate:n.validade_ate?String(n.validade_ate).slice(0,10):"",valor_neto:n.valor_neto??0,padrao:n.padrao==="Manual"?"Manual":"Padrao",margem:n.margem??null,valor_venda:n.valor_venda??0,valor_em_reais:n.valor_em_reais??0,moeda:n.moeda||o||"USD",cambio:n.cambio??r}));G(u)}catch(t){console.error("Erro ao carregar tarifas do produto:",t)}}async function ya(a){if(!a)return;const o=Array.from(new Set(O.map(r=>r.acomodacao.trim()).filter(Boolean)));try{const{error:r}=await p.from("produtos_tarifas").delete().eq("produto_id",a);if(r)throw r;if(O.length){const t=O.map(({id:u,...n})=>({...n,produto_id:a})),{error:d}=await p.from("produtos_tarifas").insert(t);if(d)throw d}if(o.length){const{error:t}=await p.from("acomodacoes").upsert(o.map(d=>({nome:d})),{onConflict:"nome"});t?console.error("Erro ao atualizar acomodacoes:",t):ae(d=>{const u=new Set(d.map(g=>b(g))),n=o.filter(g=>!u.has(b(g)));return n.length?[...d,...n]:d})}}catch(r){throw console.error("Erro ao sincronizar tarifas:",r),r}}function je(){X(ra),W(null),Y(""),Ae(null),j(null),k(""),P(!1),Be(null),G([]),ee(!1),H(J),w(null)}function wa(a){const o=V.find(r=>r.id===a.cidade_id);Ae(a.id),X({nome:a.nome,cidade_id:a.cidade_id,tipo_produto:a.tipo_produto||"",atracao_principal:a.atracao_principal||"",melhor_epoca:a.melhor_epoca||"",duracao_sugerida:a.duracao_sugerida||"",nivel_preco:a.nivel_preco||"",imagem_url:a.imagem_url||"",informacoes_importantes:a.informacoes_importantes||"",ativo:a.ativo??!0,destino:a.destino||"",fornecedor_id:a.fornecedor_id||"",fornecedor_label:ie(U.find(r=>r.id===a.fornecedor_id)),todas_as_cidades:a.todas_as_cidades??!1,valor_neto:a.valor_neto!=null?a.valor_neto.toFixed(2):"",margem:a.margem!=null?`${(a.margem*100).toFixed(2)}%`:"",valor_venda:a.valor_venda!=null?a.valor_venda.toFixed(2):"",moeda:a.moeda||"R$",cambio:a.cambio!=null?a.cambio.toFixed(2):"",valor_em_reais:oa(a.valor_em_reais)}),G([]),ee(!1),H(J),w(null),W(null),Y(""),k(a.todas_as_cidades?"":ma(a.cidade_id)||o?.nome||""),P(!1),pe(!0),Na(a.id,a.moeda||"USD",a.cambio??0)}function Ca(){je(),pe(!0),j(null)}function Je(){je(),pe(!1)}l.useEffect(()=>{if(I.trim().length<2){L([]);return}const a=new AbortController,o=setTimeout(async()=>{De(!0),Z(null);try{const{data:r,error:t}=await p.rpc("buscar_cidades",{q:I.trim(),limite:10},{signal:a.signal});if(!a.signal.aborted)if(t){console.error("Erro ao buscar cidades:",t),Z("Erro ao buscar cidades (RPC). Tentando fallback...");const{data:d,error:u}=await p.from("cidades").select("id, nome, subdivisao_id").ilike("nome",`%${I.trim()}%`).order("nome");u?(console.error("Erro no fallback de cidades:",u),Z("Erro ao buscar cidades.")):(L(d||[]),Z(null))}else L(r||[])}finally{a.signal.aborted||De(!1)}},300);return()=>{a.abort(),clearTimeout(o)}},[I]);async function Sa(a){if(a.preventDefault(),i==="view"){j("Voce nao tem permissao para salvar produtos.");return}if(!s.nome.trim()){j("Nome e obrigatorio.");return}if(!s.destino.trim()){j("Destino e obrigatorio.");return}if(!s.todas_as_cidades&&!s.cidade_id){j("Cidade e obrigatoria quando o produto nao for global.");return}if(!s.tipo_produto){j("Tipo de produto e obrigatorio.");return}try{Pe(!0),j(null);const o=x=>{const _=x?.message||x?.error?.message||"",F=x?.details||x?.error?.details||"",te=x?.hint||x?.error?.hint||"";return[_,F,te].filter(Boolean).join(" | ")},r=Q(s.nome),t=Q(s.destino),d=N(s.valor_neto),u=Ce(s.margem),n=N(s.valor_venda),g=N(s.cambio),D=N(s.valor_em_reais),A={nome:r,destino:t,cidade_id:s.todas_as_cidades?null:s.cidade_id,tipo_produto:s.tipo_produto,atracao_principal:s.atracao_principal.trim()||null,melhor_epoca:s.melhor_epoca.trim()||null,duracao_sugerida:s.duracao_sugerida.trim()||null,nivel_preco:s.nivel_preco.trim()||null,imagem_url:s.imagem_url.trim()||null,informacoes_importantes:s.informacoes_importantes.trim()||null,ativo:s.ativo,fornecedor_id:s.fornecedor_id||null,todas_as_cidades:s.todas_as_cidades,valor_neto:d,margem:u,valor_venda:n,moeda:s.moeda.trim()||null,cambio:g,valor_em_reais:D};let h=me;if(h){const{error:x}=await p.from("produtos").update(A).eq("id",h);if(x){const _=o(x);throw new Error(_||x.message)}}else{const{data:x,error:_}=await p.from("produtos").insert(A).select("id").maybeSingle();if(_){const F=o(_);throw new Error(F||_.message)}if(h=x?.id||null,!h)throw new Error("NÃ£o foi possÃ­vel identificar o produto salvo.")}await ya(h),je(),await oe(z)}catch(o){console.error(o);const r=o?.message||o?.error?.message||"";j(`Erro ao salvar produto.${r?` Detalhes: ${r}`:""}`)}finally{Pe(!1)}}async function Ea(a){if(i!=="admin"){alert("Somente administradores podem excluir produtos.");return}if(confirm("Tem certeza que deseja excluir este produto?"))try{Ve(a),j(null);const{error:o}=await p.from("produtos").delete().eq("id",a);if(o)throw o;await oe(z)}catch(o){console.error(o),j("Nao foi possivel excluir o produto. Verifique vinculos com vendas/orcamentos.")}finally{Ve(null)}}return f?e.jsx(Ta,{}):v?e.jsxs("div",{className:"destinos-page",children:[e.jsx("div",{className:"card-base mb-3",children:e.jsxs("div",{className:"form-row",style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-end"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1 1 320px"},children:[e.jsx("label",{className:"form-label",children:"Buscar produto"}),e.jsx("input",{className:"form-input",value:$,onChange:a=>ia(a.target.value),placeholder:"Busque por nome, tipo, destino, cidade, estado/provÃ­ncia ou paÃ­s"})]}),i!=="view"&&e.jsx("div",{className:"form-group",style:{alignItems:"flex-end"},children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Ca,disabled:fe,children:"Adicionar produto"})})]})}),fe&&ge==="selection"&&e.jsxs("div",{className:"card-base card-blue mb-3",children:[e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Todas as cidades"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:()=>Qe(!1),children:"Nao"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>Qe(!0),children:"Sim"})]}),e.jsx("small",{style:{color:"#64748b"},children:'Escolha "Sim" para cadastrar um produto global; "Nao" abre o formulario completo.'})]})}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",style:{justifyContent:"flex-end"},children:e.jsx("button",{type:"button",className:"btn btn-light",onClick:Je,children:"Cancelar"})})]}),fe&&ge!=="selection"&&e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:Sa,children:[e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tipo *"}),e.jsxs("select",{className:"form-select",value:s.tipo_produto,onChange:a=>m("tipo_produto",a.target.value),disabled:i==="view",children:[e.jsx("option",{value:"",children:"Selecione o tipo"}),B.map(a=>e.jsx("option",{value:a.id,children:He(a)||"(sem nome)"},a.id))]})]})}),!be&&e.jsxs("div",{className:"form-row",style:{marginTop:12,gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Cidade *"}),e.jsx("input",{className:"form-input",placeholder:"Digite o nome da cidade",value:I,onChange:a=>xa(a.target.value),onFocus:()=>P(!0),onBlur:()=>setTimeout(()=>P(!1),150),disabled:i==="view"||s.todas_as_cidades,style:{marginBottom:6}}),ne&&e.jsx("div",{style:{fontSize:12,color:"#6b7280"},children:"Buscando..."}),$e&&!ne&&e.jsx("div",{style:{fontSize:12,color:"#dc2626"},children:$e}),la&&e.jsxs("div",{className:"card-base",style:{marginTop:4,maxHeight:180,overflowY:"auto",padding:6,border:"1px solid #e5e7eb"},children:[Me.length===0&&!ne&&e.jsx("div",{style:{padding:"4px 6px",color:"#6b7280"},children:"Nenhuma cidade encontrada."}),Me.map(a=>{const o=a.subdivisao_nome?`${a.nome} (${a.subdivisao_nome})`:a.nome;return e.jsxs("button",{type:"button",className:"btn btn-light",style:{width:"100%",justifyContent:"flex-start",marginBottom:4,background:s.cidade_id===a.id?"#e0f2fe":"#fff",borderColor:s.cidade_id===a.id?"#38bdf8":"#e5e7eb"},onMouseDown:r=>{r.preventDefault(),m("cidade_id",a.id),k(o),P(!1),L([])},children:[o,a.pais_nome?e.jsxs("span",{style:{color:"#6b7280",marginLeft:6},children:["- ",a.pais_nome]}):null]},a.id)})]}),e.jsx("small",{style:{color:"#64748b"},children:"Cidade selecionada pode ajudar a preencher o destino automaticamente."})]}),e.jsxs("div",{className:"form-group",style:{width:220},children:[e.jsx("label",{className:"form-label",children:"Todas as cidades"}),e.jsxs("select",{className:"form-select",value:s.todas_as_cidades?"true":"false",onChange:a=>Ke(a.target.value==="true"),disabled:i==="view",children:[e.jsx("option",{value:"false",children:"Nao"}),e.jsx("option",{value:"true",children:"Sim"})]}),e.jsx("small",{style:{color:"#64748b"},children:"Produtos globais ficam disponiveis para qualquer cidade e nao salvam cidade especifica."})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Nome do produto *"}),e.jsx("input",{className:"form-input",value:s.nome,onChange:a=>m("nome",a.target.value),onBlur:a=>m("nome",Q(a.target.value)),placeholder:"Ex: Passeio em Gramado, Pacote Paris...",disabled:i==="view"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Fornecedor (opcional)"}),e.jsx("input",{className:"form-input",list:"fornecedores-list",placeholder:"Escolha um fornecedor",value:s.fornecedor_label,onChange:a=>ga(a.target.value),disabled:i==="view"}),e.jsx("datalist",{id:"fornecedores-list",children:U.map(a=>e.jsx("option",{value:ie(a)},a.id))})]})]}),e.jsx("div",{className:"form-row",style:{marginTop:12},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Destino *"}),e.jsx("input",{className:"form-input",value:s.destino,onChange:a=>m("destino",a.target.value),onBlur:a=>m("destino",Q(a.target.value)),placeholder:be?"Global":"Ex: Disney, Porto de Galinhas",disabled:i==="view"||be}),e.jsx("small",{style:{color:"#64748b"},children:"Cidade escolhida serÃ¡ aplicada quando o destino estiver vazio."})]})}),re&&e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Atracao principal"}),e.jsx("input",{className:"form-input",value:s.atracao_principal,onChange:a=>m("atracao_principal",a.target.value),placeholder:"Ex: Disney, Torre Eiffel...",disabled:i==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Melhor epoca"}),e.jsx("input",{className:"form-input",value:s.melhor_epoca,onChange:a=>m("melhor_epoca",a.target.value),placeholder:"Ex: Dezembro a Marco",disabled:i==="view"})]})]}),re&&e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Duracao sugerida"}),e.jsxs("select",{className:"form-select",value:s.duracao_sugerida,onChange:a=>m("duracao_sugerida",a.target.value),disabled:i==="view",children:[e.jsx("option",{value:"",children:"Selecione"}),e.jsx("option",{value:"De 1 a 3 dias",children:"De 1 a 3 dias"}),e.jsx("option",{value:"De 3 a 5 dias",children:"De 3 a 5 dias"}),e.jsx("option",{value:"De 5 a 7 dias",children:"De 5 a 7 dias"}),e.jsx("option",{value:"De 7 a 10 dias",children:"De 7 a 10 dias"}),e.jsx("option",{value:"10 dias ou mais",children:"10 dias ou mais"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Nivel de preco"}),e.jsxs("select",{className:"form-select",value:s.nivel_preco,onChange:a=>m("nivel_preco",a.target.value),disabled:i==="view",children:[e.jsx("option",{value:"",children:"Selecione"}),sa.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Imagem (URL)"}),e.jsx("input",{className:"form-input",value:s.imagem_url,onChange:a=>m("imagem_url",a.target.value),placeholder:"URL de uma imagem do destino",disabled:i==="view"})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Moeda"}),e.jsx("input",{type:"text",className:"form-input",list:"moeda-sugestoes",value:s.moeda,onChange:a=>m("moeda",a.target.value),disabled:i==="view"}),e.jsxs("datalist",{id:"moeda-sugestoes",children:[e.jsx("option",{value:"R$"}),e.jsx("option",{value:"USD"}),e.jsx("option",{value:"EUR"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Valor Neto / Moeda Local"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Ex: 1000",value:s.valor_neto,onChange:a=>m("valor_neto",a.target.value),disabled:i==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Margem"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Ex: 0.80 (80%)",value:s.margem,onChange:a=>m("margem",a.target.value),disabled:i==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Valor Venda / Moeda Local"}),e.jsx("input",{type:"text",className:"form-input",value:s.valor_venda,readOnly:!0,placeholder:"Calculado automaticamente"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CÃ¢mbio"}),e.jsx("input",{type:"text",className:"form-input",inputMode:"decimal",placeholder:"Atualizado automaticamente",value:s.cambio,onChange:a=>m("cambio",a.target.value),disabled:i==="view"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Valor em R$"}),e.jsx("input",{type:"text",className:"form-input",readOnly:!0,placeholder:"Calculado automaticamente",value:s.valor_em_reais})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:16,alignItems:"center"},children:[e.jsxs("div",{className:"form-group",style:{flex:1,gap:4},children:[e.jsx("div",{className:"form-label",children:"PadrÃ£o do Fornecedor"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",style:{fontSize:"0.9rem",opacity:.85},children:[e.jsx("strong",{children:"Moeda:"})," ",s.moeda||"USD",e.jsx("strong",{children:"Margem:"})," ",s.margem||"20%",e.jsx("strong",{children:"CÃ¢mbio:"})," ",s.cambio||"5,00"]})]}),re&&e.jsx("div",{className:"form-group",style:{alignItems:"flex-end"},children:e.jsx("button",{type:"button",className:"btn btn-light",onClick:ba,disabled:i==="view",children:"Adicionar Tarifa"})})]}),re&&e.jsx("div",{className:"form-row",style:{marginTop:12},children:e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[1080px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"AcomodaÃ§Ã£o"}),e.jsx("th",{children:"Pax"}),e.jsx("th",{children:"De"}),e.jsx("th",{children:"AtÃ©"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Valor Neto"}),e.jsx("th",{children:"PadrÃ£o"}),e.jsx("th",{children:"Margem"}),e.jsx("th",{children:"Valor Venda"}),e.jsx("th",{children:"Valor em R$"}),e.jsx("th",{className:"th-actions",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{children:O.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,children:"Nenhuma tarifa cadastrada."})}):O.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.acomodacao}),e.jsx("td",{children:a.qte_pax}),e.jsx("td",{children:a.validade_de}),e.jsx("td",{children:a.validade_ate}),e.jsx("td",{children:a.tipo}),e.jsx("td",{children:T(a.valor_neto,a.moeda)}),e.jsx("td",{children:a.padrao}),e.jsx("td",{children:aa(a.margem)}),e.jsx("td",{children:T(a.valor_venda,a.moeda)}),e.jsx("td",{children:T(a.valor_em_reais,"R$")}),e.jsx("td",{className:"th-actions",children:e.jsx("button",{type:"button",className:"btn btn-light",onClick:()=>_a(a.id),children:"Remover"})})]},a.id))})]})})}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{className:"form-label",children:"Informacoes importantes"}),e.jsx("textarea",{className:"form-input",rows:3,value:s.informacoes_importantes,onChange:a=>m("informacoes_importantes",a.target.value),placeholder:"Observacoes gerais, dicas, documentacao necessaria, etc.",disabled:i==="view"})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{className:"form-label",children:"Ativo"}),e.jsxs("select",{className:"form-select",value:s.ativo?"true":"false",onChange:a=>m("ativo",a.target.value==="true"),disabled:i==="view",children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"Nao"})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",style:{justifyContent:"flex-end"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:ce,children:ce?"Salvando...":me?"Salvar alteracoes":"Salvar produto"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:Je,disabled:ce,children:"Cancelar"})]}),ca&&e.jsx("div",{className:"modal-backdrop",children:e.jsx("div",{className:"modal-panel",children:e.jsxs("form",{onSubmit:ja,children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Adicionar tarifa"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:_e,children:"Fechar"})]}),e.jsxs("div",{className:"modal-body",children:[Ie&&e.jsx("div",{style:{color:"#dc2626",marginBottom:8},children:Ie}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Validade De"}),e.jsx("input",{type:"date",className:"form-input",value:c.validade_de,onChange:a=>M("validade_de",a.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Validade AtÃ©"}),e.jsx("input",{type:"date",className:"form-input",value:c.validade_ate,onChange:a=>M("validade_ate",a.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"AcomodaÃ§Ã£o"}),e.jsx("input",{className:"form-input",list:"acomodacoes-list",value:c.acomodacao,onChange:a=>M("acomodacao",a.target.value)}),e.jsx("datalist",{id:"acomodacoes-list",children:ke.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{className:"form-group",style:{width:120},children:[e.jsx("label",{className:"form-label",children:"Qte Pax"}),e.jsx("input",{type:"number",min:1,className:"form-input",value:c.qte_pax,onChange:a=>M("qte_pax",a.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Tipo"}),e.jsx("input",{className:"form-input",list:"tipo-tarifa-list",value:c.tipo,onChange:a=>M("tipo",a.target.value)}),e.jsx("datalist",{id:"tipo-tarifa-list",children:["diÃ¡ria","pacote"].map(a=>e.jsx("option",{value:a},a))})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{className:"form-label",children:["Valor Neto (",xe,")"]}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Ex: 1000",value:c.valor_neto,onChange:a=>M("valor_neto",a.target.value)})]}),e.jsxs("div",{className:"form-group",style:{width:180},children:[e.jsx("label",{className:"form-label",children:"PadrÃ£o"}),e.jsxs("select",{className:"form-select",value:c.padrao,onChange:a=>M("padrao",a.target.value),children:[e.jsx("option",{value:"Padrao",children:"PadrÃ£o"}),e.jsx("option",{value:"Manual",children:"Manual"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Margem"}),e.jsx("input",{type:"text",className:"form-input",placeholder:"Ex: 25%",value:c.margem,onChange:a=>M("margem",a.target.value),disabled:c.padrao!=="Manual"})]})]}),e.jsxs("div",{className:"form-row",style:{marginTop:12,gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{className:"form-label",children:["Valor Venda (",xe,")"]}),e.jsx("input",{type:"text",className:"form-input",value:se!=null?T(se,xe):"",readOnly:!0})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Valor em R$"}),e.jsx("input",{type:"text",className:"form-input",value:T(va,"R$"),readOnly:!0})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:_e,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:i==="view",children:"Salvar tarifa"})]})]})})})]})}),"      ",ue&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:ue})}),!z&&!ue&&e.jsx("div",{className:"card-base card-config mb-3",children:"Ultimos Produtos Cadastrados (10). Digite na busca para consultar todos."}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[1080px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Produto"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Cidade"}),e.jsx("th",{children:"Fornecedor"}),e.jsx("th",{children:"Nivel de preco"}),e.jsx("th",{children:"Valor Neto"}),e.jsx("th",{children:"Margem"}),e.jsx("th",{children:"Valor Venda"}),e.jsx("th",{children:"CÃ¢mbio"}),e.jsx("th",{children:"Valor em R$"}),e.jsx("th",{children:"Ativo"}),e.jsx("th",{children:"Criado em"}),e.jsx("th",{className:"th-actions",children:"Acoes"})]})}),e.jsxs("tbody",{children:[de&&e.jsx("tr",{children:e.jsx("td",{colSpan:13,children:"Carregando produtos..."})}),!de&&We.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:13,children:"Nenhum produto encontrado."})}),!de&&We.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome}),e.jsx("td",{children:a.destino||"-"}),e.jsx("td",{children:a.cidade_nome||"-"}),e.jsx("td",{children:a.fornecedor_nome||"-"}),e.jsx("td",{children:Aa(a.nivel_preco)||"-"}),e.jsx("td",{children:T(a.valor_neto,a.moeda||void 0)}),e.jsx("td",{children:aa(a.margem)}),e.jsx("td",{children:T(a.valor_venda,a.moeda||void 0)}),e.jsx("td",{children:Ra(a.cambio)}),e.jsx("td",{children:T(a.valor_em_reais,"R$")}),e.jsx("td",{children:a.ativo?"Sim":"Nao"}),e.jsx("td",{children:a.created_at?new Date(a.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"th-actions",children:e.jsxs("div",{className:"action-buttons",children:[i!=="view"&&e.jsx("button",{className:"btn-icon",title:"Editar",onClick:()=>wa(a),children:"âœï¸"}),(i==="admin"||i==="delete")&&e.jsx("button",{className:"btn-icon btn-danger",title:"Excluir",onClick:()=>Ea(a.id),disabled:Fe===a.id,children:Fe===a.id?"...":"ğŸ—‘ï¸"})]})})]},a.id))]})]})})]}):e.jsx("div",{children:"Voce nao possui acesso ao modulo de Cadastros."})}export{Oa as default};
