import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as a}from"./index.C0Fn7Wtz.js";import{s as d}from"./supabase.Ng8nq9tn.js";import{u as C}from"./usePermissao.DEV7Ufch.js";function P(){const{ativo:b,loading:f}=C("AdminDashboard"),[g,l]=a.useState(!0),[m,h]=a.useState(null),[x,N]=a.useState([]),[p,y]=a.useState([]),[j,_]=a.useState([]),[i,S]=a.useState({clientes:0,vendas:0,produtos:0,tipos:0}),[k,w]=a.useState(!1);return a.useEffect(()=>{async function s(){try{const{data:t}=await d.auth.getUser();if(!t?.user)return;const{data:o}=await d.from("users").select("id, user_types(name)").eq("id",t.user.id).maybeSingle(),n=o?.user_types?.name?.toUpperCase()||"";w(n.includes("ADMIN"))}catch(t){console.error(t)}}s()},[]),f?e.jsx("div",{children:"Carregando permissões..."}):!b||!k?e.jsx("div",{style:{padding:20},children:e.jsx("h3",{children:"Apenas administradores podem acessar este dashboard."})}):(a.useEffect(()=>{async function s(){try{l(!0),h(null);const{data:t}=await d.from("companies").select("*").order("nome_fantasia");N(t||[]);const{data:o}=await d.from("users").select("id, nome_completo, email, active, user_types(name)").order("nome_completo");y(o||[]);const{data:n}=await d.from("users").select("id, nome_completo, user_types(name)").contains("user_types(name)",["GESTOR"]);let u=[];if(n)for(const r of n){const{count:c}=await d.from("gestor_vendedor").select("*",{count:"exact",head:!0}).eq("gestor_id",r.id);u.push({id:r.id,nome_completo:r.nome_completo,vendedores:c||0})}_(u);const E=[{chave:"clientes",tabela:"clientes"},{chave:"vendas",tabela:"vendas"},{chave:"produtos",tabela:"produtos"},{chave:"tipos",tabela:"tipo_produtos"}],v={clientes:0,vendas:0,produtos:0,tipos:0};for(const{chave:r,tabela:c}of E){const{count:A}=await d.from(c).select("*",{count:"exact",head:!0});v[r]=A||0}S(v)}catch(t){console.error(t),h("Erro ao carregar dados administrativos.")}finally{l(!1)}}s()},[]),e.jsxs("div",{className:"dashboard-admin-page",children:[e.jsxs("div",{style:{marginBottom:16,padding:"12px 16px",background:"#4c0519",border:"1px solid #be123c",borderRadius:8,color:"#fecdd3"},children:[e.jsx("strong",{children:"Dashboard Administrativo"})," — Controle Geral do Sistema"]}),e.jsxs("div",{className:"card-base card-red mb-3",children:[e.jsx("h3",{style:{marginBottom:12},children:"Visão geral do sistema"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10},children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"Clientes"}),e.jsx("div",{className:"kpi-value",children:i.clientes})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"Vendas"}),e.jsx("div",{className:"kpi-value",children:i.vendas})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"Produtos"}),e.jsx("div",{className:"kpi-value",children:i.produtos})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-label",children:"Tipos de produto"}),e.jsx("div",{className:"kpi-value",children:i.tipos})]})]})]}),e.jsxs("div",{className:"card-base card-red mb-3",children:[e.jsx("h3",{style:{marginBottom:10},children:"Empresas cadastradas"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-red min-w-[760px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome fantasia"}),e.jsx("th",{children:"Razão Social"}),e.jsx("th",{children:"CNPJ"}),e.jsx("th",{children:"Cidade"}),e.jsx("th",{children:"UF"})]})}),e.jsxs("tbody",{children:[x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Nenhuma empresa cadastrada."})}),x.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome_fantasia}),e.jsx("td",{children:s.nome_empresa}),e.jsx("td",{children:s.cnpj}),e.jsx("td",{children:s.cidade||"-"}),e.jsx("td",{children:s.estado||"-"})]},s.id))]})]})})]}),e.jsxs("div",{className:"card-base card-red mb-3",children:[e.jsx("h3",{style:{marginBottom:10},children:"Usuários do sistema"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-red min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"E-mail"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Ativo"})]})}),e.jsxs("tbody",{children:[p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"Nenhum usuário encontrado."})}),p.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome_completo}),e.jsx("td",{children:s.email||"-"}),e.jsx("td",{children:s.user_types?.name||"-"}),e.jsx("td",{style:{color:s.active?"#22c55e":"#ef4444",fontWeight:"bold"},children:s.active?"Sim":"Não"})]},s.id))]})]})})]}),e.jsxs("div",{className:"card-base card-red mb-3",children:[e.jsx("h3",{style:{marginBottom:10},children:"Gestores & Equipes"}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-red min-w-[520px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Gestor"}),e.jsx("th",{children:"Qtd. Vendedores"})]})}),e.jsxs("tbody",{children:[j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:"Nenhum gestor encontrado."})}),j.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome_completo}),e.jsx("td",{children:s.vendedores})]},s.id))]})]})})]}),m&&e.jsx("div",{className:"card-base card-config",children:m}),g&&e.jsx("div",{children:"Carregando dados..."})]}))}export{P as default};
