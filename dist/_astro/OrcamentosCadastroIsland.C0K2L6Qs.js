import{s as r,j as e}from"./supabase.DNkd6bxA.js";import{r as a}from"./index.C0Fn7Wtz.js";import{u as R}from"./usePermissao.72SYthuA.js";function $(){const{ativo:I}=R("Vendas"),[q,w]=a.useState([]),[D,P]=a.useState([]),[V,O]=a.useState([]),[n,u]=a.useState(""),[i,m]=a.useState(""),[v,h]=a.useState(""),[c,p]=a.useState("novo"),[d,f]=a.useState(""),[x,j]=a.useState(""),[N,g]=a.useState(""),[b,S]=a.useState(!1),[C,l]=a.useState(null),[y,E]=a.useState(null);a.useEffect(()=>{_()},[]);async function _(){try{const[s,o,t]=await Promise.all([r.from("clientes").select("id, nome").eq("ativo",!0).order("nome"),r.from("destinos").select("id, nome").eq("ativo",!0).order("nome"),r.from("produtos").select("id, nome").eq("ativo",!0).order("nome")]);s.data&&w(s.data),o.data&&P(o.data),t.data&&O(t.data)}catch(s){console.error(s),l("Erro ao carregar listas.")}}async function F(s){if(s.preventDefault(),l(null),E(null),!n||!i||!c){l("Cliente, destino e status são obrigatórios.");return}try{S(!0);const o={cliente_id:n,destino_id:i||null,produto_id:v||null,status:c,valor:d?parseFloat(d):null,data_viagem:x||null,notas:N||null},{error:t}=await r.from("orcamentos").insert(o);if(t)throw t;E("Orçamento criado."),u(""),m(""),h(""),p("novo"),f(""),j(""),g("")}catch(o){console.error(o),l("Erro ao salvar orçamento.")}finally{S(!1)}}return I?e.jsxs("div",{className:"card-base card-blue mb-3",children:[e.jsx("h2",{className:"card-title",children:"Novo Orçamento"}),C&&e.jsx("div",{className:"auth-error",children:C}),y&&e.jsx("div",{className:"auth-success",children:y}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cliente *"}),e.jsxs("select",{className:"form-select",value:n,onChange:s=>u(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecione"}),q.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Destino *"}),e.jsxs("select",{className:"form-select",value:i,onChange:s=>m(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecione"}),D.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Produto"}),e.jsxs("select",{className:"form-select",value:v,onChange:s=>h(s.target.value),children:[e.jsx("option",{value:"",children:"(Opcional)"}),V.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:c,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"novo",children:"Novo"}),e.jsx("option",{value:"enviado",children:"Enviado"}),e.jsx("option",{value:"negociando",children:"Negociando"}),e.jsx("option",{value:"fechado",children:"Fechado"}),e.jsx("option",{value:"perdido",children:"Perdido"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Valor estimado (R$)"}),e.jsx("input",{className:"form-input",type:"number",value:d,onChange:s=>f(s.target.value),min:0,step:"0.01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data da viagem"}),e.jsx("input",{className:"form-input",type:"date",value:x,onChange:s=>j(s.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Notas"}),e.jsx("textarea",{className:"form-input",rows:3,value:N,onChange:s=>g(s.target.value),placeholder:"Observações, próximos passos..."})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:b,style:{marginTop:12},children:b?"Salvando...":"Criar orçamento"})]})]}):e.jsx("div",{children:"Acesso ao módulo de Vendas bloqueado."})}export{$ as default};
