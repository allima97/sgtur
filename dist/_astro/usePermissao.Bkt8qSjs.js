import{r as a}from"./index.C0Fn7Wtz.js";import{s as v}from"./supabase.Ng8nq9tn.js";const t=o=>{switch(o){case"admin":return 5;case"delete":return 4;case"edit":return 3;case"create":return 2;case"view":return 1;default:return 0}},h=o=>{const e=(o||"").toLowerCase();return e==="admin"?"admin":e==="delete"?"delete":e==="edit"?"edit":e==="create"?"create":e==="view"?"view":"none"};function x(o){const e=(o||"").trim(),[i,n]=a.useState("none"),[w,u]=a.useState(!1),[g,c]=a.useState(!!e);a.useEffect(()=>{let s=!1;if(!e){n("none"),u(!1),c(!1);return}async function E(){c(!0),n("none"),u(!1);try{const{data:d}=await v.auth.getSession(),l=d?.session?.user;if(!l)return;const{data:m,error:f}=await v.from("modulo_acesso").select("permissao, ativo").eq("usuario_id",l.id).ilike("modulo",e).maybeSingle();if(s)return;if(f){console.error("Erro ao carregar permiss찾o do m처dulo",e,f);return}const p=!!m?.ativo,S=h(m?.permissao);u(p),n(p?S:"none")}catch(d){s||console.error("Erro ao buscar permiss찾o do m처dulo",e,d)}finally{s||c(!1)}}return E(),()=>{s=!0}},[e]);const r=a.useMemo(()=>t(i),[i]);return{permissao:i,ativo:w,loading:g,nivel:r,isAdmin:i==="admin",podeVer:r>=t("view"),podeCriar:r>=t("create"),podeEditar:r>=t("edit"),podeExcluir:r>=t("delete"),has:s=>r>=t(s)}}export{x as u};
