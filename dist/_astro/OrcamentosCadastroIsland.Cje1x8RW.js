import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as a}from"./index.C0Fn7Wtz.js";import{s as r}from"./supabase.Ng8nq9tn.js";import{u as L}from"./usePermissao.DEV7Ufch.js";function A(){const{ativo:E}=L("Vendas"),[D,I]=a.useState([]),[q,V]=a.useState([]),[O,P]=a.useState([]),[n,i]=a.useState(""),[c,d]=a.useState(""),[g,u]=a.useState(""),[m,p]=a.useState("novo"),[v,h]=a.useState(""),[N,f]=a.useState(""),[b,x]=a.useState(""),[S,y]=a.useState(!1),[C,t]=a.useState(null),[w,j]=a.useState(null);a.useEffect(()=>{_()},[]);async function _(){try{const[s,o,l]=await Promise.all([r.from("clientes").select("id, nome").eq("ativo",!0).order("nome"),r.from("produtos").select("id, nome").eq("ativo",!0).order("nome"),r.from("tipo_produtos").select("id, nome, tipo").eq("ativo",!0).order("nome")]);s.data&&I(s.data),o.data&&V(o.data),l.data&&P(l.data)}catch(s){console.error(s),t("Erro ao carregar listas.")}}async function F(s){if(s.preventDefault(),t(null),j(null),!n||!c||!m){t("Cliente, destino e status são obrigatórios.");return}try{y(!0);const o={cliente_id:n,destino_id:c||null,produto_id:g||null,status:m,valor:v?parseFloat(v):null,data_viagem:N||null,notas:b||null},{error:l}=await r.from("orcamentos").insert(o);if(l)throw l;j("Orçamento criado."),window.dispatchEvent(new CustomEvent("orcamento-criado")),i(""),d(""),u(""),p("novo"),h(""),f(""),x("")}catch(o){console.error(o),t("Erro ao salvar orçamento.")}finally{y(!1)}}return E?e.jsxs("div",{className:"card-base card-blue mb-3",children:[e.jsx("h2",{className:"card-title",children:"Novo Orçamento"}),C&&e.jsx("div",{className:"auth-error",children:C}),w&&e.jsx("div",{className:"auth-success",style:{color:"#0f172a",fontWeight:700},children:w}),e.jsxs("form",{onSubmit:F,style:{display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Cliente *"}),e.jsxs("select",{className:"form-select",value:n,onChange:s=>i(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecione"}),D.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Destino *"}),e.jsxs("select",{className:"form-select",value:c,onChange:s=>d(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecione"}),q.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tipo de produto"}),e.jsxs("select",{className:"form-select",value:g,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"",children:"(Opcional)"}),O.map(s=>e.jsx("option",{value:s.id,children:s.nome||s.tipo},s.id))]})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:m,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"novo",children:"Novo"}),e.jsx("option",{value:"enviado",children:"Enviado"}),e.jsx("option",{value:"negociando",children:"Negociando"}),e.jsx("option",{value:"fechado",children:"Fechado"}),e.jsx("option",{value:"perdido",children:"Perdido"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Valor estimado (R$)"}),e.jsx("input",{className:"form-input",type:"number",value:v,onChange:s=>h(s.target.value),min:0,step:"0.01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Data da viagem"}),e.jsx("input",{className:"form-input",type:"date",value:N,onChange:s=>f(s.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Notas"}),e.jsx("textarea",{className:"form-input",rows:3,value:b,onChange:s=>x(s.target.value),placeholder:"Observações, próximos passos..."})]}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:S,children:S?"Salvando...":"Criar orçamento"}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:()=>{i(""),d(""),u(""),p("novo"),h(""),f(""),x(""),t(null),j(null)},children:"Limpar"})]})]})]}):e.jsx("div",{children:"Acesso ao módulo de Vendas bloqueado."})}export{A as default};
