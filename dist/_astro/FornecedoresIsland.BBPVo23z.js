import{j as e}from"./jsx-runtime.mfZSNocD.js";import{r as t}from"./index.C0Fn7Wtz.js";import{s as m}from"./supabase.Ng8nq9tn.js";import{u as T}from"./usePermissao.Bkt8qSjs.js";const A=[{value:"brasil",label:"Brasil"},{value:"exterior",label:"Exterior"}],E=[{value:"pre_pago",label:"Pré-Pago"},{value:"semanal",label:"Semanal"},{value:"quinzenal",label:"Quinzenal"},{value:"mensal",label:"Mensal"}],w={nome_completo:"",nome_fantasia:"",localizacao:"brasil",cnpj:"",cep:"",cidade:"",estado:"",telefone:"",whatsapp:"",telefone_emergencia:"",responsavel:"",tipo_faturamento:"pre_pago",principais_servicos:""};function O(i){const p=E.find(u=>u.value===i);return p?p.label:i||"-"}function L(i){return i==="brasil"?"Brasil":i==="exterior"?"Exterior":i||"-"}function q(){const{permissao:i,ativo:p,loading:u}=T("Cadastros"),[c,I]=t.useState(null),[h,S]=t.useState([]),[r,o]=t.useState(w),[f,x]=t.useState(!0),[v,j]=t.useState(!1),[g,b]=t.useState(null),[N,d]=t.useState(null);t.useEffect(()=>{let a=!0;async function s(){try{const{data:n}=await m.auth.getSession(),_=n?.session?.user||(await m.auth.getUser()).data?.user||null;if(!_||!a)return;const{data:P,error:C}=await m.from("users").select("company_id").eq("id",_.id).maybeSingle();if(!a)return;if(C){console.error("Erro ao buscar company_id dos fornecedores:",C);return}I(P?.company_id||null)}catch(n){console.error("Erro ao determinar company_id dos fornecedores:",n)}}return s(),()=>{a=!1}},[]),t.useEffect(()=>{c&&y()},[c]);async function y(){if(c){x(!0),b(null);try{const{data:a,error:s}=await m.from("fornecedores").select("id, nome_completo, nome_fantasia, localizacao, cidade, estado, telefone, whatsapp, responsavel, tipo_faturamento, principais_servicos, created_at").eq("company_id",c).order("created_at",{ascending:!1});if(s)throw s;S(a||[])}catch(a){console.error(a),b("Erro ao carregar fornecedores.")}finally{x(!1)}}}function z(){return r.nome_completo.trim()?r.nome_fantasia.trim()?r.cidade.trim()?r.estado.trim()?r.telefone.trim()?r.whatsapp.trim()?r.telefone_emergencia.trim()?r.responsavel.trim()?r.tipo_faturamento?r.principais_servicos.trim()?r.localizacao==="brasil"&&!r.cnpj.trim()?"Informe o CNPJ.":r.localizacao==="brasil"&&!r.cep.trim()?"Informe o CEP.":null:"Descreva os principais serviços.":"Escolha o tipo de faturamento.":"Informe o responsável.":"Informe o telefone de emergência.":"Informe o WhatsApp.":"Informe o telefone.":"Informe o estado.":"Informe a cidade.":"Informe o nome fantasia.":"Informe o nome completo."}const l=i!=="view"&&B(i);async function F(){if(!c){d("Não foi possível determinar sua empresa.");return}if(!l){d("Sua permissão não permite salvar fornecedores.");return}const a=z();if(a){d(a);return}try{j(!0),d(null);const s={...r,company_id:c,tipo_faturamento:r.tipo_faturamento,principais_servicos:r.principais_servicos.trim()},{error:n}=await m.from("fornecedores").insert(s);if(n)throw n;o(w),await y()}catch(s){console.error(s),d("Erro ao criar fornecedor.")}finally{j(!1)}}return!p&&!u?e.jsx("div",{children:"Você não possui acesso ao módulo de Cadastros."}):e.jsxs("div",{className:"card-base card-purple",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:"Fornecedores"}),e.jsx("small",{style:{color:"#94a3b8"},children:"Cadastre parceiros nacionais e internacionais."})]})}),e.jsxs("div",{className:"card-base card-blue",style:{marginTop:12,padding:16},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"Novo fornecedor"}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Localização"}),e.jsx("div",{style:{display:"flex",gap:12},children:A.map(a=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("input",{type:"radio",name:"localizacao",value:a.value,checked:r.localizacao===a.value,onChange:s=>o(n=>({...n,localizacao:s.target.value})),disabled:!l}),a.label]},a.value))})]})}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Nome completo"}),e.jsx("input",{className:"form-input",value:r.nome_completo,onChange:a=>o(s=>({...s,nome_completo:a.target.value})),disabled:!l,placeholder:"Razão social"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Nome fantasia"}),e.jsx("input",{className:"form-input",value:r.nome_fantasia,onChange:a=>o(s=>({...s,nome_fantasia:a.target.value})),disabled:!l,placeholder:"Nome comercial"})]})]}),r.localizacao==="brasil"&&e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"CNPJ"}),e.jsx("input",{className:"form-input",value:r.cnpj,onChange:a=>o(s=>({...s,cnpj:a.target.value})),disabled:!l,placeholder:"00.000.000/0000-00"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"CEP"}),e.jsx("input",{className:"form-input",value:r.cep,onChange:a=>o(s=>({...s,cep:a.target.value})),disabled:!l,placeholder:"00000-000"})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Cidade"}),e.jsx("input",{className:"form-input",value:r.cidade,onChange:a=>o(s=>({...s,cidade:a.target.value})),disabled:!l,placeholder:"Cidade principal de atuação"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsx("input",{className:"form-input",value:r.estado,onChange:a=>o(s=>({...s,estado:a.target.value})),disabled:!l,placeholder:"UF / região"})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Telefone"}),e.jsx("input",{className:"form-input",value:r.telefone,onChange:a=>o(s=>({...s,telefone:a.target.value})),disabled:!l,placeholder:"(00) 0000-0000"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"WhatsApp"}),e.jsx("input",{className:"form-input",value:r.whatsapp,onChange:a=>o(s=>({...s,whatsapp:a.target.value})),disabled:!l,placeholder:"+55 00 00000-0000"})]})]}),e.jsxs("div",{className:"form-row",style:{gap:12},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Telefone emergência"}),e.jsx("input",{className:"form-input",value:r.telefone_emergencia,onChange:a=>o(s=>({...s,telefone_emergencia:a.target.value})),disabled:!l,placeholder:"Contato alternativo"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Responsável"}),e.jsx("input",{className:"form-input",value:r.responsavel,onChange:a=>o(s=>({...s,responsavel:a.target.value})),disabled:!l,placeholder:"Pessoa de contato"})]})]}),e.jsx("div",{className:"form-row",style:{gap:12},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{className:"form-label",children:"Tipo de faturamento"}),e.jsx("select",{className:"form-select",value:r.tipo_faturamento,onChange:a=>o(s=>({...s,tipo_faturamento:a.target.value})),disabled:!l,children:E.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Principais serviços"}),e.jsx("textarea",{className:"form-textarea",value:r.principais_servicos,onChange:a=>o(s=>({...s,principais_servicos:a.target.value})),disabled:!l,placeholder:"Descreva BR/EX serviços oferecidos",rows:3})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:F,disabled:v||!l,children:v?"Salvando...":"Cadastrar fornecedor"})}),N&&e.jsx("div",{style:{color:"red",marginTop:8},children:N})]}),e.jsxs("div",{className:"card-base",style:{marginTop:16},children:[e.jsx("h3",{style:{marginBottom:8},children:"Fornecedores cadastrados"}),g&&e.jsx("div",{style:{color:"red",marginBottom:8},children:g}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default min-w-[720px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome fantasia"}),e.jsx("th",{children:"Local"}),e.jsx("th",{children:"Faturamento"}),e.jsx("th",{children:"Contato"}),e.jsx("th",{children:"Serviços"})]})}),e.jsxs("tbody",{children:[f&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Carregando fornecedores..."})}),!f&&h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Nenhum fornecedor cadastrado."})}),!f&&h.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome_fantasia||a.nome_completo||"-"}),e.jsxs("td",{children:[L(a.localizacao),a.cidade?` • ${a.cidade}`:"",a.estado?`/${a.estado}`:""]}),e.jsx("td",{children:O(a.tipo_faturamento)}),e.jsxs("td",{children:[a.telefone||"-",a.whatsapp&&` • WhatsApp: ${a.whatsapp}`]}),e.jsx("td",{style:{maxWidth:240,whiteSpace:"normal"},children:a.principais_servicos?a.principais_servicos.length>80?`${a.principais_servicos.slice(0,80)}...`:a.principais_servicos:"-"})]},a.id))]})]})})]})]})}function B(i){return i&&i!=="none"}export{q as default};
