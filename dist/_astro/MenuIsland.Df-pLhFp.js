import{s as h,j as s}from"./supabase.DNkd6bxA.js";import{r as n}from"./index.C0Fn7Wtz.js";import{r as H}from"./logs.WCvMC_es.js";async function K(){try{const{data:e}=await h.auth.getUser(),o=e?.user?.id||null;let u="";try{u=(await(await fetch("https://api.ipify.org?format=json")).json()).ip||""}catch{}const p=typeof navigator<"u"?navigator.userAgent:"";await H({user_id:o,acao:"logout",modulo:"login",detalhes:{ip:u,userAgent:p}}),await h.auth.signOut(),window.location.href="/auth/login"}catch(e){console.error("Erro ao sair:",e),window.location.href="/auth/login"}}const Q={Dashboard:"dashboard",Vendas:"vendas_consulta",Orcamentos:"orcamentos",Clientes:"clientes",Cadastros:"cadastros",Paises:"cadastros_paises",Cidades:"cadastros_cidades",Destinos:"cadastros_destinos",Produtos:"cadastros_produtos",Relatorios:"relatorios",RelatorioVendas:"relatorios_vendas",RelatorioDestinos:"relatorios_destinos",RelatorioProdutos:"relatorios_produtos",RelatorioClientes:"relatorios_clientes",Parametros:"parametros",Metas:"parametros_metas",RegrasComissao:"parametros_regras_comissao",Admin:"admin",AdminDashboard:"admin_dashboard",AdminUsers:"admin_users",AdminLogs:"admin_logs"};function as({activePage:e}){const o=(()=>{if(typeof window>"u")return null;try{const r=window.localStorage.getItem("sgtur_menu_cache");return r?JSON.parse(r):null}catch{return null}})(),[u,p]=n.useState(o?.userId||null),[S,x]=n.useState(o?.acessos||{}),[W,X]=n.useState(!1),[R,b]=n.useState(!!o),[_,A]=n.useState(!1),[Y,C]=n.useState(o?.tipoUsuario||""),[k,y]=n.useState(o?.isAdmin||!1),[Z,U]=n.useState(o?.userEmail||"");async function D(){const{data:r}=await h.auth.getSession(),i=r?.session?.user,{data:d}=i?{data:{user:i}}:await h.auth.getUser(),l=d?.user||i||null,c=l?.id||null,N=l?.email||"",E=l?.user_metadata?.tipo||"",v=l?.app_metadata?.roles||[],M=l?.app_metadata?.role||"",V=Array.isArray(v)&&v.length>0?v.join(","):M,j=[E,V].filter(Boolean).join(", ");if(p(a=>a!==c?c:a),C(a=>a!==String(j||"").toUpperCase()?String(j||"").toUpperCase():a),U(a=>a!==N.toLowerCase()?N.toLowerCase():a),!c){R||x({}),b(!0);return}const{data:T}=await h.from("users").select("user_types(name)").eq("id",c).maybeSingle(),J=T?.user_types?.name||"",B=String(J||"").toUpperCase(),$=["ADMIN","ADMINISTRADOR","SUPER","MASTER"],F=$.some(a=>j.toUpperCase().includes(a)),q=$.some(a=>B.includes(a)),w=F||q;y(a=>a!==w?w:a);const{data:G}=await h.from("modulo_acesso").select("modulo, permissao, ativo").eq("usuario_id",c),f={};(G||[]).forEach(a=>{const g=a.modulo.toLowerCase(),m=(a.permissao||"none").toLowerCase(),z=["view","create","edit","delete","admin"].includes(m)?m:m==="none"?"none":"view";f[g]=a.ativo?z:"none"}),x(a=>{const g=JSON.stringify(a),m=JSON.stringify(f);return g!==m?f:a});try{window.localStorage.setItem("sgtur_menu_cache",JSON.stringify({userId:c,acessos:f,isAdmin:w,tipoUsuario:String(j||"").toUpperCase(),userEmail:N.toLowerCase()}))}catch{}b(!0)}n.useEffect(()=>{try{const r=window.localStorage.getItem("sgtur_menu_cache");if(r){const i=JSON.parse(r);p(i.userId||null),x(i.acessos||{}),y(!!i.isAdmin),C(i.tipoUsuario||""),U(i.userEmail||""),b(!0)}}catch{}D()},[]);async function O(){A(!0),await K(),A(!1)}const I=(r,i="view")=>{const d=["none","view","create","edit","delete","admin"],l=S[r]??"none";return d.indexOf(l)>=d.indexOf(i)},t=(r,i="view")=>{if(k)return!0;const d=Q[r];return d?I(d,i):!1},L=k;return s.jsxs("aside",{className:"app-sidebar",children:[s.jsx("div",{className:"sidebar-logo",children:"SGTUR"}),s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"OperaÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[t("Dashboard")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="dashboard"?"active":""}`,href:"/",children:[s.jsx("span",{children:"ğŸ“Š"}),"Dashboard"]})}),t("Vendas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="vendas"?"active":""}`,href:"/vendas/consulta",children:[s.jsx("span",{children:"ğŸ§¾"}),"Vendas"]})}),t("Orcamentos")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="orcamentos"?"active":""}`,href:"/orcamentos",children:[s.jsx("span",{children:"ğŸ’¼"}),"OrÃ§amentos"]})}),t("Clientes")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="clientes"?"active":""}`,href:"/clientes/carteira",children:[s.jsx("span",{children:"ğŸ‘¥"}),"Clientes"]})})]})]}),t("Cadastros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Cadastros"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="paises"?"active":""}`,href:"/cadastros/paises",children:[s.jsx("span",{children:"ğŸŒ"}),"PaÃ­ses"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="cidades"?"active":""}`,href:"/cadastros/cidades",children:[s.jsx("span",{children:"ğŸ™ï¸"}),"Cidades"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="destinos"?"active":""}`,href:"/cadastros/destinos",children:[s.jsx("span",{children:"ğŸ“Œ"}),"Destinos"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="produtos"?"active":""}`,href:"/cadastros/produtos",children:[s.jsx("span",{children:"ğŸ«"}),"Produtos"]})})]})]}),t("Relatorios")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"RelatÃ³rios"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas"?"active":""}`,href:"/relatorios/vendas",children:[s.jsx("span",{children:"ğŸ“ˆ"}),"Vendas (detalhado)"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-destino"?"active":""}`,href:"/relatorios/vendas-por-destino",children:[s.jsx("span",{children:"ğŸ“Œ"}),"Vendas por destino"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-produto"?"active":""}`,href:"/relatorios/vendas-por-produto",children:[s.jsx("span",{children:"ğŸ«"}),"Vendas por produto"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="relatorios-vendas-cliente"?"active":""}`,href:"/relatorios/vendas-por-cliente",children:[s.jsx("span",{children:"ğŸ‘¤"}),"Vendas por cliente"]})})]})]}),t("Parametros")&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"ParÃ¢metros"}),s.jsxs("ul",{className:"sidebar-nav",children:[t("Metas")&&s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros-metas"?"active":""}`,href:"/parametros/metas",children:[s.jsx("span",{children:"ğŸ¯"}),"Metas"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="parametros"?"active":""}`,href:"/parametros",children:[s.jsx("span",{children:"âš™ï¸"}),"ParÃ¢metros do Sistema"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="regras-comissao"?"active":""}`,href:"/parametros/regras-comissao",children:[s.jsx("span",{children:"ğŸ’°"}),"Regras de ComissÃ£o"]})})]})]}),u&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"Conta"}),s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="perfil"?"active":""}`,href:"/perfil",children:[s.jsx("span",{children:"ğŸ‘¤"}),"Perfil"]})})})]}),L&&s.jsxs("div",{children:[s.jsx("div",{className:"sidebar-section-title",children:"AdministraÃ§Ã£o"}),s.jsxs("ul",{className:"sidebar-nav",children:[s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-permissoes"?"active":""}`,href:"/admin/permissoes",children:[s.jsx("span",{children:"âš™ï¸"}),"PermissÃµes"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-logs"?"active":""}`,href:"/dashboard/logs",children:[s.jsx("span",{children:"ğŸ“œ"}),"Logs"]})}),s.jsx("li",{children:s.jsxs("a",{className:`sidebar-link ${e==="admin-users"?"active":""}`,href:"/dashboard/admin",children:[s.jsx("span",{children:"ğŸ§‘â€ğŸ’¼"}),"UsuÃ¡rios"]})})]})]}),s.jsx("div",{style:{marginTop:20},children:s.jsx("ul",{className:"sidebar-nav",children:s.jsx("li",{children:s.jsxs("button",{type:"button",className:"sidebar-link",style:{background:"transparent",border:"none",width:"100%",textAlign:"left"},onClick:O,disabled:_,children:[s.jsx("span",{children:"ğŸšª"}),_?"Saindo...":"Sair"]})})})})]})}export{as as default};
