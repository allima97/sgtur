import{j as e,s as h}from"./supabase.DNkd6bxA.js";import{r as n}from"./index.C0Fn7Wtz.js";import{u as k}from"./usePermissao.72SYthuA.js";function _(t){return(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}const j={nome:"",codigo_iso:"",continente:""};function O(){const[t,q]=n.useState([]),[f,b]=n.useState(!0),[v,o]=n.useState(null),[r,F]=n.useState(""),[i,d]=n.useState(j),[N,w]=n.useState(!1),[m,x]=n.useState(null),[C,S]=n.useState(null),{permissao:l,ativo:I,loading:D}=k("Cadastros"),[c,P]=n.useState(!1);async function u(s=!1){try{b(!0),o(null);const a=h.from("paises").select("id, nome, codigo_iso, continente, created_at").order(s?"nome":"created_at",{ascending:!s}).limit(s?void 0:10),{data:g,error:y}=await a;if(y)throw y;q(g||[]),P(s||!1)}catch(a){console.error(a),o("Erro ao carregar paÃ­ses. Verifique se a tabela 'paises' existe e se as colunas estÃ£o corretas.")}finally{b(!1)}}n.useEffect(()=>{u(!1)},[]),n.useEffect(()=>{r.trim()&&!c&&u(!0)},[r,c]);const E=n.useMemo(()=>{if(!r.trim())return t;const s=_(r);return t.filter(a=>_(a.nome).includes(s))},[r,t]);function p(s,a){d(g=>({...g,[s]:a}))}function B(){d(j),x(null),o(null)}function V(s){x(s.id),d({nome:s.nome,codigo_iso:s.codigo_iso||"",continente:s.continente||""})}async function R(s){if(s.preventDefault(),l==="view"){o("VocÃª nÃ£o tem permissÃ£o para salvar paÃ­ses.");return}if(!i.nome.trim()){o("Nome Ã© obrigatÃ³rio.");return}try{if(w(!0),o(null),m){const{error:a}=await h.from("paises").update({nome:i.nome.trim(),codigo_iso:i.codigo_iso.trim()||null,continente:i.continente.trim()||null}).eq("id",m);if(a)throw a}else{const{error:a}=await h.from("paises").insert({nome:i.nome.trim(),codigo_iso:i.codigo_iso.trim()||null,continente:i.continente.trim()||null});if(a)throw a}d(j),x(null),await u(c)}catch(a){console.error(a),o("Erro ao salvar paÃ­s. Verifique se o nome Ã© Ãºnico.")}finally{w(!1)}}async function T(s){if(l!=="admin"){window.alert("Somente administradores podem excluir paÃ­ses.");return}if(window.confirm("Tem certeza que deseja excluir este paÃ­s?"))try{S(s),o(null);const{error:a}=await h.from("paises").delete().eq("id",s);if(a)throw a;await u(c)}catch(a){console.error(a),o("NÃ£o foi possÃ­vel excluir o paÃ­s. Verifique se nÃ£o existem destinos vinculados.")}finally{S(null)}}return D?e.jsx("div",{className:"paises-page",children:"Carregando permissÃµes..."}):I?e.jsxs("div",{className:"paises-page",children:[e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome do paÃ­s *"}),e.jsx("input",{className:"form-input",value:i.nome,onChange:s=>p("nome",s.target.value),placeholder:"Ex: Brasil, Estados Unidos, FranÃ§a..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CÃ³digo ISO"}),e.jsx("input",{className:"form-input",value:i.codigo_iso,onChange:s=>p("codigo_iso",s.target.value),placeholder:"Ex: BR, US, FR..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Continente"}),e.jsx("input",{className:"form-input",value:i.continente,onChange:s=>p("continente",s.target.value),placeholder:"Ex: AmÃ©rica do Sul, Europa..."})]})]}),e.jsxs("div",{className:"mt-2",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:N||l==="view",children:N?"Salvando...":m?"Salvar alteraÃ§Ãµes":"Adicionar paÃ­s"}),m&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:B,children:"Cancelar ediÃ§Ã£o"})]})]})}),e.jsx("div",{className:"card-base mb-3",children:e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Buscar paÃ­s"}),e.jsx("input",{className:"form-input",value:r,onChange:s=>F(s.target.value),placeholder:"Digite parte do nome..."})]})})}),!c&&e.jsx("div",{className:"card-base card-config mb-3",children:"Ãšltimos PaÃ­ses Cadastrados (10). Digite na busca para consultar todos."}),v&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:v})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[520px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CÃ³digo ISO"}),e.jsx("th",{children:"Continente"}),e.jsx("th",{children:"Criado em"}),e.jsx("th",{className:"th-actions",children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[f&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Carregando paÃ­ses..."})}),!f&&E.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Nenhum paÃ­s encontrado."})}),!f&&E.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome}),e.jsx("td",{children:s.codigo_iso||"-"}),e.jsx("td",{children:s.continente||"-"}),e.jsx("td",{children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"th-actions",children:l!=="view"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",title:"Editar",onClick:()=>V(s),children:"âœï¸"}),l==="admin"&&e.jsx("button",{className:"btn-icon btn-danger",title:"Excluir",onClick:()=>T(s.id),disabled:C===s.id,children:C===s.id?"...":"ğŸ—‘ï¸"})]})})]},s.id))]})]})})]}):e.jsx("div",{className:"paises-page",children:"VocÃª nÃ£o possui acesso ao mÃ³dulo de Cadastros."})}export{O as default};
