import{j as e,s as d}from"./supabase.CWKfsr2i.js";import{r as o}from"./index.DVhKKaGN.js";import{u as V}from"./usePermissao.LURrmXgT.js";const p={nome:"",codigo_iso:"",continente:""};function k(){const[m,S]=o.useState([]),[u,j]=o.useState(!0),[g,i]=o.useState(null),[r,E]=o.useState(""),[n,l]=o.useState(p),[b,v]=o.useState(!1),[c,h]=o.useState(null),[N,w]=o.useState(null),{permissao:t,ativo:y,loading:_}=V("Cadastros");async function x(){try{j(!0),i(null);const{data:s,error:a}=await d.from("paises").select("id, nome, codigo_iso, continente, created_at").order("nome",{ascending:!0});if(a)throw a;S(s||[])}catch(s){console.error(s),i("Erro ao carregar paÃ­ses. Verifique se a tabela 'paises' existe e se as colunas estÃ£o corretas.")}finally{j(!1)}}o.useEffect(()=>{x()},[]);const C=o.useMemo(()=>{if(!r.trim())return m;const s=r.toLowerCase();return m.filter(a=>a.nome.toLowerCase().includes(s))},[r,m]);function f(s,a){l(P=>({...P,[s]:a}))}function I(){l(p),h(null),i(null)}function q(s){h(s.id),l({nome:s.nome,codigo_iso:s.codigo_iso||"",continente:s.continente||""})}async function F(s){if(s.preventDefault(),t==="view"){i("VocÃª nÃ£o tem permissÃ£o para salvar paÃ­ses.");return}if(!n.nome.trim()){i("Nome Ã© obrigatÃ³rio.");return}try{if(v(!0),i(null),c){const{error:a}=await d.from("paises").update({nome:n.nome.trim(),codigo_iso:n.codigo_iso.trim()||null,continente:n.continente.trim()||null}).eq("id",c);if(a)throw a}else{const{error:a}=await d.from("paises").insert({nome:n.nome.trim(),codigo_iso:n.codigo_iso.trim()||null,continente:n.continente.trim()||null});if(a)throw a}l(p),h(null),await x()}catch(a){console.error(a),i("Erro ao salvar paÃ­s. Verifique se o nome Ã© Ãºnico.")}finally{v(!1)}}async function B(s){if(t!=="admin"){window.alert("Somente administradores podem excluir paÃ­ses.");return}if(window.confirm("Tem certeza que deseja excluir este paÃ­s?"))try{w(s),i(null);const{error:a}=await d.from("paises").delete().eq("id",s);if(a)throw a;await x()}catch(a){console.error(a),i("NÃ£o foi possÃ­vel excluir o paÃ­s. Verifique se nÃ£o existem destinos vinculados.")}finally{w(null)}}return _?e.jsx("div",{className:"paises-page",children:"Carregando permissÃµes..."}):y?e.jsxs("div",{className:"paises-page",children:[e.jsx("div",{className:"card-base card-blue mb-3",children:e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Nome do paÃ­s *"}),e.jsx("input",{className:"form-input",value:n.nome,onChange:s=>f("nome",s.target.value),placeholder:"Ex: Brasil, Estados Unidos, FranÃ§a..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"CÃ³digo ISO"}),e.jsx("input",{className:"form-input",value:n.codigo_iso,onChange:s=>f("codigo_iso",s.target.value),placeholder:"Ex: BR, US, FR..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Continente"}),e.jsx("input",{className:"form-input",value:n.continente,onChange:s=>f("continente",s.target.value),placeholder:"Ex: AmÃ©rica do Sul, Europa..."})]})]}),e.jsxs("div",{className:"mt-2",style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:b||t==="view",children:b?"Salvando...":c?"Salvar alteraÃ§Ãµes":"Adicionar paÃ­s"}),c&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:I,children:"Cancelar ediÃ§Ã£o"})]})]})}),e.jsx("div",{className:"card-base mb-3",children:e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Buscar paÃ­s"}),e.jsx("input",{className:"form-input",value:r,onChange:s=>E(s.target.value),placeholder:"Digite parte do nome..."})]})})}),g&&e.jsx("div",{className:"card-base card-config mb-3",children:e.jsx("strong",{children:g})}),e.jsx("div",{className:"table-container overflow-x-auto",children:e.jsxs("table",{className:"table-default table-header-blue min-w-[520px]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"CÃ³digo ISO"}),e.jsx("th",{children:"Continente"}),e.jsx("th",{children:"Criado em"}),e.jsx("th",{className:"th-actions",children:"AÃ§Ãµes"})]})}),e.jsxs("tbody",{children:[u&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Carregando paÃ­ses..."})}),!u&&C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Nenhum paÃ­s encontrado."})}),!u&&C.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome}),e.jsx("td",{children:s.codigo_iso||"-"}),e.jsx("td",{children:s.continente||"-"}),e.jsx("td",{children:s.created_at?new Date(s.created_at).toLocaleDateString("pt-BR"):"-"}),e.jsx("td",{className:"th-actions",children:t!=="view"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",title:"Editar",onClick:()=>q(s),children:"âœï¸"}),t==="admin"&&e.jsx("button",{className:"btn-icon btn-danger",title:"Excluir",onClick:()=>B(s.id),disabled:N===s.id,children:N===s.id?"...":"ğŸ—‘ï¸"})]})})]},s.id))]})]})})]}):e.jsx("div",{className:"paises-page",children:"VocÃª nÃ£o possui acesso ao mÃ³dulo de Cadastros."})}export{k as default};
